/* Generated by Cython 0.12 on Tue Dec 29 14:26:49 2009 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#else
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#if PY_VERSION_HEX < 0x02040000
  #define METH_COEXIST 0
  #define PyDict_CheckExact(op) (Py_TYPE(op) == &PyDict_Type)
  #define PyDict_Contains(d,o)   PySequence_Contains(d,o)
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PY_FORMAT_SIZE_T ""
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   PyInt_AsLong(o)
  #define PyNumber_Index(o)    PyNumber_Int(o)
  #define PyIndex_Check(o)     PyNumber_Check(o)
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)

  typedef struct {
       void *buf;
       PyObject *obj;
       Py_ssize_t len;
       Py_ssize_t itemsize;
       int readonly;
       int ndim;
       char *format;
       Py_ssize_t *shape;
       Py_ssize_t *strides;
       Py_ssize_t *suboffsets;
       void *internal;
  } Py_buffer;

  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)

#endif
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#if (PY_VERSION_HEX < 0x02060000) || (PY_MAJOR_VERSION >= 3)
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyString_Type                PyUnicode_Type
  #define PyString_CheckExact          PyUnicode_CheckExact
#else
  #define PyBytes_Type                 PyString_Type
  #define PyBytes_CheckExact           PyString_CheckExact
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) PyInstanceMethod_New(func)
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#else
  #define _USE_MATH_DEFINES
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),((char *)(n)))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),((char *)(n)),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),((char *)(n)))
#else
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),(n))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),(n),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),(n))
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_NAMESTR(n) ((char *)(n))
  #define __Pyx_DOCSTR(n)  ((char *)(n))
#else
  #define __Pyx_NAMESTR(n) (n)
  #define __Pyx_DOCSTR(n)  (n)
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#define __PYX_HAVE_API__ctotable
#include "tctdb.h"

#ifdef __GNUC__
#define INLINE __inline__
#elif _WIN32
#define INLINE __inline
#else
#define INLINE 
#endif

typedef struct {PyObject **p; char *s; const long n; const char* encoding; const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry; /*proto*/


/* Type Conversion Predeclarations */

#if PY_MAJOR_VERSION < 3
#define __Pyx_PyBytes_FromString          PyString_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyString_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyString_AsString
#else
#define __Pyx_PyBytes_FromString          PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyBytes_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyBytes_AsString
#endif

#define __Pyx_PyBytes_FromUString(s)      __Pyx_PyBytes_FromString((char*)s)
#define __Pyx_PyBytes_AsUString(s)        ((unsigned char*) __Pyx_PyBytes_AsString(s))

#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x);

#if !defined(T_PYSSIZET)
#if PY_VERSION_HEX < 0x02050000
#define T_PYSSIZET T_INT
#elif !defined(T_LONGLONG)
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))  ? T_INT  : \
        ((sizeof(Py_ssize_t) == sizeof(long)) ? T_LONG : -1))
#else
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))          ? T_INT      : \
        ((sizeof(Py_ssize_t) == sizeof(long))         ? T_LONG     : \
        ((sizeof(Py_ssize_t) == sizeof(PY_LONG_LONG)) ? T_LONGLONG : -1)))
#endif
#endif


#if !defined(T_ULONGLONG)
#define __Pyx_T_UNSIGNED_INT(x) \
        ((sizeof(x) == sizeof(unsigned char))  ? T_UBYTE : \
        ((sizeof(x) == sizeof(unsigned short)) ? T_USHORT : \
        ((sizeof(x) == sizeof(unsigned int))   ? T_UINT : \
        ((sizeof(x) == sizeof(unsigned long))  ? T_ULONG : -1))))
#else
#define __Pyx_T_UNSIGNED_INT(x) \
        ((sizeof(x) == sizeof(unsigned char))  ? T_UBYTE : \
        ((sizeof(x) == sizeof(unsigned short)) ? T_USHORT : \
        ((sizeof(x) == sizeof(unsigned int))   ? T_UINT : \
        ((sizeof(x) == sizeof(unsigned long))  ? T_ULONG : \
        ((sizeof(x) == sizeof(unsigned PY_LONG_LONG)) ? T_ULONGLONG : -1)))))
#endif
#if !defined(T_LONGLONG)
#define __Pyx_T_SIGNED_INT(x) \
        ((sizeof(x) == sizeof(char))  ? T_BYTE : \
        ((sizeof(x) == sizeof(short)) ? T_SHORT : \
        ((sizeof(x) == sizeof(int))   ? T_INT : \
        ((sizeof(x) == sizeof(long))  ? T_LONG : -1))))
#else
#define __Pyx_T_SIGNED_INT(x) \
        ((sizeof(x) == sizeof(char))  ? T_BYTE : \
        ((sizeof(x) == sizeof(short)) ? T_SHORT : \
        ((sizeof(x) == sizeof(int))   ? T_INT : \
        ((sizeof(x) == sizeof(long))  ? T_LONG : \
        ((sizeof(x) == sizeof(PY_LONG_LONG))   ? T_LONGLONG : -1)))))
#endif

#define __Pyx_T_FLOATING(x) \
        ((sizeof(x) == sizeof(float)) ? T_FLOAT : \
        ((sizeof(x) == sizeof(double)) ? T_DOUBLE : -1))

#if !defined(T_SIZET)
#if !defined(T_ULONGLONG)
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))  ? T_UINT  : \
        ((sizeof(size_t) == sizeof(unsigned long)) ? T_ULONG : -1))
#else
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))          ? T_UINT      : \
        ((sizeof(size_t) == sizeof(unsigned long))         ? T_ULONG     : \
        ((sizeof(size_t) == sizeof(unsigned PY_LONG_LONG)) ? T_ULONGLONG : -1)))
#endif
#endif

static INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
static INLINE size_t __Pyx_PyInt_AsSize_t(PyObject*);

#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))


#ifdef __GNUC__
/* Test for GCC > 2.95 */
#if __GNUC__ > 2 ||               (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)) 
#define likely(x)   __builtin_expect(!!(x), 1)
#define unlikely(x) __builtin_expect(!!(x), 0)
#else /* __GNUC__ > 2 ... */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ */
    
static PyObject *__pyx_m;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;
static const char **__pyx_f;


/* Type declarations */

/* "/usr/local/src/totable/src/ctotable.pyx":294
 *         return self._key_to_dict(key)
 * 
 *     cpdef get(self, key, default=None):             # <<<<<<<<<<<<<<
 *         try:
 *             v = self._key_to_dict(key)
 */

struct __pyx_opt_args_8ctotable_7ToTable_get {
  int __pyx_n;
  PyObject *__pyx_default;
};

/* "/usr/local/src/totable/src/ctotable.pyx":551
 *         return self
 * 
 * cdef class transaction(object):             # <<<<<<<<<<<<<<
 *     cdef ToTable table
 *     def __init__(self, ToTable t):
 */

struct __pyx_obj_8ctotable_transaction {
  PyObject_HEAD
  struct __pyx_obj_8ctotable_ToTable *table;
};

/* "/usr/local/src/totable/src/ctotable.pyx":579
 * # this class just useful as it cleans itself up.
 * # would be nicer to have this for tcmap...
 * cdef class TCQuery(object):             # <<<<<<<<<<<<<<
 *     cdef TDBQRY* _state
 *     def __dealloc__(self):
 */

struct __pyx_obj_8ctotable_TCQuery {
  PyObject_HEAD
  TDBQRY *_state;
};

/* "/usr/local/src/totable/src/ctotable.pyx":37
 *     '''An error communicating with the Tokyo Cabinet database.'''
 * 
 * cdef class ToTable(object):             # <<<<<<<<<<<<<<
 *     """A Tokyo Cabinet table database.
 * 
 */

struct __pyx_obj_8ctotable_ToTable {
  PyObject_HEAD
  struct __pyx_vtabstruct_8ctotable_ToTable *__pyx_vtab;
  TCTDB *_state;
  PyObject *path;
  PyObject *mode;
};

/* "/usr/local/src/totable/src/ctotable.pyx":460
 *         return li
 * 
 * cdef class Col(object):             # <<<<<<<<<<<<<<
 *     """
 *     TODO:
 */

struct __pyx_obj_8ctotable_Col {
  PyObject_HEAD
  PyObject *colname;
  int op;
  PyObject *other;
  PyObject *num_lookups;
  int invert;
};

/* "/usr/local/src/totable/src/ctotable.pyx":569
 * 
 * 
 * cdef class TCMap(object):             # <<<<<<<<<<<<<<
 *     cdef TCMAP* _state
 *     def __del__(self):
 */

struct __pyx_obj_8ctotable_TCMap {
  PyObject_HEAD
  TCMAP *_state;
};


/* "/usr/local/src/totable/src/ctotable.pyx":37
 *     '''An error communicating with the Tokyo Cabinet database.'''
 * 
 * cdef class ToTable(object):             # <<<<<<<<<<<<<<
 *     """A Tokyo Cabinet table database.
 * 
 */

struct __pyx_vtabstruct_8ctotable_ToTable {
  PyObject *(*_msg)(struct __pyx_obj_8ctotable_ToTable *, int __pyx_skip_dispatch);
  TCMAP *(*_dict_to_tcmap)(struct __pyx_obj_8ctotable_ToTable *, PyObject *);
  int (*create_index)(struct __pyx_obj_8ctotable_ToTable *, char *, PyObject *, int __pyx_skip_dispatch);
  PyObject *(*_tcmap_to_dict)(struct __pyx_obj_8ctotable_ToTable *, TCMAP *);
  PyObject *(*_key_to_dict)(struct __pyx_obj_8ctotable_ToTable *, PyObject *);
  PyObject *(*_ckey_to_dict)(struct __pyx_obj_8ctotable_ToTable *, char *, int);
  PyObject *(*_put_keep_code)(struct __pyx_obj_8ctotable_ToTable *, int, PyObject *);
  PyObject *(*get)(struct __pyx_obj_8ctotable_ToTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8ctotable_7ToTable_get *__pyx_optional_args);
  int (*size_of)(struct __pyx_obj_8ctotable_ToTable *, PyObject *, int __pyx_skip_dispatch);
  void (*_set_limit)(struct __pyx_obj_8ctotable_ToTable *, TDBQRY *, PyObject *);
  void (*_set_callback)(struct __pyx_obj_8ctotable_ToTable *, TDBQRY *, PyObject *);
  TDBQRYPROC (*get_proc)(struct __pyx_obj_8ctotable_ToTable *, void *);
  void (*_set_order)(struct __pyx_obj_8ctotable_ToTable *, TDBQRY *, PyObject *);
  PyObject *(*_tclist_to_list)(struct __pyx_obj_8ctotable_ToTable *, TCLIST *, int, int);
};
static struct __pyx_vtabstruct_8ctotable_ToTable *__pyx_vtabptr_8ctotable_ToTable;

#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif

#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct * __Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule((char *)modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, (char *)"RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
  end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
  }
  #define __Pyx_RefNannySetupContext(name)           void *__pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
  #define __Pyx_RefNannyFinishContext()           __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r) __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r) __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r) __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XDECREF(r) do { if((r) != NULL) {__Pyx_DECREF(r);} } while(0)
#else
  #define __Pyx_RefNannySetupContext(name)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
#endif /* CYTHON_REFNANNY */
#define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);} } while(0)
#define __Pyx_XGOTREF(r) do { if((r) != NULL) {__Pyx_GOTREF(r);} } while(0)

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name, PyObject* kw_name); /*proto*/

static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/

static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,     const char* function_name); /*proto*/

static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

static INLINE void __Pyx_RaiseTooManyValuesError(void);

static PyObject *__Pyx_UnpackItem(PyObject *, Py_ssize_t index); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

static INLINE long __Pyx_NegateNonNeg(long b) { return unlikely(b < 0) ? b : !b; }
static INLINE PyObject* __Pyx_PyBoolOrNull_FromLong(long b) {
    return unlikely(b < 0) ? NULL : __Pyx_PyBool_FromLong(b);
}

static INLINE void __Pyx_RaiseNoneNotIterableError(void);

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/


static INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}


#define __Pyx_GetItemInt_List(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_List_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyList_GET_SIZE(o)))) {
            PyObject *r = PyList_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyList_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyList_GET_ITEM(o, PyList_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}

#define __Pyx_GetItemInt_Tuple(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Tuple_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyTuple_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyTuple_GET_ITEM(o, PyTuple_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}


#define __Pyx_GetItemInt(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    PyObject *r;
    if (PyList_CheckExact(o) && ((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (PyTuple_CheckExact(o) && ((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
        r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_item && (likely(i >= 0))) {
        r = PySequence_GetItem(o, i);
    }
    else {
        r = __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
    }
    return r;
}

static INLINE int __Pyx_CheckKeywordStrings(PyObject *kwdict,
    const char* function_name, int kw_allowed); /*proto*/

static INLINE PyObject* __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (PyList_Append(L, x) < 0) return NULL;
        Py_INCREF(Py_None);
        return Py_None; /* this is just to have an accurate signature */
    }
    else {
        PyObject *r, *m;
        m = __Pyx_GetAttrString(L, "append");
        if (!m) return NULL;
        r = PyObject_CallFunctionObjArgs(m, x, NULL);
        Py_DECREF(m);
        return r;
    }
}

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact); /*proto*/

static INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name, const char *modname); /*proto*/

static INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
static INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject *);

static INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject *);

static INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject *);

static INLINE char __Pyx_PyInt_AsChar(PyObject *);

static INLINE short __Pyx_PyInt_AsShort(PyObject *);

static INLINE int __Pyx_PyInt_AsInt(PyObject *);

static INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject *);

static INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject *);

static INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject *);

static INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject *);

static INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject *);

static INLINE long __Pyx_PyInt_AsLong(PyObject *);

static INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject *);

static INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject *);

static INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject *);

static INLINE int64_t __Pyx_PyInt_from_py_int64_t(PyObject *);

static INLINE int8_t __Pyx_PyInt_from_py_int8_t(PyObject *);

static INLINE uint8_t __Pyx_PyInt_from_py_uint8_t(PyObject *);

static INLINE int32_t __Pyx_PyInt_from_py_int32_t(PyObject *);

static void __Pyx_WriteUnraisable(const char *name); /*proto*/

static int __Pyx_SetVtable(PyObject *dict, void *vtable); /*proto*/

static void __Pyx_AddTraceback(const char *funcname); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/
/* Module declarations from python_ref */

/* Module declarations from python_string */

/* Module declarations from python_list */

/* Module declarations from ctotable */

static PyTypeObject *__pyx_ptype_8ctotable_ToTable = 0;
static PyTypeObject *__pyx_ptype_8ctotable_Col = 0;
static PyTypeObject *__pyx_ptype_8ctotable_transaction = 0;
static PyTypeObject *__pyx_ptype_8ctotable_TCMap = 0;
static PyTypeObject *__pyx_ptype_8ctotable_TCQuery = 0;
static struct __pyx_obj_8ctotable_TCMap *__pyx_f_8ctotable_make_tcmap(void); /*proto*/
static struct __pyx_obj_8ctotable_TCQuery *__pyx_f_8ctotable_make_query(TCTDB *); /*proto*/
#define __Pyx_MODULE_NAME "ctotable"
int __pyx_module_is_main_ctotable = 0;

/* Implementation of ctotable */
static PyObject *__pyx_builtin_Exception;
static PyObject *__pyx_builtin_KeyError;
static PyObject *__pyx_builtin_StopIteration;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_basestring;
static PyObject *__pyx_builtin_map;
static char __pyx_k_1[] = "%s('%s')";
static char __pyx_k_2[] = "Error.";
static char __pyx_k_3[] = "Unable optimize unless open with mode=\"w\"";
static char __pyx_k_4[] = "Unable to optimize {0}.";
static char __pyx_k_5[] = "Unable clear {0}";
static char __pyx_k_6[] = "Unable to tune {0}.";
static char __pyx_k_7[] = "Unable to set mmap size {0}.";
static char __pyx_k_8[] = "Unable to setcache {0}.";
static char __pyx_k_9[] = "Unable to open {0} for {1}.";
static char __pyx_k_10[] = "Error: attempting to add to non-existing key: %s";
static char __pyx_k_11[] = "error in put ";
static char __pyx_k_12[] = " ";
static char __pyx_k_13[] = "mode must be one of p/k/c";
static char __pyx_k_14[] = "Unable to write to ";
static char __pyx_k_15[] = "Lookup failed: ";
static char __pyx_k_16[] = "";
static char __pyx_k_17[] = "Unable to write key \"{0}\".";
static char __pyx_k_18[] = "Key not found: \"{0}\"";
static char __pyx_k_19[] = "+";
static char __pyx_k_20[] = "-";
static char __pyx_k_21[] = "\nTODO\n=====\n* docstrings.\n* allow specifying which columns are ints/floats.\n* DONE: fix contains()\n* DONE: indexes tctdbsetindex\n* DONE: document between\n* DONE: tune/optimize.\n* DONE: document tuning params.\n* DONE: __iter__ tctdbiternext.\n* tctdbmetasearch\n* see: tctdbqryproc for callbacks on queries.\n* benchmark.\n";
static char __pyx_k_22[] = "tokyo_cabinet_version";
static char __pyx_k_23[] = "0.1.1";
static char __pyx_k_24[] = "An error communicating with the Tokyo Cabinet database.";
static char __pyx_k__c[] = "c";
static char __pyx_k__d[] = "d";
static char __pyx_k__k[] = "k";
static char __pyx_k__o[] = "o";
static char __pyx_k__p[] = "p";
static char __pyx_k__r[] = "r";
static char __pyx_k__s[] = "s";
static char __pyx_k__t[] = "t";
static char __pyx_k__v[] = "v";
static char __pyx_k__w[] = "w";
static char __pyx_k__op[] = "op";
static char __pyx_k__exc[] = "exc";
static char __pyx_k__get[] = "get";
static char __pyx_k__key[] = "key";
static char __pyx_k__low[] = "low";
static char __pyx_k__map[] = "map";
static char __pyx_k__pop[] = "pop";
static char __pyx_k__put[] = "put";
static char __pyx_k___msg[] = "_msg";
static char __pyx_k__apow[] = "apow";
static char __pyx_k__bnum[] = "bnum";
static char __pyx_k__fpow[] = "fpow";
static char __pyx_k__high[] = "high";
static char __pyx_k__join[] = "join";
static char __pyx_k__keep[] = "keep";
static char __pyx_k__mode[] = "mode";
static char __pyx_k__opts[] = "opts";
static char __pyx_k__path[] = "path";
static char __pyx_k__type[] = "type";
static char __pyx_k__count[] = "count";
static char __pyx_k__items[] = "items";
static char __pyx_k__lcnum[] = "lcnum";
static char __pyx_k__limit[] = "limit";
static char __pyx_k__ncnum[] = "ncnum";
static char __pyx_k__order[] = "order";
static char __pyx_k__other[] = "other";
static char __pyx_k__range[] = "range";
static char __pyx_k__rcnum[] = "rcnum";
static char __pyx_k__table[] = "table";
static char __pyx_k__value[] = "value";
static char __pyx_k___state[] = "_state";
static char __pyx_k___throw[] = "_throw";
static char __pyx_k__delete[] = "delete";
static char __pyx_k__format[] = "format";
static char __pyx_k__invert[] = "invert";
static char __pyx_k__offset[] = "offset";
static char __pyx_k__select[] = "select";
static char __pyx_k__colname[] = "colname";
static char __pyx_k__default[] = "default";
static char __pyx_k__message[] = "message";
static char __pyx_k__size_of[] = "size_of";
static char __pyx_k__KeyError[] = "KeyError";
static char __pyx_k__TDBTBZIP[] = "TDBTBZIP";
static char __pyx_k__TDBTTCBS[] = "TDBTTCBS";
static char __pyx_k____main__[] = "__main__";
static char __pyx_k____name__[] = "__name__";
static char __pyx_k__callback[] = "callback";
static char __pyx_k__get_proc[] = "get_proc";
static char __pyx_k__idx_type[] = "idx_type";
static char __pyx_k__Exception[] = "Exception";
static char __pyx_k__TDBTLARGE[] = "TDBTLARGE";
static char __pyx_k____class__[] = "__class__";
static char __pyx_k__mmap_size[] = "mmap_size";
static char __pyx_k___set_limit[] = "_set_limit";
static char __pyx_k___set_order[] = "_set_order";
static char __pyx_k__basestring[] = "basestring";
static char __pyx_k__TCException[] = "TCException";
static char __pyx_k__TDBTDEFLATE[] = "TDBTDEFLATE";
static char __pyx_k__TDBTEXCODEC[] = "TDBTEXCODEC";
static char __pyx_k____version__[] = "__version__";
static char __pyx_k__keep_or_put[] = "keep_or_put";
static char __pyx_k__num_lookups[] = "num_lookups";
static char __pyx_k__values_only[] = "values_only";
static char __pyx_k___key_to_dict[] = "_key_to_dict";
static char __pyx_k__create_index[] = "create_index";
static char __pyx_k__StopIteration[] = "StopIteration";
static char __pyx_k___ckey_to_dict[] = "_ckey_to_dict";
static char __pyx_k___set_callback[] = "_set_callback";
static char __pyx_k___dict_to_tcmap[] = "_dict_to_tcmap";
static char __pyx_k___put_keep_code[] = "_put_keep_code";
static char __pyx_k___tcmap_to_dict[] = "_tcmap_to_dict";
static char __pyx_k___tclist_to_list[] = "_tclist_to_list";
static PyObject *__pyx_kp_s_1;
static PyObject *__pyx_kp_s_10;
static PyObject *__pyx_kp_s_11;
static PyObject *__pyx_kp_s_12;
static PyObject *__pyx_kp_s_13;
static PyObject *__pyx_kp_s_14;
static PyObject *__pyx_kp_s_15;
static PyObject *__pyx_kp_s_16;
static PyObject *__pyx_kp_s_17;
static PyObject *__pyx_kp_s_18;
static PyObject *__pyx_kp_s_19;
static PyObject *__pyx_kp_s_2;
static PyObject *__pyx_kp_s_20;
static PyObject *__pyx_n_s_22;
static PyObject *__pyx_kp_s_23;
static PyObject *__pyx_kp_s_24;
static PyObject *__pyx_kp_s_3;
static PyObject *__pyx_kp_s_4;
static PyObject *__pyx_kp_s_5;
static PyObject *__pyx_kp_s_6;
static PyObject *__pyx_kp_s_7;
static PyObject *__pyx_kp_s_8;
static PyObject *__pyx_kp_s_9;
static PyObject *__pyx_n_s__Exception;
static PyObject *__pyx_n_s__KeyError;
static PyObject *__pyx_n_s__StopIteration;
static PyObject *__pyx_n_s__TCException;
static PyObject *__pyx_n_s__TDBTBZIP;
static PyObject *__pyx_n_s__TDBTDEFLATE;
static PyObject *__pyx_n_s__TDBTEXCODEC;
static PyObject *__pyx_n_s__TDBTLARGE;
static PyObject *__pyx_n_s__TDBTTCBS;
static PyObject *__pyx_n_s____class__;
static PyObject *__pyx_n_s____main__;
static PyObject *__pyx_n_s____name__;
static PyObject *__pyx_n_s____version__;
static PyObject *__pyx_n_s___ckey_to_dict;
static PyObject *__pyx_n_s___dict_to_tcmap;
static PyObject *__pyx_n_s___key_to_dict;
static PyObject *__pyx_n_s___msg;
static PyObject *__pyx_n_s___put_keep_code;
static PyObject *__pyx_n_s___set_callback;
static PyObject *__pyx_n_s___set_limit;
static PyObject *__pyx_n_s___set_order;
static PyObject *__pyx_n_s___state;
static PyObject *__pyx_n_s___tclist_to_list;
static PyObject *__pyx_n_s___tcmap_to_dict;
static PyObject *__pyx_n_s___throw;
static PyObject *__pyx_n_s__apow;
static PyObject *__pyx_n_s__basestring;
static PyObject *__pyx_n_s__bnum;
static PyObject *__pyx_n_s__c;
static PyObject *__pyx_n_s__callback;
static PyObject *__pyx_n_s__colname;
static PyObject *__pyx_n_s__count;
static PyObject *__pyx_n_s__create_index;
static PyObject *__pyx_n_s__d;
static PyObject *__pyx_n_s__default;
static PyObject *__pyx_n_s__delete;
static PyObject *__pyx_n_s__exc;
static PyObject *__pyx_n_s__format;
static PyObject *__pyx_n_s__fpow;
static PyObject *__pyx_n_s__get;
static PyObject *__pyx_n_s__get_proc;
static PyObject *__pyx_n_s__high;
static PyObject *__pyx_n_s__idx_type;
static PyObject *__pyx_n_s__invert;
static PyObject *__pyx_n_s__items;
static PyObject *__pyx_n_s__join;
static PyObject *__pyx_n_s__k;
static PyObject *__pyx_n_s__keep;
static PyObject *__pyx_n_s__keep_or_put;
static PyObject *__pyx_n_s__key;
static PyObject *__pyx_n_s__lcnum;
static PyObject *__pyx_n_s__limit;
static PyObject *__pyx_n_s__low;
static PyObject *__pyx_n_s__map;
static PyObject *__pyx_n_s__message;
static PyObject *__pyx_n_s__mmap_size;
static PyObject *__pyx_n_s__mode;
static PyObject *__pyx_n_s__ncnum;
static PyObject *__pyx_n_s__num_lookups;
static PyObject *__pyx_n_s__o;
static PyObject *__pyx_n_s__offset;
static PyObject *__pyx_n_s__op;
static PyObject *__pyx_n_s__opts;
static PyObject *__pyx_n_s__order;
static PyObject *__pyx_n_s__other;
static PyObject *__pyx_n_s__p;
static PyObject *__pyx_n_s__path;
static PyObject *__pyx_n_s__pop;
static PyObject *__pyx_n_s__put;
static PyObject *__pyx_n_s__r;
static PyObject *__pyx_n_s__range;
static PyObject *__pyx_n_s__rcnum;
static PyObject *__pyx_n_s__s;
static PyObject *__pyx_n_s__select;
static PyObject *__pyx_n_s__size_of;
static PyObject *__pyx_n_s__t;
static PyObject *__pyx_n_s__table;
static PyObject *__pyx_n_s__type;
static PyObject *__pyx_n_s__v;
static PyObject *__pyx_n_s__value;
static PyObject *__pyx_n_s__values_only;
static PyObject *__pyx_n_s__w;
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_2;
static PyObject *__pyx_int_3;
static PyObject *__pyx_int_4;
static PyObject *__pyx_int_5;
static PyObject *__pyx_int_8;
static PyObject *__pyx_int_neg_1;
static PyObject *__pyx_int_16;

/* "/usr/local/src/totable/src/ctotable.pyx":47
 *     cdef readonly object mode
 * 
 *     def __repr__(self):             # <<<<<<<<<<<<<<
 *         c = self.__class__.__name__
 *         return "%s('%s')" % (c, self.path)
 */

static PyObject *__pyx_pf_8ctotable_7ToTable___repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable___repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_v_c;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("__repr__");
  __pyx_v_c = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":48
 * 
 *     def __repr__(self):
 *         c = self.__class__.__name__             # <<<<<<<<<<<<<<
 *         return "%s('%s')" % (c, self.path)
 * 
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s____class__); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s____name__); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_c);
  __pyx_v_c = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":49
 *     def __repr__(self):
 *         c = self.__class__.__name__
 *         return "%s('%s')" % (c, self.path)             # <<<<<<<<<<<<<<
 * 
 *     def _throw(self, message='Error.'):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_c);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_c);
  __Pyx_GIVEREF(__pyx_v_c);
  __Pyx_INCREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
  __Pyx_GIVEREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
  __pyx_t_1 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_1), __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("ctotable.ToTable.__repr__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_c);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":51
 *         return "%s('%s')" % (c, self.path)
 * 
 *     def _throw(self, message='Error.'):             # <<<<<<<<<<<<<<
 *         '''Raises a TCException, appending to *message* the last error message
 *         from the table database.
 */

static PyObject *__pyx_pf_8ctotable_7ToTable__throw(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8ctotable_7ToTable__throw[] = "Raises a TCException, appending to *message* the last error message\n        from the table database.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable__throw(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_message = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__message,0};
  __Pyx_RefNannySetupContext("_throw");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_kp_s_2);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__message);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_throw") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_message = values[0];
  } else {
    __pyx_v_message = ((PyObject *)__pyx_kp_s_2);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: __pyx_v_message = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_throw", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable._throw");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/usr/local/src/totable/src/ctotable.pyx":55
 *         from the table database.
 *         '''
 *         raise TCException(message + self._msg())             # <<<<<<<<<<<<<<
 * 
 *     cpdef _msg(ToTable self):
 */
  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__TCException); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_msg(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Add(__pyx_v_message, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_Raise(__pyx_t_3, 0, 0);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.ToTable._throw");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":57
 *         raise TCException(message + self._msg())
 * 
 *     cpdef _msg(ToTable self):             # <<<<<<<<<<<<<<
 *         '''Composes an error message for an exception, appending to the value
 *         of *message* the last error message from the table database.
 */

static PyObject *__pyx_pf_8ctotable_7ToTable__msg(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static  PyObject *__pyx_f_8ctotable_7ToTable__msg(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, int __pyx_skip_dispatch) {
  int __pyx_v_errorcode;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("_msg");
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s___msg); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_8ctotable_7ToTable__msg)) {
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":61
 *         of *message* the last error message from the table database.
 *         '''
 *         cdef int errorcode = tctdbecode(self._state)             # <<<<<<<<<<<<<<
 *         return tctdberrmsg(errorcode)
 * 
 */
  __pyx_v_errorcode = tctdbecode(__pyx_v_self->_state);

  /* "/usr/local/src/totable/src/ctotable.pyx":62
 *         '''
 *         cdef int errorcode = tctdbecode(self._state)
 *         return tctdberrmsg(errorcode)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBytes_FromString(tctdberrmsg(__pyx_v_errorcode)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("ctotable.ToTable._msg");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":57
 *         raise TCException(message + self._msg())
 * 
 *     cpdef _msg(ToTable self):             # <<<<<<<<<<<<<<
 *         '''Composes an error message for an exception, appending to the value
 *         of *message* the last error message from the table database.
 */

static PyObject *__pyx_pf_8ctotable_7ToTable__msg(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_8ctotable_7ToTable__msg[] = "Composes an error message for an exception, appending to the value\n        of *message* the last error message from the table database.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable__msg(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("_msg");
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_msg(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable._msg");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":65
 * 
 * 
 *     def optimize(self, int64_t bnum=-1, int8_t apow=-1, int8_t fpow=-1,             # <<<<<<<<<<<<<<
 *                  uint8_t opts=DEFAULT_OPTS):
 *         if self.mode != 'w':
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_optimize(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_optimize(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int64_t __pyx_v_bnum;
  int8_t __pyx_v_apow;
  int8_t __pyx_v_fpow;
  uint8_t __pyx_v_opts;
  int __pyx_v_success;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__bnum,&__pyx_n_s__apow,&__pyx_n_s__fpow,&__pyx_n_s__opts,0};
  __Pyx_RefNannySetupContext("optimize");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[4] = {0,0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bnum);
        if (unlikely(value)) { values[0] = value; kw_args--; }
      }
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__apow);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
      case  2:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fpow);
        if (unlikely(value)) { values[2] = value; kw_args--; }
      }
      case  3:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__opts);
        if (unlikely(value)) { values[3] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "optimize") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    if (values[0]) {
      __pyx_v_bnum = __Pyx_PyInt_from_py_int64_t(values[0]); if (unlikely((__pyx_v_bnum == (int64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_bnum = ((int64_t)-1);
    }
    if (values[1]) {
      __pyx_v_apow = __Pyx_PyInt_from_py_int8_t(values[1]); if (unlikely((__pyx_v_apow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_apow = ((int8_t)-1);
    }
    if (values[2]) {
      __pyx_v_fpow = __Pyx_PyInt_from_py_int8_t(values[2]); if (unlikely((__pyx_v_fpow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_fpow = ((int8_t)-1);
    }
    if (values[3]) {
      __pyx_v_opts = __Pyx_PyInt_from_py_uint8_t(values[3]); if (unlikely((__pyx_v_opts == (uint8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_opts = ((uint8_t)0);
    }
  } else {
    __pyx_v_bnum = ((int64_t)-1);
    __pyx_v_apow = ((int8_t)-1);
    __pyx_v_fpow = ((int8_t)-1);
    __pyx_v_opts = ((uint8_t)0);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  4: __pyx_v_opts = __Pyx_PyInt_from_py_uint8_t(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_opts == (uint8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  3: __pyx_v_fpow = __Pyx_PyInt_from_py_int8_t(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_fpow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  2: __pyx_v_apow = __Pyx_PyInt_from_py_int8_t(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_apow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  1: __pyx_v_bnum = __Pyx_PyInt_from_py_int64_t(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_bnum == (int64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("optimize", 0, 0, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.optimize");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/usr/local/src/totable/src/ctotable.pyx":67
 *     def optimize(self, int64_t bnum=-1, int8_t apow=-1, int8_t fpow=-1,
 *                  uint8_t opts=DEFAULT_OPTS):
 *         if self.mode != 'w':             # <<<<<<<<<<<<<<
 *             raise TCException('Unable optimize unless open with mode="w"')
 * 
 */
  __pyx_t_1 = PyObject_RichCompare(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->mode, ((PyObject *)__pyx_n_s__w), Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":68
 *                  uint8_t opts=DEFAULT_OPTS):
 *         if self.mode != 'w':
 *             raise TCException('Unable optimize unless open with mode="w"')             # <<<<<<<<<<<<<<
 * 
 *         cdef bint success = tctdboptimize(self._state, bnum, apow, fpow, opts)
 */
    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__TCException); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_s_3));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
    __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/usr/local/src/totable/src/ctotable.pyx":70
 *             raise TCException('Unable optimize unless open with mode="w"')
 * 
 *         cdef bint success = tctdboptimize(self._state, bnum, apow, fpow, opts)             # <<<<<<<<<<<<<<
 *         if not success:
 *             self._throw('Unable to optimize {0}.'.format(self.path))
 */
  __pyx_v_success = tctdboptimize(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_bnum, __pyx_v_apow, __pyx_v_fpow, __pyx_v_opts);

  /* "/usr/local/src/totable/src/ctotable.pyx":71
 * 
 *         cdef bint success = tctdboptimize(self._state, bnum, apow, fpow, opts)
 *         if not success:             # <<<<<<<<<<<<<<
 *             self._throw('Unable to optimize {0}.'.format(self.path))
 *         return success
 */
  __pyx_t_2 = (!__pyx_v_success);
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":72
 *         cdef bint success = tctdboptimize(self._state, bnum, apow, fpow, opts)
 *         if not success:
 *             self._throw('Unable to optimize {0}.'.format(self.path))             # <<<<<<<<<<<<<<
 *         return success
 * 
 */
    __pyx_t_4 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_4), __pyx_n_s__format); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
    __Pyx_GIVEREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
    __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/usr/local/src/totable/src/ctotable.pyx":73
 *         if not success:
 *             self._throw('Unable to optimize {0}.'.format(self.path))
 *         return success             # <<<<<<<<<<<<<<
 * 
 *     def clear(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = __Pyx_PyBool_FromLong(__pyx_v_success); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("ctotable.ToTable.optimize");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":75
 *         return success
 * 
 *     def clear(self):             # <<<<<<<<<<<<<<
 *         cdef bint success = tctdbvanish(self._state)
 *         if not success:
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_clear(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_clear(PyObject *__pyx_v_self, PyObject *unused) {
  int __pyx_v_success;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("clear");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/usr/local/src/totable/src/ctotable.pyx":76
 * 
 *     def clear(self):
 *         cdef bint success = tctdbvanish(self._state)             # <<<<<<<<<<<<<<
 *         if not success:
 *             self._throw('Unable clear {0}'.format(self.path))
 */
  __pyx_v_success = tctdbvanish(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state);

  /* "/usr/local/src/totable/src/ctotable.pyx":77
 *     def clear(self):
 *         cdef bint success = tctdbvanish(self._state)
 *         if not success:             # <<<<<<<<<<<<<<
 *             self._throw('Unable clear {0}'.format(self.path))
 * 
 */
  __pyx_t_1 = (!__pyx_v_success);
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":78
 *         cdef bint success = tctdbvanish(self._state)
 *         if not success:
 *             self._throw('Unable clear {0}'.format(self.path))             # <<<<<<<<<<<<<<
 * 
 *     def __cinit__(self, path, mode='r',
 */
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_5), __pyx_n_s__format); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
    PyTuple_SET_ITEM(__pyx_t_4, 0, ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
    __Pyx_GIVEREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
    __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("ctotable.ToTable.clear");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":80
 *             self._throw('Unable clear {0}'.format(self.path))
 * 
 *     def __cinit__(self, path, mode='r',             # <<<<<<<<<<<<<<
 *                  # tune params.
 *                  int64_t bnum=-1, int8_t apow=-1,
 */

static int __pyx_pf_8ctotable_7ToTable___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8ctotable_7ToTable___cinit__[] = "\n        'bnum' specifies the number of elements of the bucket array. If it is not more than 0, the default value is specified. The default value is 131071. Suggested size of the bucket array is about from 0.5 to 4 times of the number of all records to be stored.\n        'apow' specifies the size of record alignment by power of 2. If it is negative, the default value is specified. The default value is 4 standing for 2^4=16.\n        'fpow' specifies the maximum number of elements of the free block pool by power of 2. If it is negative, the default value is specified. The default value is 10 standing for 2^10=1024.\n        'opts' specifies options by bitwise-or: `TDBTLARGE' specifies that the size of the database can be larger than 2GB by using 64-bit bucket array, `TDBTDEFLATE' specifies that each record is compressed with Deflate encoding, `TDBTBZIP' specifies that each record is compressed with BZIP2 encoding, `TDBTTCBS' specifies that each record is compressed with TCBS encoding.\n        'mmap_size' is the size of mapped memory. default is 67,108,864 (64MB)\n        'rcnum' is the max number of records to be cached. default is 0\n        'lcnum' is the max number of leaf-nodes to be cached. default is 4096\n        'ncnum' is the max number of non-leaf nodes cached. default is 512\n        ";
static int __pyx_pf_8ctotable_7ToTable___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_path = 0;
  PyObject *__pyx_v_mode = 0;
  int64_t __pyx_v_bnum;
  int8_t __pyx_v_apow;
  int8_t __pyx_v_fpow;
  uint8_t __pyx_v_opts;
  int64_t __pyx_v_mmap_size;
  int32_t __pyx_v_rcnum;
  int32_t __pyx_v_lcnum;
  int32_t __pyx_v_ncnum;
  int __pyx_v_success;
  int __pyx_r;
  int __pyx_t_1;
  int __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  char *__pyx_t_10;
  long __pyx_t_11;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__path,&__pyx_n_s__mode,&__pyx_n_s__bnum,&__pyx_n_s__apow,&__pyx_n_s__fpow,&__pyx_n_s__opts,&__pyx_n_s__mmap_size,&__pyx_n_s__rcnum,&__pyx_n_s__lcnum,&__pyx_n_s__ncnum,0};
  __Pyx_RefNannySetupContext("__cinit__");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[10] = {0,0,0,0,0,0,0,0,0,0};
    values[1] = ((PyObject *)__pyx_n_s__r);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
      case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
      case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
      case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
      case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__path);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mode);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
      case  2:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bnum);
        if (unlikely(value)) { values[2] = value; kw_args--; }
      }
      case  3:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__apow);
        if (unlikely(value)) { values[3] = value; kw_args--; }
      }
      case  4:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__fpow);
        if (unlikely(value)) { values[4] = value; kw_args--; }
      }
      case  5:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__opts);
        if (unlikely(value)) { values[5] = value; kw_args--; }
      }
      case  6:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mmap_size);
        if (unlikely(value)) { values[6] = value; kw_args--; }
      }
      case  7:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__rcnum);
        if (unlikely(value)) { values[7] = value; kw_args--; }
      }
      case  8:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__lcnum);
        if (unlikely(value)) { values[8] = value; kw_args--; }
      }
      case  9:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ncnum);
        if (unlikely(value)) { values[9] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__cinit__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_path = values[0];
    __pyx_v_mode = values[1];
    if (values[2]) {
      __pyx_v_bnum = __Pyx_PyInt_from_py_int64_t(values[2]); if (unlikely((__pyx_v_bnum == (int64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_bnum = ((int64_t)-1);
    }
    if (values[3]) {
      __pyx_v_apow = __Pyx_PyInt_from_py_int8_t(values[3]); if (unlikely((__pyx_v_apow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_apow = ((int8_t)-1);
    }
    if (values[4]) {
      __pyx_v_fpow = __Pyx_PyInt_from_py_int8_t(values[4]); if (unlikely((__pyx_v_fpow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_fpow = ((int8_t)-1);
    }
    if (values[5]) {
      __pyx_v_opts = __Pyx_PyInt_from_py_uint8_t(values[5]); if (unlikely((__pyx_v_opts == (uint8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_opts = ((uint8_t)0);
    }
    if (values[6]) {
      __pyx_v_mmap_size = __Pyx_PyInt_from_py_int64_t(values[6]); if (unlikely((__pyx_v_mmap_size == (int64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_mmap_size = ((int64_t)-1);
    }
    if (values[7]) {
      __pyx_v_rcnum = __Pyx_PyInt_from_py_int32_t(values[7]); if (unlikely((__pyx_v_rcnum == (int32_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_rcnum = ((int32_t)-1);
    }
    if (values[8]) {
      __pyx_v_lcnum = __Pyx_PyInt_from_py_int32_t(values[8]); if (unlikely((__pyx_v_lcnum == (int32_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_lcnum = ((int32_t)-1);
    }
    if (values[9]) {
      __pyx_v_ncnum = __Pyx_PyInt_from_py_int32_t(values[9]); if (unlikely((__pyx_v_ncnum == (int32_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_ncnum = ((int32_t)-1);
    }
  } else {
    __pyx_v_mode = ((PyObject *)__pyx_n_s__r);
    __pyx_v_bnum = ((int64_t)-1);
    __pyx_v_apow = ((int8_t)-1);
    __pyx_v_fpow = ((int8_t)-1);
    __pyx_v_opts = ((uint8_t)0);
    __pyx_v_mmap_size = ((int64_t)-1);
    __pyx_v_rcnum = ((int32_t)-1);
    __pyx_v_lcnum = ((int32_t)-1);
    __pyx_v_ncnum = ((int32_t)-1);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case 10: __pyx_v_ncnum = __Pyx_PyInt_from_py_int32_t(PyTuple_GET_ITEM(__pyx_args, 9)); if (unlikely((__pyx_v_ncnum == (int32_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  9: __pyx_v_lcnum = __Pyx_PyInt_from_py_int32_t(PyTuple_GET_ITEM(__pyx_args, 8)); if (unlikely((__pyx_v_lcnum == (int32_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  8: __pyx_v_rcnum = __Pyx_PyInt_from_py_int32_t(PyTuple_GET_ITEM(__pyx_args, 7)); if (unlikely((__pyx_v_rcnum == (int32_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  7: __pyx_v_mmap_size = __Pyx_PyInt_from_py_int64_t(PyTuple_GET_ITEM(__pyx_args, 6)); if (unlikely((__pyx_v_mmap_size == (int64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  6: __pyx_v_opts = __Pyx_PyInt_from_py_uint8_t(PyTuple_GET_ITEM(__pyx_args, 5)); if (unlikely((__pyx_v_opts == (uint8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  5: __pyx_v_fpow = __Pyx_PyInt_from_py_int8_t(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_fpow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  4: __pyx_v_apow = __Pyx_PyInt_from_py_int8_t(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_apow == (int8_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  3: __pyx_v_bnum = __Pyx_PyInt_from_py_int64_t(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_bnum == (int64_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      case  2: __pyx_v_mode = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: __pyx_v_path = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 1, 10, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.__cinit__");
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_path);
  __Pyx_INCREF(__pyx_v_mode);

  /* "/usr/local/src/totable/src/ctotable.pyx":98
 *         'ncnum' is the max number of non-leaf nodes cached. default is 512
 *         """
 *         self.path = path             # <<<<<<<<<<<<<<
 *         self.mode = mode
 *         cdef bint success
 */
  __Pyx_INCREF(__pyx_v_path);
  __Pyx_GIVEREF(__pyx_v_path);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
  ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path = __pyx_v_path;

  /* "/usr/local/src/totable/src/ctotable.pyx":99
 *         """
 *         self.path = path
 *         self.mode = mode             # <<<<<<<<<<<<<<
 *         cdef bint success
 *         self._state = tctdbnew()
 */
  __Pyx_INCREF(__pyx_v_mode);
  __Pyx_GIVEREF(__pyx_v_mode);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->mode);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->mode);
  ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->mode = __pyx_v_mode;

  /* "/usr/local/src/totable/src/ctotable.pyx":101
 *         self.mode = mode
 *         cdef bint success
 *         self._state = tctdbnew()             # <<<<<<<<<<<<<<
 *         if bnum != -1 or apow != -1 or fpow != -1 or opts != DEFAULT_OPTS:
 *             success = tctdbtune(self._state, bnum, apow, fpow, opts)
 */
  ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state = tctdbnew();

  /* "/usr/local/src/totable/src/ctotable.pyx":102
 *         cdef bint success
 *         self._state = tctdbnew()
 *         if bnum != -1 or apow != -1 or fpow != -1 or opts != DEFAULT_OPTS:             # <<<<<<<<<<<<<<
 *             success = tctdbtune(self._state, bnum, apow, fpow, opts)
 *             if not success:
 */
  __pyx_t_1 = (__pyx_v_bnum != -1);
  if (!__pyx_t_1) {
    __pyx_t_2 = (__pyx_v_apow != -1);
    if (!__pyx_t_2) {
      __pyx_t_3 = (__pyx_v_fpow != -1);
      if (!__pyx_t_3) {
        __pyx_t_4 = (__pyx_v_opts != 0);
        __pyx_t_5 = __pyx_t_4;
      } else {
        __pyx_t_5 = __pyx_t_3;
      }
      __pyx_t_3 = __pyx_t_5;
    } else {
      __pyx_t_3 = __pyx_t_2;
    }
    __pyx_t_2 = __pyx_t_3;
  } else {
    __pyx_t_2 = __pyx_t_1;
  }
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":103
 *         self._state = tctdbnew()
 *         if bnum != -1 or apow != -1 or fpow != -1 or opts != DEFAULT_OPTS:
 *             success = tctdbtune(self._state, bnum, apow, fpow, opts)             # <<<<<<<<<<<<<<
 *             if not success:
 *                 self._throw('Unable to tune {0}.'.format(str(path)))
 */
    __pyx_v_success = tctdbtune(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_bnum, __pyx_v_apow, __pyx_v_fpow, __pyx_v_opts);

    /* "/usr/local/src/totable/src/ctotable.pyx":104
 *         if bnum != -1 or apow != -1 or fpow != -1 or opts != DEFAULT_OPTS:
 *             success = tctdbtune(self._state, bnum, apow, fpow, opts)
 *             if not success:             # <<<<<<<<<<<<<<
 *                 self._throw('Unable to tune {0}.'.format(str(path)))
 *         if mmap_size != -1:
 */
    __pyx_t_2 = (!__pyx_v_success);
    if (__pyx_t_2) {

      /* "/usr/local/src/totable/src/ctotable.pyx":105
 *             success = tctdbtune(self._state, bnum, apow, fpow, opts)
 *             if not success:
 *                 self._throw('Unable to tune {0}.'.format(str(path)))             # <<<<<<<<<<<<<<
 *         if mmap_size != -1:
 *             success = tctdbsetxmsiz(self._state, mmap_size)
 */
      __pyx_t_6 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_6), __pyx_n_s__format); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_INCREF(__pyx_v_path);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_path);
      __Pyx_GIVEREF(__pyx_v_path);
      __pyx_t_9 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_8, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_9 = PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_9 = PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/usr/local/src/totable/src/ctotable.pyx":106
 *             if not success:
 *                 self._throw('Unable to tune {0}.'.format(str(path)))
 *         if mmap_size != -1:             # <<<<<<<<<<<<<<
 *             success = tctdbsetxmsiz(self._state, mmap_size)
 *             if not success:
 */
  __pyx_t_2 = (__pyx_v_mmap_size != -1);
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":107
 *                 self._throw('Unable to tune {0}.'.format(str(path)))
 *         if mmap_size != -1:
 *             success = tctdbsetxmsiz(self._state, mmap_size)             # <<<<<<<<<<<<<<
 *             if not success:
 *                 self._throw('Unable to set mmap size {0}.'.format(path))
 */
    __pyx_v_success = tctdbsetxmsiz(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_mmap_size);

    /* "/usr/local/src/totable/src/ctotable.pyx":108
 *         if mmap_size != -1:
 *             success = tctdbsetxmsiz(self._state, mmap_size)
 *             if not success:             # <<<<<<<<<<<<<<
 *                 self._throw('Unable to set mmap size {0}.'.format(path))
 *         if rcnum > -1 or lcnum > -1 or ncnum > -1:
 */
    __pyx_t_2 = (!__pyx_v_success);
    if (__pyx_t_2) {

      /* "/usr/local/src/totable/src/ctotable.pyx":109
 *             success = tctdbsetxmsiz(self._state, mmap_size)
 *             if not success:
 *                 self._throw('Unable to set mmap size {0}.'.format(path))             # <<<<<<<<<<<<<<
 *         if rcnum > -1 or lcnum > -1 or ncnum > -1:
 *             success = tctdbsetcache(self._state, rcnum, lcnum, ncnum)
 */
      __pyx_t_9 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_8 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_7), __pyx_n_s__format); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_v_path);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_path);
      __Pyx_GIVEREF(__pyx_v_path);
      __pyx_t_7 = PyObject_Call(__pyx_t_8, __pyx_t_6, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_7 = PyObject_Call(__pyx_t_9, __pyx_t_6, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L9;
    }
    __pyx_L9:;
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/usr/local/src/totable/src/ctotable.pyx":110
 *             if not success:
 *                 self._throw('Unable to set mmap size {0}.'.format(path))
 *         if rcnum > -1 or lcnum > -1 or ncnum > -1:             # <<<<<<<<<<<<<<
 *             success = tctdbsetcache(self._state, rcnum, lcnum, ncnum)
 *             if not success:
 */
  __pyx_t_2 = (__pyx_v_rcnum > -1);
  if (!__pyx_t_2) {
    __pyx_t_1 = (__pyx_v_lcnum > -1);
    if (!__pyx_t_1) {
      __pyx_t_3 = (__pyx_v_ncnum > -1);
      __pyx_t_5 = __pyx_t_3;
    } else {
      __pyx_t_5 = __pyx_t_1;
    }
    __pyx_t_1 = __pyx_t_5;
  } else {
    __pyx_t_1 = __pyx_t_2;
  }
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":111
 *                 self._throw('Unable to set mmap size {0}.'.format(path))
 *         if rcnum > -1 or lcnum > -1 or ncnum > -1:
 *             success = tctdbsetcache(self._state, rcnum, lcnum, ncnum)             # <<<<<<<<<<<<<<
 *             if not success:
 *                 self._throw('Unable to setcache {0}.'.format(self.path))
 */
    __pyx_v_success = tctdbsetcache(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_rcnum, __pyx_v_lcnum, __pyx_v_ncnum);

    /* "/usr/local/src/totable/src/ctotable.pyx":112
 *         if rcnum > -1 or lcnum > -1 or ncnum > -1:
 *             success = tctdbsetcache(self._state, rcnum, lcnum, ncnum)
 *             if not success:             # <<<<<<<<<<<<<<
 *                 self._throw('Unable to setcache {0}.'.format(self.path))
 * 
 */
    __pyx_t_1 = (!__pyx_v_success);
    if (__pyx_t_1) {

      /* "/usr/local/src/totable/src/ctotable.pyx":113
 *             success = tctdbsetcache(self._state, rcnum, lcnum, ncnum)
 *             if not success:
 *                 self._throw('Unable to setcache {0}.'.format(self.path))             # <<<<<<<<<<<<<<
 * 
 *         success = tctdbopen(self._state, path, 6 if mode=='w' else 1)
 */
      __pyx_t_7 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_8), __pyx_n_s__format); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_INCREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
      PyTuple_SET_ITEM(__pyx_t_9, 0, ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
      __Pyx_GIVEREF(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->path);
      __pyx_t_8 = PyObject_Call(__pyx_t_6, __pyx_t_9, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      __pyx_t_8 = 0;
      __pyx_t_8 = PyObject_Call(__pyx_t_7, __pyx_t_9, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      goto __pyx_L11;
    }
    __pyx_L11:;
    goto __pyx_L10;
  }
  __pyx_L10:;

  /* "/usr/local/src/totable/src/ctotable.pyx":115
 *                 self._throw('Unable to setcache {0}.'.format(self.path))
 * 
 *         success = tctdbopen(self._state, path, 6 if mode=='w' else 1)             # <<<<<<<<<<<<<<
 *         if not success:
 *             self._throw('Unable to open {0} for {1}.'.format(str(path)))
 */
  __pyx_t_10 = __Pyx_PyBytes_AsString(__pyx_v_path); if (unlikely((!__pyx_t_10) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_8 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__w), Py_EQ); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (__pyx_t_1) {
    __pyx_t_11 = 6;
  } else {
    __pyx_t_11 = 1;
  }
  __pyx_v_success = tctdbopen(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_t_10, __pyx_t_11);

  /* "/usr/local/src/totable/src/ctotable.pyx":116
 * 
 *         success = tctdbopen(self._state, path, 6 if mode=='w' else 1)
 *         if not success:             # <<<<<<<<<<<<<<
 *             self._throw('Unable to open {0} for {1}.'.format(str(path)))
 * 
 */
  __pyx_t_1 = (!__pyx_v_success);
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":117
 *         success = tctdbopen(self._state, path, 6 if mode=='w' else 1)
 *         if not success:
 *             self._throw('Unable to open {0} for {1}.'.format(str(path)))             # <<<<<<<<<<<<<<
 * 
 *     def close(self):
 */
    __pyx_t_8 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_9), __pyx_n_s__format); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_v_path);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_path);
    __Pyx_GIVEREF(__pyx_v_path);
    __pyx_t_6 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(__pyx_t_9, __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = PyObject_Call(__pyx_t_8, __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L12;
  }
  __pyx_L12:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("ctotable.ToTable.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_path);
  __Pyx_DECREF(__pyx_v_mode);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":119
 *             self._throw('Unable to open {0} for {1}.'.format(str(path)))
 * 
 *     def close(self):             # <<<<<<<<<<<<<<
 *         '''Closes the database file and cleans memory, rendering this
 *         object useless.
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_close(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_close[] = "Closes the database file and cleans memory, rendering this\n        object useless.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable_close(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("close");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/usr/local/src/totable/src/ctotable.pyx":123
 *         object useless.
 *         '''
 *         if not self._state == NULL:             # <<<<<<<<<<<<<<
 *             tctdbdel(self._state)
 *             self._state = NULL
 */
  __pyx_t_1 = (!(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state == NULL));
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":124
 *         '''
 *         if not self._state == NULL:
 *             tctdbdel(self._state)             # <<<<<<<<<<<<<<
 *             self._state = NULL
 * 
 */
    tctdbdel(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state);

    /* "/usr/local/src/totable/src/ctotable.pyx":125
 *         if not self._state == NULL:
 *             tctdbdel(self._state)
 *             self._state = NULL             # <<<<<<<<<<<<<<
 * 
 *     cdef TCMAP* _dict_to_tcmap(self, dict d):
 */
    ((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state = NULL;
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":127
 *             self._state = NULL
 * 
 *     cdef TCMAP* _dict_to_tcmap(self, dict d):             # <<<<<<<<<<<<<<
 *         """INTERNAL: take a dict and return the tcmap which must
 *         be deleted with tcmapdel(tcmap)
 */

static  TCMAP *__pyx_f_8ctotable_7ToTable__dict_to_tcmap(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, PyObject *__pyx_v_d) {
  char *__pyx_v_kbuf;
  char *__pyx_v_vbuf;
  Py_ssize_t __pyx_v_ksiz;
  Py_ssize_t __pyx_v_vsiz;
  TCMAP *__pyx_v_tcmap;
  int __pyx_v_ld;
  PyObject *__pyx_v_key;
  PyObject *__pyx_v_val;
  TCMAP *__pyx_r;
  Py_ssize_t __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("_dict_to_tcmap");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_d);
  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_val = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":134
 *         cdef Py_ssize_t ksiz, vsiz
 *         cdef TCMAP *tcmap
 *         cdef int ld = len(d)             # <<<<<<<<<<<<<<
 *         tcmap = tcmapnew2(ld)
 * 
 */
  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_d)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_ld = __pyx_t_1;

  /* "/usr/local/src/totable/src/ctotable.pyx":135
 *         cdef TCMAP *tcmap
 *         cdef int ld = len(d)
 *         tcmap = tcmapnew2(ld)             # <<<<<<<<<<<<<<
 * 
 *         for key, val in d.items():
 */
  __pyx_v_tcmap = tcmapnew2(__pyx_v_ld);

  /* "/usr/local/src/totable/src/ctotable.pyx":137
 *         tcmap = tcmapnew2(ld)
 * 
 *         for key, val in d.items():             # <<<<<<<<<<<<<<
 *             ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *             ps.PyString_AsStringAndSize(val, &vbuf, &vsiz)
 */
  __pyx_t_2 = PyDict_Items(((PyObject *)__pyx_v_d)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyList_CheckExact(__pyx_t_2) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = 0; __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3);
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_3))) {
      if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_2); __pyx_t_1++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_3))) {
      if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
      __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_2); __pyx_t_1++;
    } else {
      __pyx_t_2 = PyIter_Next(__pyx_t_3);
      if (!__pyx_t_2) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (PyTuple_CheckExact(__pyx_t_2) && likely(PyTuple_GET_SIZE(__pyx_t_2) == 2)) {
      PyObject* tuple = __pyx_t_2;
      __pyx_t_4 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_4);
      __pyx_t_5 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_v_key);
      __pyx_v_key = __pyx_t_4;
      __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_v_val);
      __pyx_v_val = __pyx_t_5;
      __pyx_t_5 = 0;
    } else {
      __pyx_t_6 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_4 = __Pyx_UnpackItem(__pyx_t_6, 0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_UnpackItem(__pyx_t_6, 1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (__Pyx_EndUnpack(__pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_v_key);
      __pyx_v_key = __pyx_t_4;
      __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_v_val);
      __pyx_v_val = __pyx_t_5;
      __pyx_t_5 = 0;
    }

    /* "/usr/local/src/totable/src/ctotable.pyx":138
 * 
 *         for key, val in d.items():
 *             ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)             # <<<<<<<<<<<<<<
 *             ps.PyString_AsStringAndSize(val, &vbuf, &vsiz)
 *             tcmapput(tcmap, kbuf, ksiz, vbuf, vsiz)
 */
    __pyx_t_7 = PyString_AsStringAndSize(__pyx_v_key, (&__pyx_v_kbuf), (&__pyx_v_ksiz)); if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/usr/local/src/totable/src/ctotable.pyx":139
 *         for key, val in d.items():
 *             ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *             ps.PyString_AsStringAndSize(val, &vbuf, &vsiz)             # <<<<<<<<<<<<<<
 *             tcmapput(tcmap, kbuf, ksiz, vbuf, vsiz)
 *         return tcmap
 */
    __pyx_t_7 = PyString_AsStringAndSize(__pyx_v_val, (&__pyx_v_vbuf), (&__pyx_v_vsiz)); if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/usr/local/src/totable/src/ctotable.pyx":140
 *             ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *             ps.PyString_AsStringAndSize(val, &vbuf, &vsiz)
 *             tcmapput(tcmap, kbuf, ksiz, vbuf, vsiz)             # <<<<<<<<<<<<<<
 *         return tcmap
 * 
 */
    tcmapput(__pyx_v_tcmap, __pyx_v_kbuf, __pyx_v_ksiz, __pyx_v_vbuf, __pyx_v_vsiz);
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":141
 *             ps.PyString_AsStringAndSize(val, &vbuf, &vsiz)
 *             tcmapput(tcmap, kbuf, ksiz, vbuf, vsiz)
 *         return tcmap             # <<<<<<<<<<<<<<
 * 
 *     def optimize_index(self, colname):
 */
  __pyx_r = __pyx_v_tcmap;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_WriteUnraisable("ctotable.ToTable._dict_to_tcmap");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_DECREF(__pyx_v_val);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_d);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":143
 *         return tcmap
 * 
 *     def optimize_index(self, colname):             # <<<<<<<<<<<<<<
 *         return self.create_index(colname, 'o')
 *     def delete_index(self, colname):
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_optimize_index(PyObject *__pyx_v_self, PyObject *__pyx_v_colname); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_optimize_index(PyObject *__pyx_v_self, PyObject *__pyx_v_colname) {
  PyObject *__pyx_r = NULL;
  char *__pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("optimize_index");

  /* "/usr/local/src/totable/src/ctotable.pyx":144
 * 
 *     def optimize_index(self, colname):
 *         return self.create_index(colname, 'o')             # <<<<<<<<<<<<<<
 *     def delete_index(self, colname):
 *         return self.create_index(colname, 'v')
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBytes_AsString(__pyx_v_colname); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = __Pyx_PyBool_FromLong(((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->create_index(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_t_1, ((PyObject *)__pyx_n_s__o), 0)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("ctotable.ToTable.optimize_index");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":145
 *     def optimize_index(self, colname):
 *         return self.create_index(colname, 'o')
 *     def delete_index(self, colname):             # <<<<<<<<<<<<<<
 *         return self.create_index(colname, 'v')
 * 
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_delete_index(PyObject *__pyx_v_self, PyObject *__pyx_v_colname); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_delete_index(PyObject *__pyx_v_self, PyObject *__pyx_v_colname) {
  PyObject *__pyx_r = NULL;
  char *__pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("delete_index");

  /* "/usr/local/src/totable/src/ctotable.pyx":146
 *         return self.create_index(colname, 'o')
 *     def delete_index(self, colname):
 *         return self.create_index(colname, 'v')             # <<<<<<<<<<<<<<
 * 
 *     cpdef bint create_index(ToTable self, char* colname, idx_type):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBytes_AsString(__pyx_v_colname); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = __Pyx_PyBool_FromLong(((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->create_index(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_t_1, ((PyObject *)__pyx_n_s__v), 0)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("ctotable.ToTable.delete_index");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":148
 *         return self.create_index(colname, 'v')
 * 
 *     cpdef bint create_index(ToTable self, char* colname, idx_type):             # <<<<<<<<<<<<<<
 *         """
 *         idx_type is one of:
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_create_index(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static  int __pyx_f_8ctotable_7ToTable_create_index(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, char *__pyx_v_colname, PyObject *__pyx_v_idx_type, int __pyx_skip_dispatch) {
  PyObject *__pyx_v_idx_lookup;
  int __pyx_v_type;
  int __pyx_r;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("create_index");
  __pyx_v_idx_lookup = Py_None; __Pyx_INCREF(Py_None);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__create_index); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_8ctotable_7ToTable_create_index)) {
      __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_colname); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_v_idx_type);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_idx_type);
      __Pyx_GIVEREF(__pyx_v_idx_type);
      __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_4;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":154
 *         or 'd' for index on a decimal number.
 *         """
 *         idx_lookup = {'s': TDBITLEXICAL, 'd': TDBITDECIMAL,             # <<<<<<<<<<<<<<
 *                       'o': TDBITOPT, 'v': TDBITVOID }
 *         cdef int type = idx_lookup[idx_type]
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_2 = PyInt_FromLong(TDBITLEXICAL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__s), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyInt_FromLong(TDBITDECIMAL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__d), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":155
 *         """
 *         idx_lookup = {'s': TDBITLEXICAL, 'd': TDBITDECIMAL,
 *                       'o': TDBITOPT, 'v': TDBITVOID }             # <<<<<<<<<<<<<<
 *         cdef int type = idx_lookup[idx_type]
 *         return tctdbsetindex(self._state, colname, type)
 */
  __pyx_t_2 = PyInt_FromLong(TDBITOPT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__o), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyInt_FromLong(TDBITVOID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__v), __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_idx_lookup);
  __pyx_v_idx_lookup = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":156
 *         idx_lookup = {'s': TDBITLEXICAL, 'd': TDBITDECIMAL,
 *                       'o': TDBITOPT, 'v': TDBITVOID }
 *         cdef int type = idx_lookup[idx_type]             # <<<<<<<<<<<<<<
 *         return tctdbsetindex(self._state, colname, type)
 * 
 */
  __pyx_t_1 = PyObject_GetItem(__pyx_v_idx_lookup, __pyx_v_idx_type); if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_type = __pyx_t_5;

  /* "/usr/local/src/totable/src/ctotable.pyx":157
 *                       'o': TDBITOPT, 'v': TDBITVOID }
 *         cdef int type = idx_lookup[idx_type]
 *         return tctdbsetindex(self._state, colname, type)             # <<<<<<<<<<<<<<
 * 
 *     def put(ToTable self, k, dict d, mode='p'):
 */
  __pyx_r = tctdbsetindex(__pyx_v_self->_state, __pyx_v_colname, __pyx_v_type);
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("ctotable.ToTable.create_index");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_idx_lookup);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":148
 *         return self.create_index(colname, 'v')
 * 
 *     cpdef bint create_index(ToTable self, char* colname, idx_type):             # <<<<<<<<<<<<<<
 *         """
 *         idx_type is one of:
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_create_index(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_create_index[] = "\n        idx_type is one of:\n           's' for index on a string\n        or 'd' for index on a decimal number.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable_create_index(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  char *__pyx_v_colname;
  PyObject *__pyx_v_idx_type = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__colname,&__pyx_n_s__idx_type,0};
  __Pyx_RefNannySetupContext("create_index");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__colname);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__idx_type);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("create_index", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "create_index") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_colname = __Pyx_PyBytes_AsString(values[0]); if (unlikely((!__pyx_v_colname) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_idx_type = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_colname = __Pyx_PyBytes_AsString(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((!__pyx_v_colname) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_idx_type = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("create_index", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.create_index");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBool_FromLong(((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->create_index(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_colname, __pyx_v_idx_type, 1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable.create_index");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":159
 *         return tctdbsetindex(self._state, colname, type)
 * 
 *     def put(ToTable self, k, dict d, mode='p'):             # <<<<<<<<<<<<<<
 *         """ mode is one of p, k, c
 *         'c' is put cat, which adds items to an existing dict.
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_put(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_put[] = " mode is one of p, k, c\n        'c' is put cat, which adds items to an existing dict.\n        'p' is put just writes to the key without regard for what's there\n        'k' will only put the new data if there is nothing currently at\n            that key.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable_put(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_k = 0;
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_v_mode = 0;
  TCMAP *__pyx_v_tcmap;
  char *__pyx_v_kbuf;
  Py_ssize_t __pyx_v_ksiz;
  int __pyx_v_success;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__k,&__pyx_n_s__d,&__pyx_n_s__mode,0};
  __Pyx_RefNannySetupContext("put");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)__pyx_n_s__p);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__k);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__d);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("put", 0, 2, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mode);
        if (unlikely(value)) { values[2] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "put") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_k = values[0];
    __pyx_v_d = ((PyObject *)values[1]);
    __pyx_v_mode = values[2];
  } else {
    __pyx_v_mode = ((PyObject *)__pyx_n_s__p);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3:
      __pyx_v_mode = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2:
      __pyx_v_d = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 1));
      __pyx_v_k = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("put", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.put");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_k);
  __Pyx_INCREF(__pyx_v_d);
  __Pyx_INCREF(__pyx_v_mode);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_d), &PyDict_Type, 1, "d", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":167
 *         """
 * 
 *         cdef TCMAP * tcmap = self._dict_to_tcmap(d)             # <<<<<<<<<<<<<<
 *         cdef char *kbuf
 *         cdef Py_ssize_t ksiz
 */
  __pyx_v_tcmap = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_dict_to_tcmap(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_d);

  /* "/usr/local/src/totable/src/ctotable.pyx":171
 *         cdef Py_ssize_t ksiz
 *         cdef bint success
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)             # <<<<<<<<<<<<<<
 *         if mode == 'c':
 *             success = tctdbputcat(self._state, kbuf, <int>ksiz, tcmap)
 */
  __pyx_t_1 = PyString_AsStringAndSize(__pyx_v_k, (&__pyx_v_kbuf), (&__pyx_v_ksiz)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":172
 *         cdef bint success
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)
 *         if mode == 'c':             # <<<<<<<<<<<<<<
 *             success = tctdbputcat(self._state, kbuf, <int>ksiz, tcmap)
 *             if not success:
 */
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__c), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "/usr/local/src/totable/src/ctotable.pyx":173
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)
 *         if mode == 'c':
 *             success = tctdbputcat(self._state, kbuf, <int>ksiz, tcmap)             # <<<<<<<<<<<<<<
 *             if not success:
 *                 if not k in d:
 */
    __pyx_v_success = tctdbputcat(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_kbuf, ((int)__pyx_v_ksiz), __pyx_v_tcmap);

    /* "/usr/local/src/totable/src/ctotable.pyx":174
 *         if mode == 'c':
 *             success = tctdbputcat(self._state, kbuf, <int>ksiz, tcmap)
 *             if not success:             # <<<<<<<<<<<<<<
 *                 if not k in d:
 *                     self._throw('Error: attempting to add to '\
 */
    __pyx_t_3 = (!__pyx_v_success);
    if (__pyx_t_3) {

      /* "/usr/local/src/totable/src/ctotable.pyx":175
 *             success = tctdbputcat(self._state, kbuf, <int>ksiz, tcmap)
 *             if not success:
 *                 if not k in d:             # <<<<<<<<<<<<<<
 *                     self._throw('Error: attempting to add to '\
 *                             'non-existing key: %s' % k)
 */
      if (unlikely(((PyObject *)__pyx_v_d) == Py_None)) {
        __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      } else {
        __pyx_t_3 = ((PyDict_Contains(((PyObject *)__pyx_v_d), __pyx_v_k))); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __pyx_t_4 = (!__pyx_t_3);
      if (__pyx_t_4) {

        /* "/usr/local/src/totable/src/ctotable.pyx":176
 *             if not success:
 *                 if not k in d:
 *                     self._throw('Error: attempting to add to '\             # <<<<<<<<<<<<<<
 *                             'non-existing key: %s' % k)
 *         elif mode == 'p':
 */
        __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);

        /* "/usr/local/src/totable/src/ctotable.pyx":177
 *                 if not k in d:
 *                     self._throw('Error: attempting to add to '\
 *                             'non-existing key: %s' % k)             # <<<<<<<<<<<<<<
 *         elif mode == 'p':
 *             success = tctdbput(self._state, kbuf, <int>ksiz, tcmap)
 */
        __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_10), __pyx_v_k); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_5);
        __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        goto __pyx_L8;
      }
      __pyx_L8:;
      goto __pyx_L7;
    }
    __pyx_L7:;
    goto __pyx_L6;
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":178
 *                     self._throw('Error: attempting to add to '\
 *                             'non-existing key: %s' % k)
 *         elif mode == 'p':             # <<<<<<<<<<<<<<
 *             success = tctdbput(self._state, kbuf, <int>ksiz, tcmap)
 *             if not success:
 */
  __pyx_t_5 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__p), Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_4) {

    /* "/usr/local/src/totable/src/ctotable.pyx":179
 *                             'non-existing key: %s' % k)
 *         elif mode == 'p':
 *             success = tctdbput(self._state, kbuf, <int>ksiz, tcmap)             # <<<<<<<<<<<<<<
 *             if not success:
 *                 self._throw('error in put ' + k + ' ' + str(d))
 */
    __pyx_v_success = tctdbput(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_kbuf, ((int)__pyx_v_ksiz), __pyx_v_tcmap);

    /* "/usr/local/src/totable/src/ctotable.pyx":180
 *         elif mode == 'p':
 *             success = tctdbput(self._state, kbuf, <int>ksiz, tcmap)
 *             if not success:             # <<<<<<<<<<<<<<
 *                 self._throw('error in put ' + k + ' ' + str(d))
 *         elif mode == 'k':
 */
    __pyx_t_4 = (!__pyx_v_success);
    if (__pyx_t_4) {

      /* "/usr/local/src/totable/src/ctotable.pyx":181
 *             success = tctdbput(self._state, kbuf, <int>ksiz, tcmap)
 *             if not success:
 *                 self._throw('error in put ' + k + ' ' + str(d))             # <<<<<<<<<<<<<<
 *         elif mode == 'k':
 *             success = tctdbputkeep(self._state, kbuf, ksiz, tcmap)
 */
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyNumber_Add(((PyObject *)__pyx_kp_s_11), __pyx_v_k); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_2 = PyNumber_Add(__pyx_t_6, ((PyObject *)__pyx_kp_s_12)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(((PyObject *)__pyx_v_d));
      PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_v_d));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_d));
      __pyx_t_7 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_6, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyNumber_Add(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_6 = PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L9;
    }
    __pyx_L9:;
    goto __pyx_L6;
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":182
 *             if not success:
 *                 self._throw('error in put ' + k + ' ' + str(d))
 *         elif mode == 'k':             # <<<<<<<<<<<<<<
 *             success = tctdbputkeep(self._state, kbuf, ksiz, tcmap)
 *             return self._put_keep_code(success, k)
 */
  __pyx_t_6 = PyObject_RichCompare(__pyx_v_mode, ((PyObject *)__pyx_n_s__k), Py_EQ); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_4) {

    /* "/usr/local/src/totable/src/ctotable.pyx":183
 *                 self._throw('error in put ' + k + ' ' + str(d))
 *         elif mode == 'k':
 *             success = tctdbputkeep(self._state, kbuf, ksiz, tcmap)             # <<<<<<<<<<<<<<
 *             return self._put_keep_code(success, k)
 *         else:
 */
    __pyx_v_success = tctdbputkeep(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_kbuf, __pyx_v_ksiz, __pyx_v_tcmap);

    /* "/usr/local/src/totable/src/ctotable.pyx":184
 *         elif mode == 'k':
 *             success = tctdbputkeep(self._state, kbuf, ksiz, tcmap)
 *             return self._put_keep_code(success, k)             # <<<<<<<<<<<<<<
 *         else:
 *             raise TCException('mode must be one of p/k/c')
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_6 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_put_keep_code(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_success, __pyx_v_k); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/usr/local/src/totable/src/ctotable.pyx":186
 *             return self._put_keep_code(success, k)
 *         else:
 *             raise TCException('mode must be one of p/k/c')             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__TCException); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(((PyObject *)__pyx_kp_s_13));
    PyTuple_SET_ITEM(__pyx_t_7, 0, ((PyObject *)__pyx_kp_s_13));
    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_13));
    __pyx_t_5 = PyObject_Call(__pyx_t_6, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_Raise(__pyx_t_5, 0, 0);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("ctotable.ToTable.put");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_k);
  __Pyx_DECREF(__pyx_v_d);
  __Pyx_DECREF(__pyx_v_mode);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":189
 * 
 * 
 *     def __setitem__(self, k, d):             # <<<<<<<<<<<<<<
 *         cdef TCMAP * tcmap = self._dict_to_tcmap(d)
 *         cdef char *kbuf
 */

static int __pyx_pf_8ctotable_7ToTable___setitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_k, PyObject *__pyx_v_d); /*proto*/
static int __pyx_pf_8ctotable_7ToTable___setitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_k, PyObject *__pyx_v_d) {
  TCMAP *__pyx_v_tcmap;
  char *__pyx_v_kbuf;
  Py_ssize_t __pyx_v_ksiz;
  int __pyx_v_success;
  int __pyx_r;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("__setitem__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_k);
  __Pyx_INCREF(__pyx_v_d);

  /* "/usr/local/src/totable/src/ctotable.pyx":190
 * 
 *     def __setitem__(self, k, d):
 *         cdef TCMAP * tcmap = self._dict_to_tcmap(d)             # <<<<<<<<<<<<<<
 *         cdef char *kbuf
 *         cdef Py_ssize_t ksiz
 */
  if (!(likely(PyDict_CheckExact(__pyx_v_d))||((__pyx_v_d) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_v_d)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_tcmap = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_dict_to_tcmap(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), ((PyObject *)__pyx_v_d));

  /* "/usr/local/src/totable/src/ctotable.pyx":194
 *         cdef Py_ssize_t ksiz
 *         cdef bint success
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)             # <<<<<<<<<<<<<<
 *         success = tctdbput(self._state, kbuf, ksiz, tcmap)
 *         tcmapdel(tcmap)
 */
  __pyx_t_1 = PyString_AsStringAndSize(__pyx_v_k, (&__pyx_v_kbuf), (&__pyx_v_ksiz)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":195
 *         cdef bint success
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)
 *         success = tctdbput(self._state, kbuf, ksiz, tcmap)             # <<<<<<<<<<<<<<
 *         tcmapdel(tcmap)
 * 
 */
  __pyx_v_success = tctdbput(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_kbuf, __pyx_v_ksiz, __pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":196
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)
 *         success = tctdbput(self._state, kbuf, ksiz, tcmap)
 *         tcmapdel(tcmap)             # <<<<<<<<<<<<<<
 * 
 *         if not success:
 */
  tcmapdel(__pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":198
 *         tcmapdel(tcmap)
 * 
 *         if not success:             # <<<<<<<<<<<<<<
 *             self._throw('Unable to write to '+ str(k))
 * 
 */
  __pyx_t_2 = (!__pyx_v_success);
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":199
 * 
 *         if not success:
 *             self._throw('Unable to write to '+ str(k))             # <<<<<<<<<<<<<<
 * 
 *     cdef dict _tcmap_to_dict(ToTable self, TCMAP *tcmap):
 */
    __pyx_t_3 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s___throw); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_k);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_k);
    __Pyx_GIVEREF(__pyx_v_k);
    __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Add(((PyObject *)__pyx_kp_s_14), __pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("ctotable.ToTable.__setitem__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_k);
  __Pyx_DECREF(__pyx_v_d);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":201
 *             self._throw('Unable to write to '+ str(k))
 * 
 *     cdef dict _tcmap_to_dict(ToTable self, TCMAP *tcmap):             # <<<<<<<<<<<<<<
 *         cdef dict d = {}
 *         tcmapiterinit(tcmap)
 */

static  PyObject *__pyx_f_8ctotable_7ToTable__tcmap_to_dict(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, TCMAP *__pyx_v_tcmap) {
  PyObject *__pyx_v_d = 0;
  int __pyx_v_ksiz;
  int __pyx_v_vsiz;
  char *__pyx_v_vptr;
  char *__pyx_v_kptr;
  PyObject *__pyx_v_pykey;
  PyObject *__pyx_v_pyval;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("_tcmap_to_dict");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_pykey = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_pyval = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":202
 * 
 *     cdef dict _tcmap_to_dict(ToTable self, TCMAP *tcmap):
 *         cdef dict d = {}             # <<<<<<<<<<<<<<
 *         tcmapiterinit(tcmap)
 *         cdef int ksiz, vsiz
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_v_d = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":203
 *     cdef dict _tcmap_to_dict(ToTable self, TCMAP *tcmap):
 *         cdef dict d = {}
 *         tcmapiterinit(tcmap)             # <<<<<<<<<<<<<<
 *         cdef int ksiz, vsiz
 * 
 */
  tcmapiterinit(__pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":206
 *         cdef int ksiz, vsiz
 * 
 *         cdef char *vptr, *kptr = <char *>tcmapiternext(tcmap, &ksiz)             # <<<<<<<<<<<<<<
 *         while kptr != NULL:
 *             vptr = <char *>tcmapget(tcmap, <void *>kptr, ksiz, &vsiz)
 */
  __pyx_v_kptr = ((char *)tcmapiternext(__pyx_v_tcmap, (&__pyx_v_ksiz)));

  /* "/usr/local/src/totable/src/ctotable.pyx":207
 * 
 *         cdef char *vptr, *kptr = <char *>tcmapiternext(tcmap, &ksiz)
 *         while kptr != NULL:             # <<<<<<<<<<<<<<
 *             vptr = <char *>tcmapget(tcmap, <void *>kptr, ksiz, &vsiz)
 * 
 */
  while (1) {
    __pyx_t_2 = (__pyx_v_kptr != NULL);
    if (!__pyx_t_2) break;

    /* "/usr/local/src/totable/src/ctotable.pyx":208
 *         cdef char *vptr, *kptr = <char *>tcmapiternext(tcmap, &ksiz)
 *         while kptr != NULL:
 *             vptr = <char *>tcmapget(tcmap, <void *>kptr, ksiz, &vsiz)             # <<<<<<<<<<<<<<
 * 
 *             pykey = ps.PyString_FromStringAndSize(kptr, <Py_ssize_t>ksiz)
 */
    __pyx_v_vptr = ((char *)tcmapget(__pyx_v_tcmap, ((void *)__pyx_v_kptr), __pyx_v_ksiz, (&__pyx_v_vsiz)));

    /* "/usr/local/src/totable/src/ctotable.pyx":210
 *             vptr = <char *>tcmapget(tcmap, <void *>kptr, ksiz, &vsiz)
 * 
 *             pykey = ps.PyString_FromStringAndSize(kptr, <Py_ssize_t>ksiz)             # <<<<<<<<<<<<<<
 *             pyval = ps.PyString_FromStringAndSize(vptr, <Py_ssize_t>vsiz)
 *             d[pykey] = pyval
 */
    __pyx_t_1 = PyString_FromStringAndSize(__pyx_v_kptr, ((Py_ssize_t)__pyx_v_ksiz)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_v_pykey);
    __pyx_v_pykey = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":211
 * 
 *             pykey = ps.PyString_FromStringAndSize(kptr, <Py_ssize_t>ksiz)
 *             pyval = ps.PyString_FromStringAndSize(vptr, <Py_ssize_t>vsiz)             # <<<<<<<<<<<<<<
 *             d[pykey] = pyval
 * 
 */
    __pyx_t_1 = PyString_FromStringAndSize(__pyx_v_vptr, ((Py_ssize_t)__pyx_v_vsiz)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_v_pyval);
    __pyx_v_pyval = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":212
 *             pykey = ps.PyString_FromStringAndSize(kptr, <Py_ssize_t>ksiz)
 *             pyval = ps.PyString_FromStringAndSize(vptr, <Py_ssize_t>vsiz)
 *             d[pykey] = pyval             # <<<<<<<<<<<<<<
 * 
 *             kptr = <char *>tcmapiternext(tcmap, &ksiz)
 */
    if (PyDict_SetItem(((PyObject *)__pyx_v_d), __pyx_v_pykey, __pyx_v_pyval) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/usr/local/src/totable/src/ctotable.pyx":214
 *             d[pykey] = pyval
 * 
 *             kptr = <char *>tcmapiternext(tcmap, &ksiz)             # <<<<<<<<<<<<<<
 * 
 *         return d
 */
    __pyx_v_kptr = ((char *)tcmapiternext(__pyx_v_tcmap, (&__pyx_v_ksiz)));
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":216
 *             kptr = <char *>tcmapiternext(tcmap, &ksiz)
 * 
 *         return d             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_d));
  __pyx_r = __pyx_v_d;
  goto __pyx_L0;

  __pyx_r = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable._tcmap_to_dict");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_DECREF(__pyx_v_pykey);
  __Pyx_DECREF(__pyx_v_pyval);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":219
 * 
 * 
 *     cdef dict _key_to_dict(ToTable self, key):             # <<<<<<<<<<<<<<
 *         """INTERNAL: take the database key and return
 *         the dicitonary associated with that key"""
 */

static  PyObject *__pyx_f_8ctotable_7ToTable__key_to_dict(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, PyObject *__pyx_v_key) {
  char *__pyx_v_kbuf;
  Py_ssize_t __pyx_v_ksiz;
  TCMAP *__pyx_v_tcmap;
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("_key_to_dict");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_key);

  /* "/usr/local/src/totable/src/ctotable.pyx":224
 *         cdef char *kbuf
 *         cdef Py_ssize_t ksiz
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)             # <<<<<<<<<<<<<<
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)
 *         if tcmap == NULL:
 */
  __pyx_t_1 = PyString_AsStringAndSize(__pyx_v_key, (&__pyx_v_kbuf), (&__pyx_v_ksiz)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":225
 *         cdef Py_ssize_t ksiz
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)             # <<<<<<<<<<<<<<
 *         if tcmap == NULL:
 *             raise KeyError('Lookup failed: ' + str(key))
 */
  __pyx_v_tcmap = tctdbget(__pyx_v_self->_state, __pyx_v_kbuf, ((int)__pyx_v_ksiz));

  /* "/usr/local/src/totable/src/ctotable.pyx":226
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)
 *         if tcmap == NULL:             # <<<<<<<<<<<<<<
 *             raise KeyError('Lookup failed: ' + str(key))
 * 
 */
  __pyx_t_2 = (__pyx_v_tcmap == NULL);
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":227
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)
 *         if tcmap == NULL:
 *             raise KeyError('Lookup failed: ' + str(key))             # <<<<<<<<<<<<<<
 * 
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 */
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_key);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_key);
    __Pyx_GIVEREF(__pyx_v_key);
    __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Add(((PyObject *)__pyx_kp_s_15), __pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_KeyError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/usr/local/src/totable/src/ctotable.pyx":229
 *             raise KeyError('Lookup failed: ' + str(key))
 * 
 *         cdef dict d = self._tcmap_to_dict(tcmap)             # <<<<<<<<<<<<<<
 *         tcmapdel(tcmap)
 *         return d
 */
  __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_8ctotable_ToTable *)__pyx_v_self->__pyx_vtab)->_tcmap_to_dict(__pyx_v_self, __pyx_v_tcmap)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_d = ((PyObject *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":230
 * 
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 *         tcmapdel(tcmap)             # <<<<<<<<<<<<<<
 *         return d
 * 
 */
  tcmapdel(__pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":231
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 *         tcmapdel(tcmap)
 *         return d             # <<<<<<<<<<<<<<
 * 
 *     cdef inline dict _ckey_to_dict(ToTable self, char *kbuf, int ksiz):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_d));
  __pyx_r = __pyx_v_d;
  goto __pyx_L0;

  __pyx_r = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("ctotable.ToTable._key_to_dict");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":233
 *         return d
 * 
 *     cdef inline dict _ckey_to_dict(ToTable self, char *kbuf, int ksiz):             # <<<<<<<<<<<<<<
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)
 *         if tcmap == NULL:
 */

static INLINE PyObject *__pyx_f_8ctotable_7ToTable__ckey_to_dict(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, char *__pyx_v_kbuf, int __pyx_v_ksiz) {
  TCMAP *__pyx_v_tcmap;
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("_ckey_to_dict");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/usr/local/src/totable/src/ctotable.pyx":234
 * 
 *     cdef inline dict _ckey_to_dict(ToTable self, char *kbuf, int ksiz):
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)             # <<<<<<<<<<<<<<
 *         if tcmap == NULL:
 *             raise KeyError('Lookup failed: ' + str(kbuf))
 */
  __pyx_v_tcmap = tctdbget(__pyx_v_self->_state, __pyx_v_kbuf, ((int)__pyx_v_ksiz));

  /* "/usr/local/src/totable/src/ctotable.pyx":235
 *     cdef inline dict _ckey_to_dict(ToTable self, char *kbuf, int ksiz):
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)
 *         if tcmap == NULL:             # <<<<<<<<<<<<<<
 *             raise KeyError('Lookup failed: ' + str(kbuf))
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 */
  __pyx_t_1 = (__pyx_v_tcmap == NULL);
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":236
 *         cdef TCMAP *tcmap = tctdbget(self._state, kbuf, <int>ksiz)
 *         if tcmap == NULL:
 *             raise KeyError('Lookup failed: ' + str(kbuf))             # <<<<<<<<<<<<<<
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 *         tcmapdel(tcmap)
 */
    __pyx_t_2 = __Pyx_PyBytes_FromString(__pyx_v_kbuf); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Add(((PyObject *)__pyx_kp_s_15), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_KeyError, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/usr/local/src/totable/src/ctotable.pyx":237
 *         if tcmap == NULL:
 *             raise KeyError('Lookup failed: ' + str(kbuf))
 *         cdef dict d = self._tcmap_to_dict(tcmap)             # <<<<<<<<<<<<<<
 *         tcmapdel(tcmap)
 *         return d
 */
  __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_8ctotable_ToTable *)__pyx_v_self->__pyx_vtab)->_tcmap_to_dict(__pyx_v_self, __pyx_v_tcmap)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_d = ((PyObject *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":238
 *             raise KeyError('Lookup failed: ' + str(kbuf))
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 *         tcmapdel(tcmap)             # <<<<<<<<<<<<<<
 *         return d
 * 
 */
  tcmapdel(__pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":239
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 *         tcmapdel(tcmap)
 *         return d             # <<<<<<<<<<<<<<
 * 
 *     def __iter__(self):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_d));
  __pyx_r = __pyx_v_d;
  goto __pyx_L0;

  __pyx_r = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.ToTable._ckey_to_dict");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":241
 *         return d
 * 
 *     def __iter__(self):             # <<<<<<<<<<<<<<
 *         tctdbiterinit(self._state)
 *         return self
 */

static PyObject *__pyx_pf_8ctotable_7ToTable___iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable___iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__iter__");

  /* "/usr/local/src/totable/src/ctotable.pyx":242
 * 
 *     def __iter__(self):
 *         tctdbiterinit(self._state)             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  tctdbiterinit(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state);

  /* "/usr/local/src/totable/src/ctotable.pyx":243
 *     def __iter__(self):
 *         tctdbiterinit(self._state)
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def __next__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":245
 *         return self
 * 
 *     def __next__(self):             # <<<<<<<<<<<<<<
 *         cdef TCMAP *tcmap = tctdbiternext3(self._state)
 *         if tcmap == NULL:
 */

static PyObject *__pyx_pf_8ctotable_7ToTable___next__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable___next__(PyObject *__pyx_v_self) {
  TCMAP *__pyx_v_tcmap;
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__next__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/usr/local/src/totable/src/ctotable.pyx":246
 * 
 *     def __next__(self):
 *         cdef TCMAP *tcmap = tctdbiternext3(self._state)             # <<<<<<<<<<<<<<
 *         if tcmap == NULL:
 *             raise StopIteration
 */
  __pyx_v_tcmap = tctdbiternext3(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state);

  /* "/usr/local/src/totable/src/ctotable.pyx":247
 *     def __next__(self):
 *         cdef TCMAP *tcmap = tctdbiternext3(self._state)
 *         if tcmap == NULL:             # <<<<<<<<<<<<<<
 *             raise StopIteration
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 */
  __pyx_t_1 = (__pyx_v_tcmap == NULL);
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":248
 *         cdef TCMAP *tcmap = tctdbiternext3(self._state)
 *         if tcmap == NULL:
 *             raise StopIteration             # <<<<<<<<<<<<<<
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 *         tcmapdel(tcmap)
 */
    __Pyx_Raise(__pyx_builtin_StopIteration, 0, 0);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/usr/local/src/totable/src/ctotable.pyx":249
 *         if tcmap == NULL:
 *             raise StopIteration
 *         cdef dict d = self._tcmap_to_dict(tcmap)             # <<<<<<<<<<<<<<
 *         tcmapdel(tcmap)
 *         # the key is stored in the tcmap with its key as ''
 */
  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_tcmap_to_dict(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_tcmap)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_d = ((PyObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":250
 *             raise StopIteration
 *         cdef dict d = self._tcmap_to_dict(tcmap)
 *         tcmapdel(tcmap)             # <<<<<<<<<<<<<<
 *         # the key is stored in the tcmap with its key as ''
 *         return d.pop(''), d
 */
  tcmapdel(__pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":252
 *         tcmapdel(tcmap)
 *         # the key is stored in the tcmap with its key as ''
 *         return d.pop(''), d             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_d), __pyx_n_s__pop); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(((PyObject *)__pyx_kp_s_16));
  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_s_16));
  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_16));
  __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject *)__pyx_v_d));
  PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_d));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_d));
  __pyx_t_4 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("ctotable.ToTable.__next__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":255
 * 
 * 
 *     def keep_or_put(self, k, d):             # <<<<<<<<<<<<<<
 *         '''Takes as arguments a key (string) and a value (dict).
 *         If the key already exists in the table, nothing is done
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_keep_or_put(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_keep_or_put[] = "Takes as arguments a key (string) and a value (dict).\n        If the key already exists in the table, nothing is done\n        and the string 'keep' is returned.\n        Otherwise, the value is stored at the key and 'put' is returned.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable_keep_or_put(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_k = 0;
  PyObject *__pyx_v_d = 0;
  char *__pyx_v_kbuf;
  Py_ssize_t __pyx_v_ksiz;
  TCMAP *__pyx_v_tcmap;
  int __pyx_v_success;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__k,&__pyx_n_s__d,0};
  __Pyx_RefNannySetupContext("keep_or_put");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__k);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__d);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("keep_or_put", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "keep_or_put") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_k = values[0];
    __pyx_v_d = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_k = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_d = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("keep_or_put", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.keep_or_put");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/usr/local/src/totable/src/ctotable.pyx":263
 *         cdef char *kbuf
 *         cdef Py_ssize_t ksiz
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)             # <<<<<<<<<<<<<<
 *         cdef TCMAP * tcmap = self._dict_to_tcmap(d)
 *         cdef bint success = tctdbputkeep(self._state, <void *>kbuf,
 */
  __pyx_t_1 = PyString_AsStringAndSize(__pyx_v_k, (&__pyx_v_kbuf), (&__pyx_v_ksiz)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":264
 *         cdef Py_ssize_t ksiz
 *         ps.PyString_AsStringAndSize(k, &kbuf, &ksiz)
 *         cdef TCMAP * tcmap = self._dict_to_tcmap(d)             # <<<<<<<<<<<<<<
 *         cdef bint success = tctdbputkeep(self._state, <void *>kbuf,
 *                                           <int>ksiz, tcmap)
 */
  if (!(likely(PyDict_CheckExact(__pyx_v_d))||((__pyx_v_d) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_v_d)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_tcmap = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_dict_to_tcmap(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), ((PyObject *)__pyx_v_d));

  /* "/usr/local/src/totable/src/ctotable.pyx":266
 *         cdef TCMAP * tcmap = self._dict_to_tcmap(d)
 *         cdef bint success = tctdbputkeep(self._state, <void *>kbuf,
 *                                           <int>ksiz, tcmap)             # <<<<<<<<<<<<<<
 * 
 *         tcmapdel(tcmap)
 */
  __pyx_v_success = tctdbputkeep(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, ((void *)__pyx_v_kbuf), ((int)__pyx_v_ksiz), __pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":268
 *                                           <int>ksiz, tcmap)
 * 
 *         tcmapdel(tcmap)             # <<<<<<<<<<<<<<
 *         return self._put_keep_code(success, k)
 * 
 */
  tcmapdel(__pyx_v_tcmap);

  /* "/usr/local/src/totable/src/ctotable.pyx":269
 * 
 *         tcmapdel(tcmap)
 *         return self._put_keep_code(success, k)             # <<<<<<<<<<<<<<
 * 
 *     cdef _put_keep_code(self, bint success, key):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_put_keep_code(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_success, __pyx_v_k); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("ctotable.ToTable.keep_or_put");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":271
 *         return self._put_keep_code(success, k)
 * 
 *     cdef _put_keep_code(self, bint success, key):             # <<<<<<<<<<<<<<
 *         cdef int errorcode
 *         if not success:
 */

static  PyObject *__pyx_f_8ctotable_7ToTable__put_keep_code(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, int __pyx_v_success, PyObject *__pyx_v_key) {
  int __pyx_v_errorcode;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("_put_keep_code");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_key);

  /* "/usr/local/src/totable/src/ctotable.pyx":273
 *     cdef _put_keep_code(self, bint success, key):
 *         cdef int errorcode
 *         if not success:             # <<<<<<<<<<<<<<
 *             errorcode = tctdbecode(self._state)
 *             if errorcode == 21: # 'existing record'
 */
  __pyx_t_1 = (!__pyx_v_success);
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":274
 *         cdef int errorcode
 *         if not success:
 *             errorcode = tctdbecode(self._state)             # <<<<<<<<<<<<<<
 *             if errorcode == 21: # 'existing record'
 *                 return 'keep'
 */
    __pyx_v_errorcode = tctdbecode(__pyx_v_self->_state);

    /* "/usr/local/src/totable/src/ctotable.pyx":275
 *         if not success:
 *             errorcode = tctdbecode(self._state)
 *             if errorcode == 21: # 'existing record'             # <<<<<<<<<<<<<<
 *                 return 'keep'
 *             else:
 */
    __pyx_t_1 = (__pyx_v_errorcode == 21);
    if (__pyx_t_1) {

      /* "/usr/local/src/totable/src/ctotable.pyx":276
 *             errorcode = tctdbecode(self._state)
 *             if errorcode == 21: # 'existing record'
 *                 return 'keep'             # <<<<<<<<<<<<<<
 *             else:
 *                 self._throw('Unable to write key "{0}".'.format(key))
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(((PyObject *)__pyx_n_s__keep));
      __pyx_r = ((PyObject *)__pyx_n_s__keep);
      goto __pyx_L0;
      goto __pyx_L4;
    }
    /*else*/ {

      /* "/usr/local/src/totable/src/ctotable.pyx":278
 *                 return 'keep'
 *             else:
 *                 self._throw('Unable to write key "{0}".'.format(key))             # <<<<<<<<<<<<<<
 *         return 'put'
 * 
 */
      __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s___throw); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_17), __pyx_n_s__format); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_key);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_key);
      __Pyx_GIVEREF(__pyx_v_key);
      __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_L4:;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/usr/local/src/totable/src/ctotable.pyx":279
 *             else:
 *                 self._throw('Unable to write key "{0}".'.format(key))
 *         return 'put'             # <<<<<<<<<<<<<<
 * 
 *     def setdefault(self, k, d):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__put));
  __pyx_r = ((PyObject *)__pyx_n_s__put);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("ctotable.ToTable._put_keep_code");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":281
 *         return 'put'
 * 
 *     def setdefault(self, k, d):             # <<<<<<<<<<<<<<
 *         '''Writes a record -- d[k] = d -- if k not in d.
 *         Then returns d[k].
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_setdefault(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_setdefault[] = "Writes a record -- d[k] = d -- if k not in d.\n        Then returns d[k].\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable_setdefault(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_k = 0;
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  struct __pyx_opt_args_8ctotable_7ToTable_get __pyx_t_5;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__k,&__pyx_n_s__d,0};
  __Pyx_RefNannySetupContext("setdefault");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__k);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__d);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("setdefault", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "setdefault") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_k = values[0];
    __pyx_v_d = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_k = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_d = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("setdefault", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.setdefault");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_k);
  __Pyx_INCREF(__pyx_v_d);

  /* "/usr/local/src/totable/src/ctotable.pyx":285
 *         Then returns d[k].
 *         '''
 *         if self.keep_or_put(k, d) == 'keep':             # <<<<<<<<<<<<<<
 *             return self.get(k, d)
 *         else:
 */
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__keep_or_put); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_k);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_k);
  __Pyx_GIVEREF(__pyx_v_k);
  __Pyx_INCREF(__pyx_v_d);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_d);
  __Pyx_GIVEREF(__pyx_v_d);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_n_s__keep), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {

    /* "/usr/local/src/totable/src/ctotable.pyx":286
 *         '''
 *         if self.keep_or_put(k, d) == 'keep':
 *             return self.get(k, d)             # <<<<<<<<<<<<<<
 *         else:
 *             return d # which certainly has just been put
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_5.__pyx_n = 1;
    __pyx_t_5.__pyx_default = __pyx_v_d;
    __pyx_t_2 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->get(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_k, 0, &__pyx_t_5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/usr/local/src/totable/src/ctotable.pyx":288
 *             return self.get(k, d)
 *         else:
 *             return d # which certainly has just been put             # <<<<<<<<<<<<<<
 * 
 *     def __getitem__(self, key):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_d);
    __pyx_r = __pyx_v_d;
    goto __pyx_L0;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.ToTable.setdefault");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_k);
  __Pyx_DECREF(__pyx_v_d);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":290
 *             return d # which certainly has just been put
 * 
 *     def __getitem__(self, key):             # <<<<<<<<<<<<<<
 *         '''Returns a record (as a dict) or raises KeyError.'''
 *         return self._key_to_dict(key)
 */

static PyObject *__pyx_pf_8ctotable_7ToTable___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static char __pyx_doc_8ctotable_7ToTable___getitem__[] = "Returns a record (as a dict) or raises KeyError.";
static PyObject *__pyx_pf_8ctotable_7ToTable___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__getitem__");

  /* "/usr/local/src/totable/src/ctotable.pyx":292
 *     def __getitem__(self, key):
 *         '''Returns a record (as a dict) or raises KeyError.'''
 *         return self._key_to_dict(key)             # <<<<<<<<<<<<<<
 * 
 *     cpdef get(self, key, default=None):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_key_to_dict(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_key)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable.__getitem__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":294
 *         return self._key_to_dict(key)
 * 
 *     cpdef get(self, key, default=None):             # <<<<<<<<<<<<<<
 *         try:
 *             v = self._key_to_dict(key)
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_get(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static  PyObject *__pyx_f_8ctotable_7ToTable_get(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, PyObject *__pyx_v_key, int __pyx_skip_dispatch, struct __pyx_opt_args_8ctotable_7ToTable_get *__pyx_optional_args) {
  PyObject *__pyx_v_default = ((PyObject *)Py_None);
  PyObject *__pyx_v_v;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("get");
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_default = __pyx_optional_args->__pyx_default;
    }
  }
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_key);
  __Pyx_INCREF(__pyx_v_default);
  __pyx_v_v = Py_None; __Pyx_INCREF(Py_None);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__get); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_8ctotable_7ToTable_get)) {
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_v_key);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_key);
      __Pyx_GIVEREF(__pyx_v_key);
      __Pyx_INCREF(__pyx_v_default);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_default);
      __Pyx_GIVEREF(__pyx_v_default);
      __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":295
 * 
 *     cpdef get(self, key, default=None):
 *         try:             # <<<<<<<<<<<<<<
 *             v = self._key_to_dict(key)
 *             return v or default
 */
  {
    PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
    __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
    __Pyx_XGOTREF(__pyx_save_exc_type);
    __Pyx_XGOTREF(__pyx_save_exc_value);
    __Pyx_XGOTREF(__pyx_save_exc_tb);
    /*try:*/ {

      /* "/usr/local/src/totable/src/ctotable.pyx":296
 *     cpdef get(self, key, default=None):
 *         try:
 *             v = self._key_to_dict(key)             # <<<<<<<<<<<<<<
 *             return v or default
 *         except KeyError:
 */
      __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8ctotable_ToTable *)__pyx_v_self->__pyx_vtab)->_key_to_dict(__pyx_v_self, __pyx_v_key)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_v_v);
      __pyx_v_v = __pyx_t_1;
      __pyx_t_1 = 0;

      /* "/usr/local/src/totable/src/ctotable.pyx":297
 *         try:
 *             v = self._key_to_dict(key)
 *             return v or default             # <<<<<<<<<<<<<<
 *         except KeyError:
 *             return default
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_v); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      if (!__pyx_t_4) {
        __Pyx_INCREF(__pyx_v_default);
        __pyx_t_1 = __pyx_v_default;
      } else {
        __Pyx_INCREF(__pyx_v_v);
        __pyx_t_1 = __pyx_v_v;
      }
      __pyx_r = __pyx_t_1;
      __pyx_t_1 = 0;
      goto __pyx_L7_try_return;
    }
    __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
    __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
    __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
    goto __pyx_L10_try_end;
    __pyx_L7_try_return:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L0;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":298
 *             v = self._key_to_dict(key)
 *             return v or default
 *         except KeyError:             # <<<<<<<<<<<<<<
 *             return default
 * 
 */
    __pyx_t_5 = PyErr_ExceptionMatches(__pyx_builtin_KeyError);
    if (__pyx_t_5) {
      __Pyx_AddTraceback("ctotable.ToTable.get");
      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_3, &__pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 298; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GOTREF(__pyx_t_2);

      /* "/usr/local/src/totable/src/ctotable.pyx":299
 *             return v or default
 *         except KeyError:
 *             return default             # <<<<<<<<<<<<<<
 * 
 *     def __delitem__(self, key):
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_default);
      __pyx_r = __pyx_v_default;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L6_except_return;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L4_exception_handled;
    }
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L1_error;
    __pyx_L6_except_return:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    goto __pyx_L0;
    __pyx_L4_exception_handled:;
    __Pyx_XGIVEREF(__pyx_save_exc_type);
    __Pyx_XGIVEREF(__pyx_save_exc_value);
    __Pyx_XGIVEREF(__pyx_save_exc_tb);
    __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
    __pyx_L10_try_end:;
  }

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.ToTable.get");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_v);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_DECREF(__pyx_v_default);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":294
 *         return self._key_to_dict(key)
 * 
 *     cpdef get(self, key, default=None):             # <<<<<<<<<<<<<<
 *         try:
 *             v = self._key_to_dict(key)
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_get(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_get(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_key = 0;
  PyObject *__pyx_v_default = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8ctotable_7ToTable_get __pyx_t_2;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__key,&__pyx_n_s__default,0};
  __Pyx_RefNannySetupContext("get");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__key);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__default);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "get") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_key = values[0];
    __pyx_v_default = values[1];
  } else {
    __pyx_v_default = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_default = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: __pyx_v_key = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.get");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.__pyx_default = __pyx_v_default;
  __pyx_t_1 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->get(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_key, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable.get");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":301
 *             return default
 * 
 *     def __delitem__(self, key):             # <<<<<<<<<<<<<<
 *         cdef char *kbuf
 *         cdef Py_ssize_t ksiz
 */

static int __pyx_pf_8ctotable_7ToTable___delitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static int __pyx_pf_8ctotable_7ToTable___delitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  char *__pyx_v_kbuf;
  Py_ssize_t __pyx_v_ksiz;
  int __pyx_v_success;
  int __pyx_r;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__delitem__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_key);

  /* "/usr/local/src/totable/src/ctotable.pyx":304
 *         cdef char *kbuf
 *         cdef Py_ssize_t ksiz
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)             # <<<<<<<<<<<<<<
 *         cdef bint success = tctdbout(self._state, kbuf, ksiz)
 *         if not success:
 */
  __pyx_t_1 = PyString_AsStringAndSize(__pyx_v_key, (&__pyx_v_kbuf), (&__pyx_v_ksiz)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":305
 *         cdef Py_ssize_t ksiz
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *         cdef bint success = tctdbout(self._state, kbuf, ksiz)             # <<<<<<<<<<<<<<
 *         if not success:
 *             raise KeyError(self._msg())
 */
  __pyx_v_success = tctdbout(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state, __pyx_v_kbuf, __pyx_v_ksiz);

  /* "/usr/local/src/totable/src/ctotable.pyx":306
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *         cdef bint success = tctdbout(self._state, kbuf, ksiz)
 *         if not success:             # <<<<<<<<<<<<<<
 *             raise KeyError(self._msg())
 * 
 */
  __pyx_t_2 = (!__pyx_v_success);
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":307
 *         cdef bint success = tctdbout(self._state, kbuf, ksiz)
 *         if not success:
 *             raise KeyError(self._msg())             # <<<<<<<<<<<<<<
 * 
 *     def pop(self, k, d=None):
 */
    __pyx_t_3 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_msg(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_builtin_KeyError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("ctotable.ToTable.__delitem__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":309
 *             raise KeyError(self._msg())
 * 
 *     def pop(self, k, d=None):             # <<<<<<<<<<<<<<
 *         '''D.pop(k[,d]) -> v, remove specified key and return the
 *         corresponding value. If key is not found, d is returned if given,
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_pop(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_pop[] = "D.pop(k[,d]) -> v, remove specified key and return the\n        corresponding value. If key is not found, d is returned if given,\n        otherwise KeyError is raised.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable_pop(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_k = 0;
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_v_adict;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__k,&__pyx_n_s__d,0};
  __Pyx_RefNannySetupContext("pop");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__k);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      if (kw_args > 1) {
        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__d);
        if (unlikely(value)) { values[1] = value; kw_args--; }
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "pop") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_k = values[0];
    __pyx_v_d = values[1];
  } else {
    __pyx_v_d = ((PyObject *)Py_None);
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: __pyx_v_d = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: __pyx_v_k = PyTuple_GET_ITEM(__pyx_args, 0);
      break;
      default: goto __pyx_L5_argtuple_error;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("pop", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.ToTable.pop");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_k);
  __Pyx_INCREF(__pyx_v_d);
  __pyx_v_adict = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":314
 *         otherwise KeyError is raised.
 *         '''
 *         adict = self.get(k)             # <<<<<<<<<<<<<<
 *         if adict is None:
 *             if d is None:
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->get(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_k, 0, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_v_adict);
  __pyx_v_adict = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":315
 *         '''
 *         adict = self.get(k)
 *         if adict is None:             # <<<<<<<<<<<<<<
 *             if d is None:
 *                 raise KeyError('Key not found: "{0}"'.format(k))
 */
  __pyx_t_2 = (__pyx_v_adict == Py_None);
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":316
 *         adict = self.get(k)
 *         if adict is None:
 *             if d is None:             # <<<<<<<<<<<<<<
 *                 raise KeyError('Key not found: "{0}"'.format(k))
 *             else:
 */
    __pyx_t_2 = (__pyx_v_d == Py_None);
    if (__pyx_t_2) {

      /* "/usr/local/src/totable/src/ctotable.pyx":317
 *         if adict is None:
 *             if d is None:
 *                 raise KeyError('Key not found: "{0}"'.format(k))             # <<<<<<<<<<<<<<
 *             else:
 *                 return d
 */
      __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_18), __pyx_n_s__format); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_v_k);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_k);
      __Pyx_GIVEREF(__pyx_v_k);
      __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_Call(__pyx_builtin_KeyError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_4, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/usr/local/src/totable/src/ctotable.pyx":319
 *                 raise KeyError('Key not found: "{0}"'.format(k))
 *             else:
 *                 return d             # <<<<<<<<<<<<<<
 *         else:
 *             del self.k
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_d);
      __pyx_r = __pyx_v_d;
      goto __pyx_L0;
    }
    __pyx_L7:;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/usr/local/src/totable/src/ctotable.pyx":321
 *                 return d
 *         else:
 *             del self.k             # <<<<<<<<<<<<<<
 *             return adict
 * 
 */
    if (PyObject_DelAttr(__pyx_v_self, __pyx_n_s__k) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "/usr/local/src/totable/src/ctotable.pyx":322
 *         else:
 *             del self.k
 *             return adict             # <<<<<<<<<<<<<<
 * 
 *     cpdef int size_of(self, key):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_adict);
    __pyx_r = __pyx_v_adict;
    goto __pyx_L0;
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("ctotable.ToTable.pop");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_adict);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_k);
  __Pyx_DECREF(__pyx_v_d);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":324
 *             return adict
 * 
 *     cpdef int size_of(self, key):             # <<<<<<<<<<<<<<
 *         '''Returns the size of the value stored at the passed *id*,
 *         or -1 if the id does not exist in the table database.
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_size_of(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static  int __pyx_f_8ctotable_7ToTable_size_of(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, PyObject *__pyx_v_key, int __pyx_skip_dispatch) {
  char *__pyx_v_kbuf;
  Py_ssize_t __pyx_v_ksiz;
  int __pyx_r;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("size_of");
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overriden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__size_of); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_8ctotable_7ToTable_size_of)) {
      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_v_key);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_key);
      __Pyx_GIVEREF(__pyx_v_key);
      __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_r = __pyx_t_4;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":333
 *         cdef char *kbuf
 *         cdef Py_ssize_t   ksiz
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)             # <<<<<<<<<<<<<<
 *         return tctdbvsiz(self._state, kbuf, <int>ksiz)
 * 
 */
  __pyx_t_4 = PyString_AsStringAndSize(__pyx_v_key, (&__pyx_v_kbuf), (&__pyx_v_ksiz)); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":334
 *         cdef Py_ssize_t   ksiz
 *         ps.PyString_AsStringAndSize(key, &kbuf, &ksiz)
 *         return tctdbvsiz(self._state, kbuf, <int>ksiz)             # <<<<<<<<<<<<<<
 * 
 *     def __contains__(self, key):
 */
  __pyx_r = tctdbvsiz(__pyx_v_self->_state, __pyx_v_kbuf, ((int)__pyx_v_ksiz));
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("ctotable.ToTable.size_of");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":324
 *             return adict
 * 
 *     cpdef int size_of(self, key):             # <<<<<<<<<<<<<<
 *         '''Returns the size of the value stored at the passed *id*,
 *         or -1 if the id does not exist in the table database.
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_size_of(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_size_of[] = "Returns the size of the value stored at the passed *id*,\n        or -1 if the id does not exist in the table database.\n        \n        I don't know why this would be useful... the returned number is\n        a little higher than the amount of characters persisted.\n        ";
static PyObject *__pyx_pf_8ctotable_7ToTable_size_of(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("size_of");
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyInt_FromLong(((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->size_of(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_key, 1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable.size_of");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":336
 *         return tctdbvsiz(self._state, kbuf, <int>ksiz)
 * 
 *     def __contains__(self, key):             # <<<<<<<<<<<<<<
 *         '''True if D has a key *key*, else False.
 *         But know that calling D.get(id, defaultdict) is cheaper than
 */

static int __pyx_pf_8ctotable_7ToTable___contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_key); /*proto*/
static char __pyx_doc_8ctotable_7ToTable___contains__[] = "True if D has a key *key*, else False.\n        But know that calling D.get(id, defaultdict) is cheaper than\n            d = D[id] if id in D else defaultdict\n        ";
static int __pyx_pf_8ctotable_7ToTable___contains__(PyObject *__pyx_v_self, PyObject *__pyx_v_key) {
  int __pyx_r;
  __Pyx_RefNannySetupContext("__contains__");

  /* "/usr/local/src/totable/src/ctotable.pyx":341
 *             d = D[id] if id in D else defaultdict
 *         '''
 *         return self.size_of(key) > -1             # <<<<<<<<<<<<<<
 * 
 *     def flush(self):
 */
  __pyx_r = (((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->size_of(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_key, 0) > -1);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":343
 *         return self.size_of(key) > -1
 * 
 *     def flush(self):             # <<<<<<<<<<<<<<
 *         '''Forces changes to be written to disk. Returns a success code.'''
 *         cdef bint success = tctdbsync(self._state)
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_flush(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_8ctotable_7ToTable_flush[] = "Forces changes to be written to disk. Returns a success code.";
static PyObject *__pyx_pf_8ctotable_7ToTable_flush(PyObject *__pyx_v_self, PyObject *unused) {
  int __pyx_v_success;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("flush");

  /* "/usr/local/src/totable/src/ctotable.pyx":345
 *     def flush(self):
 *         '''Forces changes to be written to disk. Returns a success code.'''
 *         cdef bint success = tctdbsync(self._state)             # <<<<<<<<<<<<<<
 *         return success
 * 
 */
  __pyx_v_success = tctdbsync(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state);

  /* "/usr/local/src/totable/src/ctotable.pyx":346
 *         '''Forces changes to be written to disk. Returns a success code.'''
 *         cdef bint success = tctdbsync(self._state)
 *         return success             # <<<<<<<<<<<<<<
 * 
 *     def __len__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_v_success); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable.flush");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":348
 *         return success
 * 
 *     def __len__(self):             # <<<<<<<<<<<<<<
 *         return tctdbrnum(self._state)
 * 
 */

static Py_ssize_t __pyx_pf_8ctotable_7ToTable___len__(PyObject *__pyx_v_self); /*proto*/
static Py_ssize_t __pyx_pf_8ctotable_7ToTable___len__(PyObject *__pyx_v_self) {
  Py_ssize_t __pyx_r;
  __Pyx_RefNannySetupContext("__len__");

  /* "/usr/local/src/totable/src/ctotable.pyx":349
 * 
 *     def __len__(self):
 *         return tctdbrnum(self._state)             # <<<<<<<<<<<<<<
 * 
 *     cdef void _set_limit(ToTable self, TDBQRY* query_state, dict kwargs):
 */
  __pyx_r = tctdbrnum(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state);
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":351
 *         return tctdbrnum(self._state)
 * 
 *     cdef void _set_limit(ToTable self, TDBQRY* query_state, dict kwargs):             # <<<<<<<<<<<<<<
 *         limit = kwargs.pop('limit', None)
 *         offset = kwargs.pop('offset', None)
 */

static  void __pyx_f_8ctotable_7ToTable__set_limit(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, TDBQRY *__pyx_v_query_state, PyObject *__pyx_v_kwargs) {
  PyObject *__pyx_v_limit;
  PyObject *__pyx_v_offset;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("_set_limit");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_kwargs);
  __pyx_v_limit = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_offset = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":352
 * 
 *     cdef void _set_limit(ToTable self, TDBQRY* query_state, dict kwargs):
 *         limit = kwargs.pop('limit', None)             # <<<<<<<<<<<<<<
 *         offset = kwargs.pop('offset', None)
 *         if (limit is None and offset is None): return
 */
  __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_kwargs), __pyx_n_s__pop); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__limit));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__limit));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__limit));
  __Pyx_INCREF(Py_None);
  PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None);
  __Pyx_GIVEREF(Py_None);
  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_limit);
  __pyx_v_limit = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":353
 *     cdef void _set_limit(ToTable self, TDBQRY* query_state, dict kwargs):
 *         limit = kwargs.pop('limit', None)
 *         offset = kwargs.pop('offset', None)             # <<<<<<<<<<<<<<
 *         if (limit is None and offset is None): return
 *         if limit is None: limit = -1
 */
  __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_kwargs), __pyx_n_s__pop); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__offset));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__offset));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__offset));
  __Pyx_INCREF(Py_None);
  PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None);
  __Pyx_GIVEREF(Py_None);
  __pyx_t_1 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_v_offset);
  __pyx_v_offset = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":354
 *         limit = kwargs.pop('limit', None)
 *         offset = kwargs.pop('offset', None)
 *         if (limit is None and offset is None): return             # <<<<<<<<<<<<<<
 *         if limit is None: limit = -1
 *         if offset is None: offset = 0
 */
  __pyx_t_4 = (__pyx_v_limit == Py_None);
  if (__pyx_t_4) {
    __pyx_t_5 = (__pyx_v_offset == Py_None);
    __pyx_t_6 = __pyx_t_5;
  } else {
    __pyx_t_6 = __pyx_t_4;
  }
  if (__pyx_t_6) {
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/usr/local/src/totable/src/ctotable.pyx":355
 *         offset = kwargs.pop('offset', None)
 *         if (limit is None and offset is None): return
 *         if limit is None: limit = -1             # <<<<<<<<<<<<<<
 *         if offset is None: offset = 0
 *         tctdbqrysetlimit(query_state, <int>limit, <int>offset)
 */
  __pyx_t_6 = (__pyx_v_limit == Py_None);
  if (__pyx_t_6) {
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_DECREF(__pyx_v_limit);
    __pyx_v_limit = __pyx_int_neg_1;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "/usr/local/src/totable/src/ctotable.pyx":356
 *         if (limit is None and offset is None): return
 *         if limit is None: limit = -1
 *         if offset is None: offset = 0             # <<<<<<<<<<<<<<
 *         tctdbqrysetlimit(query_state, <int>limit, <int>offset)
 * 
 */
  __pyx_t_6 = (__pyx_v_offset == Py_None);
  if (__pyx_t_6) {
    __Pyx_INCREF(__pyx_int_0);
    __Pyx_DECREF(__pyx_v_offset);
    __pyx_v_offset = __pyx_int_0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/usr/local/src/totable/src/ctotable.pyx":357
 *         if limit is None: limit = -1
 *         if offset is None: offset = 0
 *         tctdbqrysetlimit(query_state, <int>limit, <int>offset)             # <<<<<<<<<<<<<<
 * 
 *     cdef void _set_callback(ToTable self, TDBQRY *query_state, dict kwargs):
 */
  __pyx_t_7 = __Pyx_PyInt_AsInt(__pyx_v_limit); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_offset); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  tctdbqrysetlimit(__pyx_v_query_state, ((int)__pyx_t_7), ((int)__pyx_t_8));

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("ctotable.ToTable._set_limit");
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_limit);
  __Pyx_DECREF(__pyx_v_offset);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_RefNannyFinishContext();
}

/* "/usr/local/src/totable/src/ctotable.pyx":359
 *         tctdbqrysetlimit(query_state, <int>limit, <int>offset)
 * 
 *     cdef void _set_callback(ToTable self, TDBQRY *query_state, dict kwargs):             # <<<<<<<<<<<<<<
 *         if not 'callback' in kwargs: return
 *         pycallback = kwargs['callback']
 */

static  void __pyx_f_8ctotable_7ToTable__set_callback(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, TDBQRY *__pyx_v_query_state, PyObject *__pyx_v_kwargs) {
  PyObject *__pyx_v_pycallback;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("_set_callback");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_kwargs);
  __pyx_v_pycallback = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":360
 * 
 *     cdef void _set_callback(ToTable self, TDBQRY *query_state, dict kwargs):
 *         if not 'callback' in kwargs: return             # <<<<<<<<<<<<<<
 *         pycallback = kwargs['callback']
 *         """
 */
  if (unlikely(((PyObject *)__pyx_v_kwargs) == Py_None)) {
    __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  } else {
    __pyx_t_1 = ((PyDict_Contains(((PyObject *)__pyx_v_kwargs), ((PyObject *)__pyx_n_s__callback)))); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/usr/local/src/totable/src/ctotable.pyx":361
 *     cdef void _set_callback(ToTable self, TDBQRY *query_state, dict kwargs):
 *         if not 'callback' in kwargs: return
 *         pycallback = kwargs['callback']             # <<<<<<<<<<<<<<
 *         """
 *         def pycallback(key, value):
 */
  __pyx_t_3 = PyObject_GetItem(((PyObject *)__pyx_v_kwargs), ((PyObject *)__pyx_n_s__callback)); if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_v_pycallback);
  __pyx_v_pycallback = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":366
 *             return key, value
 *         """
 *         tctdbqryproc(query_state, self.get_proc(<void *>pycallback), NULL)             # <<<<<<<<<<<<<<
 * 
 *     cdef TDBQRYPROC get_proc(self, void * pycallback):
 */
  tctdbqryproc(__pyx_v_query_state, ((struct __pyx_vtabstruct_8ctotable_ToTable *)__pyx_v_self->__pyx_vtab)->get_proc(__pyx_v_self, ((void *)__pyx_v_pycallback)), NULL);

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("ctotable.ToTable._set_callback");
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_pycallback);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_RefNannyFinishContext();
}

/* "/usr/local/src/totable/src/ctotable.pyx":368
 *         tctdbqryproc(query_state, self.get_proc(<void *>pycallback), NULL)
 * 
 *     cdef TDBQRYPROC get_proc(self, void * pycallback):             # <<<<<<<<<<<<<<
 *         # shrug.
 *         # cython/Demos/callback/cheese.pyx
 */

static  TDBQRYPROC __pyx_f_8ctotable_7ToTable_get_proc(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, void *__pyx_v_pycallback) {
  TDBQRYPROC __pyx_r;
  __Pyx_RefNannySetupContext("get_proc");

  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":373
 *         pass
 * 
 *     cdef void _set_order(ToTable self, TDBQRY* query_state, dict kwargs):             # <<<<<<<<<<<<<<
 *         if not 'order' in kwargs: return
 *         # TODO: handle nums. NUMASC, NUMDESC how?
 */

static  void __pyx_f_8ctotable_7ToTable__set_order(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, TDBQRY *__pyx_v_query_state, PyObject *__pyx_v_kwargs) {
  PyObject *__pyx_v_col;
  PyObject *__pyx_v_direction;
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  char *__pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("_set_order");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_kwargs);
  __pyx_v_col = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_direction = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":374
 * 
 *     cdef void _set_order(ToTable self, TDBQRY* query_state, dict kwargs):
 *         if not 'order' in kwargs: return             # <<<<<<<<<<<<<<
 *         # TODO: handle nums. NUMASC, NUMDESC how?
 *         #"order='+name' or order='-name'
 */
  if (unlikely(((PyObject *)__pyx_v_kwargs) == Py_None)) {
    __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  } else {
    __pyx_t_1 = ((PyDict_Contains(((PyObject *)__pyx_v_kwargs), ((PyObject *)__pyx_n_s__order)))); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_2 = (!__pyx_t_1);
  if (__pyx_t_2) {
    goto __pyx_L0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "/usr/local/src/totable/src/ctotable.pyx":377
 *         # TODO: handle nums. NUMASC, NUMDESC how?
 *         #"order='+name' or order='-name'
 *         col = kwargs['order']             # <<<<<<<<<<<<<<
 *         if col[0] not in ('+', '-'):
 *             direction = TDBQOSTRASC
 */
  __pyx_t_3 = PyObject_GetItem(((PyObject *)__pyx_v_kwargs), ((PyObject *)__pyx_n_s__order)); if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_v_col);
  __pyx_v_col = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":378
 *         #"order='+name' or order='-name'
 *         col = kwargs['order']
 *         if col[0] not in ('+', '-'):             # <<<<<<<<<<<<<<
 *             direction = TDBQOSTRASC
 *         else:
 */
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_col, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_kp_s_19), Py_NE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_2 == (int)-1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = ((int)__pyx_t_2);
  if (__pyx_t_1) {
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_kp_s_20), Py_NE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_2 == (int)-1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = ((int)__pyx_t_2);
    __pyx_t_2 = __pyx_t_5;
  } else {
    __pyx_t_2 = __pyx_t_1;
  }
  __pyx_t_1 = __pyx_t_2;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":379
 *         col = kwargs['order']
 *         if col[0] not in ('+', '-'):
 *             direction = TDBQOSTRASC             # <<<<<<<<<<<<<<
 *         else:
 *             direction = TDBQOSTRASC if col[0] == '+' else TDBQOSTRDESC
 */
    __pyx_t_3 = PyInt_FromLong(TDBQOSTRASC); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_v_direction);
    __pyx_v_direction = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L4;
  }
  /*else*/ {

    /* "/usr/local/src/totable/src/ctotable.pyx":381
 *             direction = TDBQOSTRASC
 *         else:
 *             direction = TDBQOSTRASC if col[0] == '+' else TDBQOSTRDESC             # <<<<<<<<<<<<<<
 *             col = col[1:]
 *         tctdbqrysetorder(query_state, col, direction)
 */
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_col, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_kp_s_19), Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {
      __pyx_t_6 = TDBQOSTRASC;
    } else {
      __pyx_t_6 = TDBQOSTRDESC;
    }
    __pyx_t_4 = PyInt_FromLong(__pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_direction);
    __pyx_v_direction = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":382
 *         else:
 *             direction = TDBQOSTRASC if col[0] == '+' else TDBQOSTRDESC
 *             col = col[1:]             # <<<<<<<<<<<<<<
 *         tctdbqrysetorder(query_state, col, direction)
 * 
 */
    __pyx_t_4 = PySequence_GetSlice(__pyx_v_col, 1, PY_SSIZE_T_MAX); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_v_col);
    __pyx_v_col = __pyx_t_4;
    __pyx_t_4 = 0;
  }
  __pyx_L4:;

  /* "/usr/local/src/totable/src/ctotable.pyx":383
 *             direction = TDBQOSTRASC if col[0] == '+' else TDBQOSTRDESC
 *             col = col[1:]
 *         tctdbqrysetorder(query_state, col, direction)             # <<<<<<<<<<<<<<
 * 
 *     def count(self, *args, **kwargs):
 */
  __pyx_t_7 = __Pyx_PyBytes_AsString(__pyx_v_col); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_direction); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  tctdbqrysetorder(__pyx_v_query_state, __pyx_t_7, __pyx_t_8);

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_WriteUnraisable("ctotable.ToTable._set_order");
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_col);
  __Pyx_DECREF(__pyx_v_direction);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_RefNannyFinishContext();
}

/* "/usr/local/src/totable/src/ctotable.pyx":385
 *         tctdbqrysetorder(query_state, col, direction)
 * 
 *     def count(self, *args, **kwargs):             # <<<<<<<<<<<<<<
 *         kwargs['count'] = True
 *         return self.select(*args, **kwargs)
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_count(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_count(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("count");
  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "count", 1))) return NULL;
  __pyx_v_kwargs = (__pyx_kwds) ? PyDict_Copy(__pyx_kwds) : PyDict_New();
  if (unlikely(!__pyx_v_kwargs)) return NULL;
  __Pyx_GOTREF(__pyx_v_kwargs);
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/usr/local/src/totable/src/ctotable.pyx":386
 * 
 *     def count(self, *args, **kwargs):
 *         kwargs['count'] = True             # <<<<<<<<<<<<<<
 *         return self.select(*args, **kwargs)
 * 
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetItem(__pyx_v_kwargs, ((PyObject *)__pyx_n_s__count), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":387
 *     def count(self, *args, **kwargs):
 *         kwargs['count'] = True
 *         return self.select(*args, **kwargs)             # <<<<<<<<<<<<<<
 * 
 *     def delete(self, *args, **kwargs):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__select); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_2), __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.ToTable.count");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":389
 *         return self.select(*args, **kwargs)
 * 
 *     def delete(self, *args, **kwargs):             # <<<<<<<<<<<<<<
 *         kwargs['delete'] = True
 *         return self.select(*args, **kwargs)
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_delete(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("delete");
  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "delete", 1))) return NULL;
  __pyx_v_kwargs = (__pyx_kwds) ? PyDict_Copy(__pyx_kwds) : PyDict_New();
  if (unlikely(!__pyx_v_kwargs)) return NULL;
  __Pyx_GOTREF(__pyx_v_kwargs);
  __Pyx_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/usr/local/src/totable/src/ctotable.pyx":390
 * 
 *     def delete(self, *args, **kwargs):
 *         kwargs['delete'] = True             # <<<<<<<<<<<<<<
 *         return self.select(*args, **kwargs)
 * 
 */
  __pyx_t_1 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetItem(__pyx_v_kwargs, ((PyObject *)__pyx_n_s__delete), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":391
 *     def delete(self, *args, **kwargs):
 *         kwargs['delete'] = True
 *         return self.select(*args, **kwargs)             # <<<<<<<<<<<<<<
 * 
 *     def select(self, *args, bint values_only=False, **kwargs):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__select); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_2), __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.ToTable.delete");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":393
 *         return self.select(*args, **kwargs)
 * 
 *     def select(self, *args, bint values_only=False, **kwargs):             # <<<<<<<<<<<<<<
 *         # cool. mixing *args and a single kwarg with kwargs
 *         # not allowed in python 2.XX
 */

static PyObject *__pyx_pf_8ctotable_7ToTable_select(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_8ctotable_7ToTable_select(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_values_only;
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  struct __pyx_obj_8ctotable_TCQuery *__pyx_v_q = 0;
  TCLIST *__pyx_v_tclist;
  PyObject *__pyx_v_li = 0;
  int __pyx_v_count;
  PyObject *__pyx_v_kwskip;
  PyObject *__pyx_v_colname;
  PyObject *__pyx_v_other;
  PyObject *__pyx_v_col;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  char *__pyx_t_8;
  int __pyx_t_9;
  char *__pyx_t_10;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__values_only,0};
  __Pyx_RefNannySetupContext("select");
  __pyx_v_kwargs = PyDict_New(); if (unlikely(!__pyx_v_kwargs)) return NULL;
  __Pyx_GOTREF(__pyx_v_kwargs);
  if (PyTuple_GET_SIZE(__pyx_args) > 0) {
    __pyx_v_args = PyTuple_GetSlice(__pyx_args, 0, PyTuple_GET_SIZE(__pyx_args)); __Pyx_GOTREF(__pyx_v_args);

    if (unlikely(!__pyx_v_args)) {
      __Pyx_DECREF(__pyx_v_kwargs);
      return NULL;
    }
  } else {
    __pyx_v_args = __pyx_empty_tuple; __Pyx_INCREF(__pyx_empty_tuple);
  }
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      default:
      case  0: break;
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, __pyx_v_kwargs, values, 0, "select") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    if (values[0]) {
      __pyx_v_values_only = __Pyx_PyObject_IsTrue(values[0]); if (unlikely((__pyx_v_values_only == (int)-1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_values_only = ((int)0);
    }
  } else if (PyTuple_GET_SIZE(__pyx_args) < 0) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_values_only = ((int)0);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("select", 0, 0, 0, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_AddTraceback("ctotable.ToTable.select");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_kwskip = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_colname = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_other = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_col = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":397
 *         # not allowed in python 2.XX
 * 
 *         cdef TCQuery q = make_query(self._state)             # <<<<<<<<<<<<<<
 *         #cdef TDBQRY* query_state = tctdbqrynew(self._state)
 *         cdef TCLIST *tclist
 */
  __pyx_t_1 = ((PyObject *)__pyx_f_8ctotable_make_query(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->_state)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_q = ((struct __pyx_obj_8ctotable_TCQuery *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":400
 *         #cdef TDBQRY* query_state = tctdbqrynew(self._state)
 *         cdef TCLIST *tclist
 *         cdef list li = []             # <<<<<<<<<<<<<<
 *         cdef int count
 * 
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_v_li = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":403
 *         cdef int count
 * 
 *         kwskip = ('delete', 'order', 'count', 'limit', 'offset', 'values_only', 'callback')             # <<<<<<<<<<<<<<
 * 
 *         # tbl.select(name='fred', age=22)
 */
  __pyx_t_1 = PyTuple_New(7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_n_s__delete));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__delete));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__delete));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__order));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_n_s__order));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__order));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__count));
  PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)__pyx_n_s__count));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__count));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__limit));
  PyTuple_SET_ITEM(__pyx_t_1, 3, ((PyObject *)__pyx_n_s__limit));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__limit));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__offset));
  PyTuple_SET_ITEM(__pyx_t_1, 4, ((PyObject *)__pyx_n_s__offset));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__offset));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__values_only));
  PyTuple_SET_ITEM(__pyx_t_1, 5, ((PyObject *)__pyx_n_s__values_only));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__values_only));
  __Pyx_INCREF(((PyObject *)__pyx_n_s__callback));
  PyTuple_SET_ITEM(__pyx_t_1, 6, ((PyObject *)__pyx_n_s__callback));
  __Pyx_GIVEREF(((PyObject *)__pyx_n_s__callback));
  __Pyx_DECREF(__pyx_v_kwskip);
  __pyx_v_kwskip = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":407
 *         # tbl.select(name='fred', age=22)
 *         # convert age=22 to Col('age') == 22
 *         args = list(args)             # <<<<<<<<<<<<<<
 *         for colname, other in kwargs.items():
 *             if colname in kwskip: continue
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_args);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_args);
  __Pyx_GIVEREF(__pyx_v_args);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyList_Type)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_v_args);
  __pyx_v_args = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":408
 *         # convert age=22 to Col('age') == 22
 *         args = list(args)
 *         for colname, other in kwargs.items():             # <<<<<<<<<<<<<<
 *             if colname in kwskip: continue
 *             args.append(Col(colname) == other)
 */
  __pyx_t_2 = PyObject_GetAttr(__pyx_v_kwargs, __pyx_n_s__items); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyList_CheckExact(__pyx_t_1) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_3 = 0; __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2);
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_2))) {
      if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_2))) {
      if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++;
    } else {
      __pyx_t_1 = PyIter_Next(__pyx_t_2);
      if (!__pyx_t_1) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
      PyObject* tuple = __pyx_t_1;
      __pyx_t_4 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_4);
      __pyx_t_5 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_v_colname);
      __pyx_v_colname = __pyx_t_4;
      __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_v_other);
      __pyx_v_other = __pyx_t_5;
      __pyx_t_5 = 0;
    } else {
      __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_4 = __Pyx_UnpackItem(__pyx_t_6, 0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_UnpackItem(__pyx_t_6, 1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (__Pyx_EndUnpack(__pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_v_colname);
      __pyx_v_colname = __pyx_t_4;
      __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_v_other);
      __pyx_v_other = __pyx_t_5;
      __pyx_t_5 = 0;
    }

    /* "/usr/local/src/totable/src/ctotable.pyx":409
 *         args = list(args)
 *         for colname, other in kwargs.items():
 *             if colname in kwskip: continue             # <<<<<<<<<<<<<<
 *             args.append(Col(colname) == other)
 * 
 */
    __pyx_t_7 = ((PySequence_Contains(__pyx_v_kwskip, __pyx_v_colname))); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_7) {
      goto __pyx_L6_continue;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "/usr/local/src/totable/src/ctotable.pyx":410
 *         for colname, other in kwargs.items():
 *             if colname in kwskip: continue
 *             args.append(Col(colname) == other)             # <<<<<<<<<<<<<<
 * 
 *         for col in args:
 */
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_colname);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_colname);
    __Pyx_GIVEREF(__pyx_v_colname);
    __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8ctotable_Col)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_5, __pyx_v_other, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_Append(__pyx_v_args, __pyx_t_1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_L6_continue:;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":412
 *             args.append(Col(colname) == other)
 * 
 *         for col in args:             # <<<<<<<<<<<<<<
 *             # separate these out rather than |'ing here because
 *             # they may reuse the Col object.
 */
  if (PyList_CheckExact(__pyx_v_args) || PyTuple_CheckExact(__pyx_v_args)) {
    __pyx_t_3 = 0; __pyx_t_2 = __pyx_v_args; __Pyx_INCREF(__pyx_t_2);
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_args); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
  }
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_t_2))) {
      if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++;
    } else if (likely(PyTuple_CheckExact(__pyx_t_2))) {
      if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
      __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++;
    } else {
      __pyx_t_5 = PyIter_Next(__pyx_t_2);
      if (!__pyx_t_5) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
      __Pyx_GOTREF(__pyx_t_5);
    }
    __Pyx_DECREF(__pyx_v_col);
    __pyx_v_col = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":415
 *             # separate these out rather than |'ing here because
 *             # they may reuse the Col object.
 *             if col.invert:             # <<<<<<<<<<<<<<
 *                 tctdbqryaddcond(q._state, <char *>col.colname,
 *                                 <int>(col.op | TDBQCNEGATE), <char *>col.other)
 */
    __pyx_t_5 = PyObject_GetAttr(__pyx_v_col, __pyx_n_s__invert); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_7) {

      /* "/usr/local/src/totable/src/ctotable.pyx":416
 *             # they may reuse the Col object.
 *             if col.invert:
 *                 tctdbqryaddcond(q._state, <char *>col.colname,             # <<<<<<<<<<<<<<
 *                                 <int>(col.op | TDBQCNEGATE), <char *>col.other)
 *             else:
 */
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_col, __pyx_n_s__colname); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = __Pyx_PyBytes_AsString(__pyx_t_5); if (unlikely((!__pyx_t_8) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "/usr/local/src/totable/src/ctotable.pyx":417
 *             if col.invert:
 *                 tctdbqryaddcond(q._state, <char *>col.colname,
 *                                 <int>(col.op | TDBQCNEGATE), <char *>col.other)             # <<<<<<<<<<<<<<
 *             else:
 *                 tctdbqryaddcond(q._state, <char *>col.colname, <int>col.op,
 */
      __pyx_t_5 = PyObject_GetAttr(__pyx_v_col, __pyx_n_s__op); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = PyInt_FromLong(TDBQCNEGATE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyNumber_Or(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_t_4); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_GetAttr(__pyx_v_col, __pyx_n_s__other); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_PyBytes_AsString(__pyx_t_4); if (unlikely((!__pyx_t_10) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 417; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      tctdbqryaddcond(__pyx_v_q->_state, ((char *)__pyx_t_8), ((int)__pyx_t_9), ((char *)__pyx_t_10));
      goto __pyx_L11;
    }
    /*else*/ {

      /* "/usr/local/src/totable/src/ctotable.pyx":419
 *                                 <int>(col.op | TDBQCNEGATE), <char *>col.other)
 *             else:
 *                 tctdbqryaddcond(q._state, <char *>col.colname, <int>col.op,             # <<<<<<<<<<<<<<
 *                                 <char *>col.other)
 * 
 */
      __pyx_t_4 = PyObject_GetAttr(__pyx_v_col, __pyx_n_s__colname); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_PyBytes_AsString(__pyx_t_4); if (unlikely((!__pyx_t_10) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_GetAttr(__pyx_v_col, __pyx_n_s__op); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_t_4); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "/usr/local/src/totable/src/ctotable.pyx":420
 *             else:
 *                 tctdbqryaddcond(q._state, <char *>col.colname, <int>col.op,
 *                                 <char *>col.other)             # <<<<<<<<<<<<<<
 * 
 *         self._set_limit(q._state, kwargs)
 */
      __pyx_t_4 = PyObject_GetAttr(__pyx_v_col, __pyx_n_s__other); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_8 = __Pyx_PyBytes_AsString(__pyx_t_4); if (unlikely((!__pyx_t_8) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 420; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      tctdbqryaddcond(__pyx_v_q->_state, ((char *)__pyx_t_10), ((int)__pyx_t_9), ((char *)__pyx_t_8));
    }
    __pyx_L11:;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":422
 *                                 <char *>col.other)
 * 
 *         self._set_limit(q._state, kwargs)             # <<<<<<<<<<<<<<
 *         self._set_order(q._state, kwargs)
 *         self._set_callback(q._state, kwargs)
 */
  if (!(likely(PyDict_CheckExact(__pyx_v_kwargs))||((__pyx_v_kwargs) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_v_kwargs)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 422; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_set_limit(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_q->_state, ((PyObject *)__pyx_v_kwargs));

  /* "/usr/local/src/totable/src/ctotable.pyx":423
 * 
 *         self._set_limit(q._state, kwargs)
 *         self._set_order(q._state, kwargs)             # <<<<<<<<<<<<<<
 *         self._set_callback(q._state, kwargs)
 * 
 */
  if (!(likely(PyDict_CheckExact(__pyx_v_kwargs))||((__pyx_v_kwargs) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_v_kwargs)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_set_order(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_q->_state, ((PyObject *)__pyx_v_kwargs));

  /* "/usr/local/src/totable/src/ctotable.pyx":424
 *         self._set_limit(q._state, kwargs)
 *         self._set_order(q._state, kwargs)
 *         self._set_callback(q._state, kwargs)             # <<<<<<<<<<<<<<
 * 
 *         if 'delete' in kwargs:
 */
  if (!(likely(PyDict_CheckExact(__pyx_v_kwargs))||((__pyx_v_kwargs) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_v_kwargs)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_set_callback(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_q->_state, ((PyObject *)__pyx_v_kwargs));

  /* "/usr/local/src/totable/src/ctotable.pyx":426
 *         self._set_callback(q._state, kwargs)
 * 
 *         if 'delete' in kwargs:             # <<<<<<<<<<<<<<
 *             return tctdbqrysearchout(q._state)
 * 
 */
  __pyx_t_7 = ((PySequence_Contains(__pyx_v_kwargs, ((PyObject *)__pyx_n_s__delete)))); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_7) {

    /* "/usr/local/src/totable/src/ctotable.pyx":427
 * 
 *         if 'delete' in kwargs:
 *             return tctdbqrysearchout(q._state)             # <<<<<<<<<<<<<<
 * 
 *         tclist = tctdbqrysearch(q._state)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = __Pyx_PyBool_FromLong(tctdbqrysearchout(__pyx_v_q->_state)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 427; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L12;
  }
  __pyx_L12:;

  /* "/usr/local/src/totable/src/ctotable.pyx":429
 *             return tctdbqrysearchout(q._state)
 * 
 *         tclist = tctdbqrysearch(q._state)             # <<<<<<<<<<<<<<
 *         # number of elements in the list
 *         count = tclistnum(tclist)
 */
  __pyx_v_tclist = tctdbqrysearch(__pyx_v_q->_state);

  /* "/usr/local/src/totable/src/ctotable.pyx":431
 *         tclist = tctdbqrysearch(q._state)
 *         # number of elements in the list
 *         count = tclistnum(tclist)             # <<<<<<<<<<<<<<
 * 
 *         if 'count' in kwargs:
 */
  __pyx_v_count = tclistnum(__pyx_v_tclist);

  /* "/usr/local/src/totable/src/ctotable.pyx":433
 *         count = tclistnum(tclist)
 * 
 *         if 'count' in kwargs:             # <<<<<<<<<<<<<<
 *             tclistdel(tclist)
 *             return count
 */
  __pyx_t_7 = ((PySequence_Contains(__pyx_v_kwargs, ((PyObject *)__pyx_n_s__count)))); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 433; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_7) {

    /* "/usr/local/src/totable/src/ctotable.pyx":434
 * 
 *         if 'count' in kwargs:
 *             tclistdel(tclist)             # <<<<<<<<<<<<<<
 *             return count
 * 
 */
    tclistdel(__pyx_v_tclist);

    /* "/usr/local/src/totable/src/ctotable.pyx":435
 *         if 'count' in kwargs:
 *             tclistdel(tclist)
 *             return count             # <<<<<<<<<<<<<<
 * 
 *         li = self._tclist_to_list(tclist, count, values_only)
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyInt_FromLong(__pyx_v_count); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
    goto __pyx_L13;
  }
  __pyx_L13:;

  /* "/usr/local/src/totable/src/ctotable.pyx":437
 *             return count
 * 
 *         li = self._tclist_to_list(tclist, count, values_only)             # <<<<<<<<<<<<<<
 *         tclistdel(tclist)
 *         return li
 */
  __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_8ctotable_ToTable *)((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self)->__pyx_vtab)->_tclist_to_list(((struct __pyx_obj_8ctotable_ToTable *)__pyx_v_self), __pyx_v_tclist, __pyx_v_count, __pyx_v_values_only)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_v_li));
  __pyx_v_li = ((PyObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":438
 * 
 *         li = self._tclist_to_list(tclist, count, values_only)
 *         tclistdel(tclist)             # <<<<<<<<<<<<<<
 *         return li
 * 
 */
  tclistdel(__pyx_v_tclist);

  /* "/usr/local/src/totable/src/ctotable.pyx":439
 *         li = self._tclist_to_list(tclist, count, values_only)
 *         tclistdel(tclist)
 *         return li             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_li));
  __pyx_r = ((PyObject *)__pyx_v_li);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("ctotable.ToTable.select");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_args);
  __Pyx_DECREF(__pyx_v_kwargs);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_li);
  __Pyx_DECREF(__pyx_v_kwskip);
  __Pyx_DECREF(__pyx_v_colname);
  __Pyx_DECREF(__pyx_v_other);
  __Pyx_DECREF(__pyx_v_col);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":442
 * 
 * 
 *     cdef list _tclist_to_list(ToTable self, TCLIST *tclist, int count,             # <<<<<<<<<<<<<<
 *                               bint values_only):
 *         # INTERNAL: the calling function is still responsible for deleting
 */

static  PyObject *__pyx_f_8ctotable_7ToTable__tclist_to_list(struct __pyx_obj_8ctotable_ToTable *__pyx_v_self, TCLIST *__pyx_v_tclist, int __pyx_v_count, int __pyx_v_values_only) {
  PyObject *__pyx_v_li = 0;
  char *__pyx_v_kbuf;
  int __pyx_v_ksiz;
  int __pyx_v_i;
  PyObject *__pyx_v_d;
  PyObject *__pyx_v_key;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("_tclist_to_list");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __pyx_v_d = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":446
 *         # INTERNAL: the calling function is still responsible for deleting
 *         # tclist.
 *         cdef list li = []             # <<<<<<<<<<<<<<
 *         cdef char *kbuf
 *         cdef int ksiz, i
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_v_li = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":450
 *         cdef int ksiz, i
 *         cdef dict d
 *         for i in range(count):             # <<<<<<<<<<<<<<
 *             kbuf = <char *>tclistval(tclist, i, &ksiz)
 *             d = self._ckey_to_dict(kbuf, ksiz)
 */
  __pyx_t_2 = __pyx_v_count;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;

    /* "/usr/local/src/totable/src/ctotable.pyx":451
 *         cdef dict d
 *         for i in range(count):
 *             kbuf = <char *>tclistval(tclist, i, &ksiz)             # <<<<<<<<<<<<<<
 *             d = self._ckey_to_dict(kbuf, ksiz)
 *             if values_only:
 */
    __pyx_v_kbuf = ((char *)tclistval(__pyx_v_tclist, __pyx_v_i, (&__pyx_v_ksiz)));

    /* "/usr/local/src/totable/src/ctotable.pyx":452
 *         for i in range(count):
 *             kbuf = <char *>tclistval(tclist, i, &ksiz)
 *             d = self._ckey_to_dict(kbuf, ksiz)             # <<<<<<<<<<<<<<
 *             if values_only:
 *                 li.append(d)
 */
    __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8ctotable_ToTable *)__pyx_v_self->__pyx_vtab)->_ckey_to_dict(__pyx_v_self, __pyx_v_kbuf, __pyx_v_ksiz)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(((PyObject *)__pyx_v_d));
    __pyx_v_d = ((PyObject *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":453
 *             kbuf = <char *>tclistval(tclist, i, &ksiz)
 *             d = self._ckey_to_dict(kbuf, ksiz)
 *             if values_only:             # <<<<<<<<<<<<<<
 *                 li.append(d)
 *             else:
 */
    __pyx_t_4 = __pyx_v_values_only;
    if (__pyx_t_4) {

      /* "/usr/local/src/totable/src/ctotable.pyx":454
 *             d = self._ckey_to_dict(kbuf, ksiz)
 *             if values_only:
 *                 li.append(d)             # <<<<<<<<<<<<<<
 *             else:
 *                 key = ps.PyString_FromStringAndSize(kbuf, <Py_ssize_t>ksiz)
 */
      if (unlikely(__pyx_v_li == Py_None)) {
        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
      }
      __pyx_t_5 = PyList_Append(((PyObject *)__pyx_v_li), ((PyObject *)__pyx_v_d)); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L5;
    }
    /*else*/ {

      /* "/usr/local/src/totable/src/ctotable.pyx":456
 *                 li.append(d)
 *             else:
 *                 key = ps.PyString_FromStringAndSize(kbuf, <Py_ssize_t>ksiz)             # <<<<<<<<<<<<<<
 *                 li.append((key, d))
 *         return li
 */
      __pyx_t_1 = PyString_FromStringAndSize(__pyx_v_kbuf, ((Py_ssize_t)__pyx_v_ksiz)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_v_key);
      __pyx_v_key = __pyx_t_1;
      __pyx_t_1 = 0;

      /* "/usr/local/src/totable/src/ctotable.pyx":457
 *             else:
 *                 key = ps.PyString_FromStringAndSize(kbuf, <Py_ssize_t>ksiz)
 *                 li.append((key, d))             # <<<<<<<<<<<<<<
 *         return li
 * 
 */
      if (unlikely(__pyx_v_li == Py_None)) {
        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
      }
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_key);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_key);
      __Pyx_GIVEREF(__pyx_v_key);
      __Pyx_INCREF(((PyObject *)__pyx_v_d));
      PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_d));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_d));
      __pyx_t_5 = PyList_Append(((PyObject *)__pyx_v_li), __pyx_t_1); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 457; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_L5:;
  }

  /* "/usr/local/src/totable/src/ctotable.pyx":458
 *                 key = ps.PyString_FromStringAndSize(kbuf, <Py_ssize_t>ksiz)
 *                 li.append((key, d))
 *         return li             # <<<<<<<<<<<<<<
 * 
 * cdef class Col(object):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_li));
  __pyx_r = __pyx_v_li;
  goto __pyx_L0;

  __pyx_r = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.ToTable._tclist_to_list");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_li);
  __Pyx_DECREF(__pyx_v_d);
  __Pyx_DECREF(__pyx_v_key);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":473
 *     cdef readonly bint invert
 * 
 *     def __cinit__(self, colname):             # <<<<<<<<<<<<<<
 *         self.invert = False
 *         self.num_lookups= {
 */

static int __pyx_pf_8ctotable_3Col___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_8ctotable_3Col___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_colname = 0;
  int __pyx_r;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__colname,0};
  __Pyx_RefNannySetupContext("__cinit__");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__colname);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__cinit__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_colname = values[0];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_colname = PyTuple_GET_ITEM(__pyx_args, 0);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.Col.__cinit__");
  return -1;
  __pyx_L4_argument_unpacking_done:;

  /* "/usr/local/src/totable/src/ctotable.pyx":474
 * 
 *     def __cinit__(self, colname):
 *         self.invert = False             # <<<<<<<<<<<<<<
 *         self.num_lookups= {
 *                 0: TDBQCNUMLT, # <
 */
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->invert = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":475
 *     def __cinit__(self, colname):
 *         self.invert = False
 *         self.num_lookups= {             # <<<<<<<<<<<<<<
 *                 0: TDBQCNUMLT, # <
 *                 1: TDBQCNUMLE, # <=
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));

  /* "/usr/local/src/totable/src/ctotable.pyx":476
 *         self.invert = False
 *         self.num_lookups= {
 *                 0: TDBQCNUMLT, # <             # <<<<<<<<<<<<<<
 *                 1: TDBQCNUMLE, # <=
 *                 2: TDBQCNUMEQ, # ==
 */
  __pyx_t_2 = PyInt_FromLong(TDBQCNUMLT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_int_0, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":477
 *         self.num_lookups= {
 *                 0: TDBQCNUMLT, # <
 *                 1: TDBQCNUMLE, # <=             # <<<<<<<<<<<<<<
 *                 2: TDBQCNUMEQ, # ==
 *                 3: TDBQCNUMEQ | TDBQCNEGATE, # !=. # TODO test.
 */
  __pyx_t_2 = PyInt_FromLong(TDBQCNUMLE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_int_1, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":478
 *                 0: TDBQCNUMLT, # <
 *                 1: TDBQCNUMLE, # <=
 *                 2: TDBQCNUMEQ, # ==             # <<<<<<<<<<<<<<
 *                 3: TDBQCNUMEQ | TDBQCNEGATE, # !=. # TODO test.
 *                 4: TDBQCNUMGT, # >
 */
  __pyx_t_2 = PyInt_FromLong(TDBQCNUMEQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_int_2, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":479
 *                 1: TDBQCNUMLE, # <=
 *                 2: TDBQCNUMEQ, # ==
 *                 3: TDBQCNUMEQ | TDBQCNEGATE, # !=. # TODO test.             # <<<<<<<<<<<<<<
 *                 4: TDBQCNUMGT, # >
 *                 5: TDBQCNUMGE  # >=
 */
  __pyx_t_2 = PyInt_FromLong((TDBQCNUMEQ | TDBQCNEGATE)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_int_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":480
 *                 2: TDBQCNUMEQ, # ==
 *                 3: TDBQCNUMEQ | TDBQCNEGATE, # !=. # TODO test.
 *                 4: TDBQCNUMGT, # >             # <<<<<<<<<<<<<<
 *                 5: TDBQCNUMGE  # >=
 *             }
 */
  __pyx_t_2 = PyInt_FromLong(TDBQCNUMGT); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_int_4, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":482
 *                 4: TDBQCNUMGT, # >
 *                 5: TDBQCNUMGE  # >=
 *             }             # <<<<<<<<<<<<<<
 *         self.colname = colname
 *     """
 */
  __pyx_t_2 = PyInt_FromLong(TDBQCNUMGE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_int_5, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":475
 *     def __cinit__(self, colname):
 *         self.invert = False
 *         self.num_lookups= {             # <<<<<<<<<<<<<<
 *                 0: TDBQCNUMLT, # <
 *                 1: TDBQCNUMLE, # <=
 */
  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->num_lookups);
  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->num_lookups));
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->num_lookups = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":483
 *                 5: TDBQCNUMGE  # >=
 *             }
 *         self.colname = colname             # <<<<<<<<<<<<<<
 *     """
 *     void tctdbqryaddcond(TDBQRY *qry, const char *name, int op, const char *expr);
 */
  __Pyx_INCREF(__pyx_v_colname);
  __Pyx_GIVEREF(__pyx_v_colname);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->colname);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->colname);
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->colname = __pyx_v_colname;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("ctotable.Col.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":499
 *     # http://docs.cython.org/docs/special_methods.html
 *     # < 0 | <= 1 | == 2 | != 3 |  > 4 | >= 5
 *     def __richcmp__(self, other, op):             # <<<<<<<<<<<<<<
 *         self.other = unicode(other)
 *         if isinstance(other, (int, long, float)):
 */

static PyObject *__pyx_pf_8ctotable_3Col___richcmp__(PyObject *__pyx_v_self, PyObject *__pyx_v_other, int __pyx_arg_op); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col___richcmp__(PyObject *__pyx_v_self, PyObject *__pyx_v_other, int __pyx_arg_op) {
  PyObject *__pyx_v_op = 0;
  PyObject *__pyx_v_str_lookups;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("__richcmp__");
  __pyx_v_op = PyInt_FromLong(__pyx_arg_op); if (unlikely(!__pyx_v_op)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 499; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __Pyx_GOTREF(__pyx_v_op);
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.Col.__richcmp__");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_self);
  __Pyx_INCREF(__pyx_v_other);
  __pyx_v_str_lookups = Py_None; __Pyx_INCREF(Py_None);

  /* "/usr/local/src/totable/src/ctotable.pyx":500
 *     # < 0 | <= 1 | == 2 | != 3 |  > 4 | >= 5
 *     def __richcmp__(self, other, op):
 *         self.other = unicode(other)             # <<<<<<<<<<<<<<
 *         if isinstance(other, (int, long, float)):
 *             self.op = self.num_lookups[op]
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_other);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_other);
  __Pyx_GIVEREF(__pyx_v_other);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyUnicode_Type)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyObject_SetAttr(__pyx_v_self, __pyx_n_s__other, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":501
 *     def __richcmp__(self, other, op):
 *         self.other = unicode(other)
 *         if isinstance(other, (int, long, float)):             # <<<<<<<<<<<<<<
 *             self.op = self.num_lookups[op]
 *         else:
 */
  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)((PyObject*)&PyInt_Type)));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)((PyObject*)&PyInt_Type)));
  __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyInt_Type)));
  __Pyx_INCREF(((PyObject *)((PyObject*)&PyLong_Type)));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)((PyObject*)&PyLong_Type)));
  __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyLong_Type)));
  __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
  PyTuple_SET_ITEM(__pyx_t_2, 2, ((PyObject *)((PyObject*)&PyFloat_Type)));
  __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
  __pyx_t_3 = PyObject_IsInstance(__pyx_v_other, __pyx_t_2); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "/usr/local/src/totable/src/ctotable.pyx":502
 *         self.other = unicode(other)
 *         if isinstance(other, (int, long, float)):
 *             self.op = self.num_lookups[op]             # <<<<<<<<<<<<<<
 *         else:
 *             str_lookups= {
 */
    __pyx_t_2 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__num_lookups); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyObject_GetItem(__pyx_t_2, __pyx_v_op); if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (PyObject_SetAttr(__pyx_v_self, __pyx_n_s__op, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/usr/local/src/totable/src/ctotable.pyx":504
 *             self.op = self.num_lookups[op]
 *         else:
 *             str_lookups= {             # <<<<<<<<<<<<<<
 *                 2: TDBQCSTREQ, # ==
 *                 3: TDBQCSTREQ | TDBQCNEGATE # not equal.
 */
    __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));

    /* "/usr/local/src/totable/src/ctotable.pyx":505
 *         else:
 *             str_lookups= {
 *                 2: TDBQCSTREQ, # ==             # <<<<<<<<<<<<<<
 *                 3: TDBQCSTREQ | TDBQCNEGATE # not equal.
 *             }
 */
    __pyx_t_2 = PyInt_FromLong(TDBQCSTREQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_1, __pyx_int_2, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":507
 *                 2: TDBQCSTREQ, # ==
 *                 3: TDBQCSTREQ | TDBQCNEGATE # not equal.
 *             }             # <<<<<<<<<<<<<<
 *             self.op = str_lookups[op]
 *         return self
 */
    __pyx_t_2 = PyInt_FromLong((TDBQCSTREQ | TDBQCNEGATE)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 506; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_1, __pyx_int_3, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 504; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_v_str_lookups);
    __pyx_v_str_lookups = ((PyObject *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "/usr/local/src/totable/src/ctotable.pyx":508
 *                 3: TDBQCSTREQ | TDBQCNEGATE # not equal.
 *             }
 *             self.op = str_lookups[op]             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
    __pyx_t_1 = PyObject_GetItem(__pyx_v_str_lookups, __pyx_v_op); if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (PyObject_SetAttr(__pyx_v_self, __pyx_n_s__op, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_L5:;

  /* "/usr/local/src/totable/src/ctotable.pyx":509
 *             }
 *             self.op = str_lookups[op]
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def __invert__(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("ctotable.Col.__richcmp__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_op);
  __Pyx_DECREF(__pyx_v_str_lookups);
  __Pyx_DECREF(__pyx_v_self);
  __Pyx_DECREF(__pyx_v_other);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":511
 *         return self
 * 
 *     def __invert__(self):             # <<<<<<<<<<<<<<
 *         # ~Col('age') == 180
 *         self.invert = not self.invert
 */

static PyObject *__pyx_pf_8ctotable_3Col___invert__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col___invert__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__invert__");

  /* "/usr/local/src/totable/src/ctotable.pyx":513
 *     def __invert__(self):
 *         # ~Col('age') == 180
 *         self.invert = not self.invert             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->invert = (!((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->invert);

  /* "/usr/local/src/totable/src/ctotable.pyx":514
 *         # ~Col('age') == 180
 *         self.invert = not self.invert
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def matches(self, pattern):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":516
 *         return self
 * 
 *     def matches(self, pattern):             # <<<<<<<<<<<<<<
 *         self.op = TDBQCSTRRX
 *         self.other = pattern
 */

static PyObject *__pyx_pf_8ctotable_3Col_matches(PyObject *__pyx_v_self, PyObject *__pyx_v_pattern); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col_matches(PyObject *__pyx_v_self, PyObject *__pyx_v_pattern) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("matches");

  /* "/usr/local/src/totable/src/ctotable.pyx":517
 * 
 *     def matches(self, pattern):
 *         self.op = TDBQCSTRRX             # <<<<<<<<<<<<<<
 *         self.other = pattern
 *         return self
 */
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->op = TDBQCSTRRX;

  /* "/usr/local/src/totable/src/ctotable.pyx":518
 *     def matches(self, pattern):
 *         self.op = TDBQCSTRRX
 *         self.other = pattern             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __Pyx_INCREF(__pyx_v_pattern);
  __Pyx_GIVEREF(__pyx_v_pattern);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other = __pyx_v_pattern;

  /* "/usr/local/src/totable/src/ctotable.pyx":519
 *         self.op = TDBQCSTRRX
 *         self.other = pattern
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def in_list(self, li):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":521
 *         return self
 * 
 *     def in_list(self, li):             # <<<<<<<<<<<<<<
 *         if isinstance(li[0], basestring):
 *             self.op = TDBQCSTROREQ if len(li) > 1 else TDBQCSTREQ
 */

static PyObject *__pyx_pf_8ctotable_3Col_in_list(PyObject *__pyx_v_self, PyObject *__pyx_v_li); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col_in_list(PyObject *__pyx_v_self, PyObject *__pyx_v_li) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  __Pyx_RefNannySetupContext("in_list");
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_li);

  /* "/usr/local/src/totable/src/ctotable.pyx":522
 * 
 *     def in_list(self, li):
 *         if isinstance(li[0], basestring):             # <<<<<<<<<<<<<<
 *             self.op = TDBQCSTROREQ if len(li) > 1 else TDBQCSTREQ
 *         else:
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_li, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_IsInstance(__pyx_t_1, __pyx_builtin_basestring); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "/usr/local/src/totable/src/ctotable.pyx":523
 *     def in_list(self, li):
 *         if isinstance(li[0], basestring):
 *             self.op = TDBQCSTROREQ if len(li) > 1 else TDBQCSTREQ             # <<<<<<<<<<<<<<
 *         else:
 *             self.op = TDBQCNUMOREQ if len(li) > 1 else TDBQCNUMEQ
 */
    __pyx_t_4 = PyObject_Length(__pyx_v_li); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if ((__pyx_t_4 > 1)) {
      __pyx_t_3 = TDBQCSTROREQ;
    } else {
      __pyx_t_3 = TDBQCSTREQ;
    }
    ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->op = __pyx_t_3;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/usr/local/src/totable/src/ctotable.pyx":525
 *             self.op = TDBQCSTROREQ if len(li) > 1 else TDBQCSTREQ
 *         else:
 *             self.op = TDBQCNUMOREQ if len(li) > 1 else TDBQCNUMEQ             # <<<<<<<<<<<<<<
 *             li = map(str, li)
 *         self.other = ' '.join(li)
 */
    __pyx_t_4 = PyObject_Length(__pyx_v_li); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if ((__pyx_t_4 > 1)) {
      __pyx_t_3 = TDBQCNUMOREQ;
    } else {
      __pyx_t_3 = TDBQCNUMEQ;
    }
    ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->op = __pyx_t_3;

    /* "/usr/local/src/totable/src/ctotable.pyx":526
 *         else:
 *             self.op = TDBQCNUMOREQ if len(li) > 1 else TDBQCNUMEQ
 *             li = map(str, li)             # <<<<<<<<<<<<<<
 *         self.other = ' '.join(li)
 *         return self
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 526; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)((PyObject*)&PyString_Type)));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)((PyObject*)&PyString_Type)));
    __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyString_Type)));
    __Pyx_INCREF(__pyx_v_li);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_li);
    __Pyx_GIVEREF(__pyx_v_li);
    __pyx_t_5 = PyObject_Call(__pyx_builtin_map, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 526; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_v_li);
    __pyx_v_li = __pyx_t_5;
    __pyx_t_5 = 0;
  }
  __pyx_L5:;

  /* "/usr/local/src/totable/src/ctotable.pyx":527
 *             self.op = TDBQCNUMOREQ if len(li) > 1 else TDBQCNUMEQ
 *             li = map(str, li)
 *         self.other = ' '.join(li)             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_kp_s_12), __pyx_n_s__join); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_li);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_li);
  __Pyx_GIVEREF(__pyx_v_li);
  __pyx_t_6 = PyObject_Call(__pyx_t_5, __pyx_t_1, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GIVEREF(__pyx_t_6);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other = __pyx_t_6;
  __pyx_t_6 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":528
 *             li = map(str, li)
 *         self.other = ' '.join(li)
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def like(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("ctotable.Col.in_list");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_li);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":530
 *         return self
 * 
 *     def like(self, other):             # <<<<<<<<<<<<<<
 *         assert isinstance(other, basestring)
 *         self.op = TDBQCSTRINC
 */

static PyObject *__pyx_pf_8ctotable_3Col_like(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col_like(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("like");

  /* "/usr/local/src/totable/src/ctotable.pyx":531
 * 
 *     def like(self, other):
 *         assert isinstance(other, basestring)             # <<<<<<<<<<<<<<
 *         self.op = TDBQCSTRINC
 *         self.other = other
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_t_1 = PyObject_IsInstance(__pyx_v_other, __pyx_builtin_basestring); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__pyx_t_1)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/usr/local/src/totable/src/ctotable.pyx":532
 *     def like(self, other):
 *         assert isinstance(other, basestring)
 *         self.op = TDBQCSTRINC             # <<<<<<<<<<<<<<
 *         self.other = other
 *         return self
 */
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->op = TDBQCSTRINC;

  /* "/usr/local/src/totable/src/ctotable.pyx":533
 *         assert isinstance(other, basestring)
 *         self.op = TDBQCSTRINC
 *         self.other = other             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  __Pyx_INCREF(__pyx_v_other);
  __Pyx_GIVEREF(__pyx_v_other);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other = __pyx_v_other;

  /* "/usr/local/src/totable/src/ctotable.pyx":534
 *         self.op = TDBQCSTRINC
 *         self.other = other
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def startswith(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("ctotable.Col.like");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":536
 *         return self
 * 
 *     def startswith(self, other):             # <<<<<<<<<<<<<<
 *         self.other = other
 *         self.op = TDBQCSTRBW
 */

static PyObject *__pyx_pf_8ctotable_3Col_startswith(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col_startswith(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("startswith");

  /* "/usr/local/src/totable/src/ctotable.pyx":537
 * 
 *     def startswith(self, other):
 *         self.other = other             # <<<<<<<<<<<<<<
 *         self.op = TDBQCSTRBW
 *         return self
 */
  __Pyx_INCREF(__pyx_v_other);
  __Pyx_GIVEREF(__pyx_v_other);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other = __pyx_v_other;

  /* "/usr/local/src/totable/src/ctotable.pyx":538
 *     def startswith(self, other):
 *         self.other = other
 *         self.op = TDBQCSTRBW             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->op = TDBQCSTRBW;

  /* "/usr/local/src/totable/src/ctotable.pyx":539
 *         self.other = other
 *         self.op = TDBQCSTRBW
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def endswith(self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":541
 *         return self
 * 
 *     def endswith(self, other):             # <<<<<<<<<<<<<<
 *         self.other = other
 *         self.op = TDBQCSTREW
 */

static PyObject *__pyx_pf_8ctotable_3Col_endswith(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col_endswith(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("endswith");

  /* "/usr/local/src/totable/src/ctotable.pyx":542
 * 
 *     def endswith(self, other):
 *         self.other = other             # <<<<<<<<<<<<<<
 *         self.op = TDBQCSTREW
 *         return self
 */
  __Pyx_INCREF(__pyx_v_other);
  __Pyx_GIVEREF(__pyx_v_other);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other = __pyx_v_other;

  /* "/usr/local/src/totable/src/ctotable.pyx":543
 *     def endswith(self, other):
 *         self.other = other
 *         self.op = TDBQCSTREW             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->op = TDBQCSTREW;

  /* "/usr/local/src/totable/src/ctotable.pyx":544
 *         self.other = other
 *         self.op = TDBQCSTREW
 *         return self             # <<<<<<<<<<<<<<
 * 
 *     def between(self, low, high):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":546
 *         return self
 * 
 *     def between(self, low, high):             # <<<<<<<<<<<<<<
 *         self.other = str(low) + ' ' + str(high)
 *         self.op = TDBQCNUMBT
 */

static PyObject *__pyx_pf_8ctotable_3Col_between(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_8ctotable_3Col_between(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_low = 0;
  PyObject *__pyx_v_high = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__low,&__pyx_n_s__high,0};
  __Pyx_RefNannySetupContext("between");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__low);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__high);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("between", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "between") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_low = values[0];
    __pyx_v_high = values[1];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_low = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_high = PyTuple_GET_ITEM(__pyx_args, 1);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("between", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.Col.between");
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "/usr/local/src/totable/src/ctotable.pyx":547
 * 
 *     def between(self, low, high):
 *         self.other = str(low) + ' ' + str(high)             # <<<<<<<<<<<<<<
 *         self.op = TDBQCNUMBT
 *         return self
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_low);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_low);
  __Pyx_GIVEREF(__pyx_v_low);
  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_2, ((PyObject *)__pyx_kp_s_12)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_high);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_high);
  __Pyx_GIVEREF(__pyx_v_high);
  __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)&PyString_Type)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GIVEREF(__pyx_t_2);
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  __Pyx_DECREF(((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other);
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->other = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":548
 *     def between(self, low, high):
 *         self.other = str(low) + ' ' + str(high)
 *         self.op = TDBQCNUMBT             # <<<<<<<<<<<<<<
 *         return self
 * 
 */
  ((struct __pyx_obj_8ctotable_Col *)__pyx_v_self)->op = TDBQCNUMBT;

  /* "/usr/local/src/totable/src/ctotable.pyx":549
 *         self.other = str(low) + ' ' + str(high)
 *         self.op = TDBQCNUMBT
 *         return self             # <<<<<<<<<<<<<<
 * 
 * cdef class transaction(object):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self);
  __pyx_r = __pyx_v_self;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.Col.between");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":553
 * cdef class transaction(object):
 *     cdef ToTable table
 *     def __init__(self, ToTable t):             # <<<<<<<<<<<<<<
 *         self.table = t
 * 
 */

static int __pyx_pf_8ctotable_11transaction___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_8ctotable_11transaction___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8ctotable_ToTable *__pyx_v_t = 0;
  int __pyx_r;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__t,0};
  __Pyx_RefNannySetupContext("__init__");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[1] = {0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__t);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 553; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_t = ((struct __pyx_obj_8ctotable_ToTable *)values[0]);
  } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_t = ((struct __pyx_obj_8ctotable_ToTable *)PyTuple_GET_ITEM(__pyx_args, 0));
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 553; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.transaction.__init__");
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_t), __pyx_ptype_8ctotable_ToTable, 1, "t", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":554
 *     cdef ToTable table
 *     def __init__(self, ToTable t):
 *         self.table = t             # <<<<<<<<<<<<<<
 * 
 *     def __enter__(self):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_t));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_t));
  __Pyx_GOTREF(((struct __pyx_obj_8ctotable_transaction *)__pyx_v_self)->table);
  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_8ctotable_transaction *)__pyx_v_self)->table));
  ((struct __pyx_obj_8ctotable_transaction *)__pyx_v_self)->table = __pyx_v_t;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("ctotable.transaction.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":556
 *         self.table = t
 * 
 *     def __enter__(self):             # <<<<<<<<<<<<<<
 *         cdef bint success = tctdbtranbegin(self.table._state)
 *         if not success:
 */

static PyObject *__pyx_pf_8ctotable_11transaction___enter__(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_8ctotable_11transaction___enter__(PyObject *__pyx_v_self, PyObject *unused) {
  int __pyx_v_success;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__enter__");
  __Pyx_INCREF((PyObject *)__pyx_v_self);

  /* "/usr/local/src/totable/src/ctotable.pyx":557
 * 
 *     def __enter__(self):
 *         cdef bint success = tctdbtranbegin(self.table._state)             # <<<<<<<<<<<<<<
 *         if not success:
 *             self.table._throw()
 */
  __pyx_v_success = tctdbtranbegin(((struct __pyx_obj_8ctotable_transaction *)__pyx_v_self)->table->_state);

  /* "/usr/local/src/totable/src/ctotable.pyx":558
 *     def __enter__(self):
 *         cdef bint success = tctdbtranbegin(self.table._state)
 *         if not success:             # <<<<<<<<<<<<<<
 *             self.table._throw()
 * 
 */
  __pyx_t_1 = (!__pyx_v_success);
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":559
 *         cdef bint success = tctdbtranbegin(self.table._state)
 *         if not success:
 *             self.table._throw()             # <<<<<<<<<<<<<<
 * 
 *     def __exit__(self, type, value, exc):
 */
    __pyx_t_2 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_8ctotable_transaction *)__pyx_v_self)->table), __pyx_n_s___throw); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("ctotable.transaction.__enter__");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":561
 *             self.table._throw()
 * 
 *     def __exit__(self, type, value, exc):             # <<<<<<<<<<<<<<
 *         cdef bint success
 *         if exc is None:
 */

static PyObject *__pyx_pf_8ctotable_11transaction___exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_8ctotable_11transaction___exit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_type = 0;
  PyObject *__pyx_v_value = 0;
  PyObject *__pyx_v_exc = 0;
  int __pyx_v_success;
  PyObject *__pyx_r = NULL;
  int __pyx_t_1;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__type,&__pyx_n_s__value,&__pyx_n_s__exc,0};
  __Pyx_RefNannySetupContext("__exit__");
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[3] = {0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__type);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__value);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__exc);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__exit__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_type = values[0];
    __pyx_v_value = values[1];
    __pyx_v_exc = values[2];
  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_type = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_value = PyTuple_GET_ITEM(__pyx_args, 1);
    __pyx_v_exc = PyTuple_GET_ITEM(__pyx_args, 2);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__exit__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("ctotable.transaction.__exit__");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF((PyObject *)__pyx_v_self);
  __Pyx_INCREF(__pyx_v_type);
  __Pyx_INCREF(__pyx_v_value);
  __Pyx_INCREF(__pyx_v_exc);

  /* "/usr/local/src/totable/src/ctotable.pyx":563
 *     def __exit__(self, type, value, exc):
 *         cdef bint success
 *         if exc is None:             # <<<<<<<<<<<<<<
 *             success = tctdbtrancommit(self.table._state)
 *         else:
 */
  __pyx_t_1 = (__pyx_v_exc == Py_None);
  if (__pyx_t_1) {

    /* "/usr/local/src/totable/src/ctotable.pyx":564
 *         cdef bint success
 *         if exc is None:
 *             success = tctdbtrancommit(self.table._state)             # <<<<<<<<<<<<<<
 *         else:
 *             success = tctdbtranabort(self.table._state)
 */
    __pyx_v_success = tctdbtrancommit(((struct __pyx_obj_8ctotable_transaction *)__pyx_v_self)->table->_state);
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/usr/local/src/totable/src/ctotable.pyx":566
 *             success = tctdbtrancommit(self.table._state)
 *         else:
 *             success = tctdbtranabort(self.table._state)             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_v_success = tctdbtranabort(((struct __pyx_obj_8ctotable_transaction *)__pyx_v_self)->table->_state);
  }
  __pyx_L6:;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_DECREF((PyObject *)__pyx_v_self);
  __Pyx_DECREF(__pyx_v_type);
  __Pyx_DECREF(__pyx_v_value);
  __Pyx_DECREF(__pyx_v_exc);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":571
 * cdef class TCMap(object):
 *     cdef TCMAP* _state
 *     def __del__(self):             # <<<<<<<<<<<<<<
 *         tcmapdel(self._state)
 * 
 */

static PyObject *__pyx_pf_8ctotable_5TCMap___del__(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_8ctotable_5TCMap___del__(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("__del__");

  /* "/usr/local/src/totable/src/ctotable.pyx":572
 *     cdef TCMAP* _state
 *     def __del__(self):
 *         tcmapdel(self._state)             # <<<<<<<<<<<<<<
 * 
 * cdef TCMap make_tcmap():
 */
  tcmapdel(((struct __pyx_obj_8ctotable_TCMap *)__pyx_v_self)->_state);

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":574
 *         tcmapdel(self._state)
 * 
 * cdef TCMap make_tcmap():             # <<<<<<<<<<<<<<
 *     pass
 * 
 */

static  struct __pyx_obj_8ctotable_TCMap *__pyx_f_8ctotable_make_tcmap(void) {
  struct __pyx_obj_8ctotable_TCMap *__pyx_r = NULL;
  __Pyx_RefNannySetupContext("make_tcmap");

  __pyx_r = ((struct __pyx_obj_8ctotable_TCMap *)Py_None); __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "/usr/local/src/totable/src/ctotable.pyx":581
 * cdef class TCQuery(object):
 *     cdef TDBQRY* _state
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         tctdbqrydel(self._state)
 * 
 */

static void __pyx_pf_8ctotable_7TCQuery___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pf_8ctotable_7TCQuery___dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannySetupContext("__dealloc__");

  /* "/usr/local/src/totable/src/ctotable.pyx":582
 *     cdef TDBQRY* _state
 *     def __dealloc__(self):
 *         tctdbqrydel(self._state)             # <<<<<<<<<<<<<<
 * 
 * cdef TCQuery make_query(TCTDB* tctdb):
 */
  tctdbqrydel(((struct __pyx_obj_8ctotable_TCQuery *)__pyx_v_self)->_state);

  __Pyx_RefNannyFinishContext();
}

/* "/usr/local/src/totable/src/ctotable.pyx":584
 *         tctdbqrydel(self._state)
 * 
 * cdef TCQuery make_query(TCTDB* tctdb):             # <<<<<<<<<<<<<<
 *     cdef TCQuery query = TCQuery()
 *     query._state = tctdbqrynew(tctdb)
 */

static  struct __pyx_obj_8ctotable_TCQuery *__pyx_f_8ctotable_make_query(TCTDB *__pyx_v_tctdb) {
  struct __pyx_obj_8ctotable_TCQuery *__pyx_v_query = 0;
  struct __pyx_obj_8ctotable_TCQuery *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("make_query");

  /* "/usr/local/src/totable/src/ctotable.pyx":585
 * 
 * cdef TCQuery make_query(TCTDB* tctdb):
 *     cdef TCQuery query = TCQuery()             # <<<<<<<<<<<<<<
 *     query._state = tctdbqrynew(tctdb)
 *     return query
 */
  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8ctotable_TCQuery)), ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 585; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_query = ((struct __pyx_obj_8ctotable_TCQuery *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":586
 * cdef TCQuery make_query(TCTDB* tctdb):
 *     cdef TCQuery query = TCQuery()
 *     query._state = tctdbqrynew(tctdb)             # <<<<<<<<<<<<<<
 *     return query
 * 
 */
  __pyx_v_query->_state = tctdbqrynew(__pyx_v_tctdb);

  /* "/usr/local/src/totable/src/ctotable.pyx":587
 *     cdef TCQuery query = TCQuery()
 *     query._state = tctdbqrynew(tctdb)
 *     return query             # <<<<<<<<<<<<<<
 * 
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_query));
  __pyx_r = __pyx_v_query;
  goto __pyx_L0;

  __pyx_r = ((struct __pyx_obj_8ctotable_TCQuery *)Py_None); __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("ctotable.make_query");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_query);
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static struct __pyx_vtabstruct_8ctotable_ToTable __pyx_vtable_8ctotable_ToTable;

static PyObject *__pyx_tp_new_8ctotable_ToTable(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_8ctotable_ToTable *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_8ctotable_ToTable *)o);
  p->__pyx_vtab = __pyx_vtabptr_8ctotable_ToTable;
  p->path = Py_None; Py_INCREF(Py_None);
  p->mode = Py_None; Py_INCREF(Py_None);
  if (__pyx_pf_8ctotable_7ToTable___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_8ctotable_ToTable(PyObject *o) {
  struct __pyx_obj_8ctotable_ToTable *p = (struct __pyx_obj_8ctotable_ToTable *)o;
  Py_XDECREF(p->path);
  Py_XDECREF(p->mode);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_8ctotable_ToTable(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_8ctotable_ToTable *p = (struct __pyx_obj_8ctotable_ToTable *)o;
  if (p->path) {
    e = (*v)(p->path, a); if (e) return e;
  }
  if (p->mode) {
    e = (*v)(p->mode, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_8ctotable_ToTable(PyObject *o) {
  struct __pyx_obj_8ctotable_ToTable *p = (struct __pyx_obj_8ctotable_ToTable *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->path);
  p->path = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->mode);
  p->mode = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}
static PyObject *__pyx_sq_item_8ctotable_ToTable(PyObject *o, Py_ssize_t i) {
  PyObject *r;
  PyObject *x = PyInt_FromSsize_t(i); if(!x) return 0;
  r = Py_TYPE(o)->tp_as_mapping->mp_subscript(o, x);
  Py_DECREF(x);
  return r;
}

static int __pyx_mp_ass_subscript_8ctotable_ToTable(PyObject *o, PyObject *i, PyObject *v) {
  if (v) {
    return __pyx_pf_8ctotable_7ToTable___setitem__(o, i, v);
  }
  else {
    return __pyx_pf_8ctotable_7ToTable___delitem__(o, i);
  }
}

static struct PyMethodDef __pyx_methods_8ctotable_ToTable[] = {
  {__Pyx_NAMESTR("__repr__"), (PyCFunction)__pyx_pf_8ctotable_7ToTable___repr__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("_throw"), (PyCFunction)__pyx_pf_8ctotable_7ToTable__throw, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable__throw)},
  {__Pyx_NAMESTR("_msg"), (PyCFunction)__pyx_pf_8ctotable_7ToTable__msg, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable__msg)},
  {__Pyx_NAMESTR("optimize"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_optimize, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("clear"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_clear, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("close"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_close, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_close)},
  {__Pyx_NAMESTR("optimize_index"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_optimize_index, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("delete_index"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_delete_index, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("create_index"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_create_index, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_create_index)},
  {__Pyx_NAMESTR("put"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_put, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_put)},
  {__Pyx_NAMESTR("__iter__"), (PyCFunction)__pyx_pf_8ctotable_7ToTable___iter__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("__next__"), (PyCFunction)__pyx_pf_8ctotable_7ToTable___next__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("keep_or_put"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_keep_or_put, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_keep_or_put)},
  {__Pyx_NAMESTR("setdefault"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_setdefault, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_setdefault)},
  {__Pyx_NAMESTR("__getitem__"), (PyCFunction)__pyx_pf_8ctotable_7ToTable___getitem__, METH_O|METH_COEXIST, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable___getitem__)},
  {__Pyx_NAMESTR("get"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_get, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("pop"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_pop, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_pop)},
  {__Pyx_NAMESTR("size_of"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_size_of, METH_O, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_size_of)},
  {__Pyx_NAMESTR("flush"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_flush, METH_NOARGS, __Pyx_DOCSTR(__pyx_doc_8ctotable_7ToTable_flush)},
  {__Pyx_NAMESTR("count"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_count, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("delete"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_delete, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("select"), (PyCFunction)__pyx_pf_8ctotable_7ToTable_select, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static struct PyMemberDef __pyx_members_8ctotable_ToTable[] = {
  {(char *)"path", T_OBJECT, offsetof(struct __pyx_obj_8ctotable_ToTable, path), READONLY, 0},
  {(char *)"mode", T_OBJECT, offsetof(struct __pyx_obj_8ctotable_ToTable, mode), READONLY, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_ToTable = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_ToTable = {
  __pyx_pf_8ctotable_7ToTable___len__, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  __pyx_sq_item_8ctotable_ToTable, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  __pyx_pf_8ctotable_7ToTable___contains__, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_ToTable = {
  __pyx_pf_8ctotable_7ToTable___len__, /*mp_length*/
  __pyx_pf_8ctotable_7ToTable___getitem__, /*mp_subscript*/
  __pyx_mp_ass_subscript_8ctotable_ToTable, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_ToTable = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_8ctotable_ToTable = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("ctotable.ToTable"), /*tp_name*/
  sizeof(struct __pyx_obj_8ctotable_ToTable), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8ctotable_ToTable, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  __pyx_pf_8ctotable_7ToTable___repr__, /*tp_repr*/
  &__pyx_tp_as_number_ToTable, /*tp_as_number*/
  &__pyx_tp_as_sequence_ToTable, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_ToTable, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_ToTable, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("A Tokyo Cabinet table database.\n    \n    `path` is the path to the database file to be opened.\n    `mode` either 'w' for write or 'r' for read.\n    "), /*tp_doc*/
  __pyx_tp_traverse_8ctotable_ToTable, /*tp_traverse*/
  __pyx_tp_clear_8ctotable_ToTable, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pf_8ctotable_7ToTable___iter__, /*tp_iter*/
  __pyx_pf_8ctotable_7ToTable___next__, /*tp_iternext*/
  __pyx_methods_8ctotable_ToTable, /*tp_methods*/
  __pyx_members_8ctotable_ToTable, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8ctotable_ToTable, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_8ctotable_Col(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_8ctotable_Col *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_8ctotable_Col *)o);
  p->colname = Py_None; Py_INCREF(Py_None);
  p->other = Py_None; Py_INCREF(Py_None);
  p->num_lookups = ((PyObject *)Py_None); Py_INCREF(Py_None);
  if (__pyx_pf_8ctotable_3Col___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_8ctotable_Col(PyObject *o) {
  struct __pyx_obj_8ctotable_Col *p = (struct __pyx_obj_8ctotable_Col *)o;
  Py_XDECREF(p->colname);
  Py_XDECREF(p->other);
  Py_XDECREF(((PyObject *)p->num_lookups));
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_8ctotable_Col(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_8ctotable_Col *p = (struct __pyx_obj_8ctotable_Col *)o;
  if (p->colname) {
    e = (*v)(p->colname, a); if (e) return e;
  }
  if (p->other) {
    e = (*v)(p->other, a); if (e) return e;
  }
  if (p->num_lookups) {
    e = (*v)(p->num_lookups, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_8ctotable_Col(PyObject *o) {
  struct __pyx_obj_8ctotable_Col *p = (struct __pyx_obj_8ctotable_Col *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->colname);
  p->colname = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->other);
  p->other = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->num_lookups);
  p->num_lookups = ((PyObject *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static struct PyMethodDef __pyx_methods_8ctotable_Col[] = {
  {__Pyx_NAMESTR("__invert__"), (PyCFunction)__pyx_pf_8ctotable_3Col___invert__, METH_NOARGS|METH_COEXIST, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("matches"), (PyCFunction)__pyx_pf_8ctotable_3Col_matches, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("in_list"), (PyCFunction)__pyx_pf_8ctotable_3Col_in_list, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("like"), (PyCFunction)__pyx_pf_8ctotable_3Col_like, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("startswith"), (PyCFunction)__pyx_pf_8ctotable_3Col_startswith, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("endswith"), (PyCFunction)__pyx_pf_8ctotable_3Col_endswith, METH_O, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("between"), (PyCFunction)__pyx_pf_8ctotable_3Col_between, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static struct PyMemberDef __pyx_members_8ctotable_Col[] = {
  {(char *)"colname", T_OBJECT, offsetof(struct __pyx_obj_8ctotable_Col, colname), READONLY, 0},
  {(char *)"op", T_INT, offsetof(struct __pyx_obj_8ctotable_Col, op), 0, 0},
  {(char *)"other", T_OBJECT, offsetof(struct __pyx_obj_8ctotable_Col, other), 0, 0},
  {(char *)"num_lookups", T_OBJECT, offsetof(struct __pyx_obj_8ctotable_Col, num_lookups), READONLY, 0},
  {(char *)"invert", T_INT, offsetof(struct __pyx_obj_8ctotable_Col, invert), READONLY, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_Col = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  __pyx_pf_8ctotable_3Col___invert__, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_Col = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_Col = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_Col = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_8ctotable_Col = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("ctotable.Col"), /*tp_name*/
  sizeof(struct __pyx_obj_8ctotable_Col), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8ctotable_Col, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_Col, /*tp_as_number*/
  &__pyx_tp_as_sequence_Col, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_Col, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_Col, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  __Pyx_DOCSTR("\n    TODO:\n    tdb.query(Col('name') == 'Fred' & Col('age') > 22)\n        or\n    tdb.select(Q(name__in=['Fred', 'Wilma']), Q(name__contains=\"at2g\"))\n    "), /*tp_doc*/
  __pyx_tp_traverse_8ctotable_Col, /*tp_traverse*/
  __pyx_tp_clear_8ctotable_Col, /*tp_clear*/
  __pyx_pf_8ctotable_3Col___richcmp__, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8ctotable_Col, /*tp_methods*/
  __pyx_members_8ctotable_Col, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8ctotable_Col, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_8ctotable_transaction(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_8ctotable_transaction *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_8ctotable_transaction *)o);
  p->table = ((struct __pyx_obj_8ctotable_ToTable *)Py_None); Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_8ctotable_transaction(PyObject *o) {
  struct __pyx_obj_8ctotable_transaction *p = (struct __pyx_obj_8ctotable_transaction *)o;
  Py_XDECREF(((PyObject *)p->table));
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_8ctotable_transaction(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_8ctotable_transaction *p = (struct __pyx_obj_8ctotable_transaction *)o;
  if (p->table) {
    e = (*v)(((PyObject*)p->table), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_8ctotable_transaction(PyObject *o) {
  struct __pyx_obj_8ctotable_transaction *p = (struct __pyx_obj_8ctotable_transaction *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->table);
  p->table = ((struct __pyx_obj_8ctotable_ToTable *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static struct PyMethodDef __pyx_methods_8ctotable_transaction[] = {
  {__Pyx_NAMESTR("__enter__"), (PyCFunction)__pyx_pf_8ctotable_11transaction___enter__, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("__exit__"), (PyCFunction)__pyx_pf_8ctotable_11transaction___exit__, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_transaction = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_transaction = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_transaction = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_transaction = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_8ctotable_transaction = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("ctotable.transaction"), /*tp_name*/
  sizeof(struct __pyx_obj_8ctotable_transaction), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8ctotable_transaction, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_transaction, /*tp_as_number*/
  &__pyx_tp_as_sequence_transaction, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_transaction, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_transaction, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_8ctotable_transaction, /*tp_traverse*/
  __pyx_tp_clear_8ctotable_transaction, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8ctotable_transaction, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_8ctotable_11transaction___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8ctotable_transaction, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_8ctotable_TCMap(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  return o;
}

static void __pyx_tp_dealloc_8ctotable_TCMap(PyObject *o) {
  (*Py_TYPE(o)->tp_free)(o);
}

static struct PyMethodDef __pyx_methods_8ctotable_TCMap[] = {
  {__Pyx_NAMESTR("__del__"), (PyCFunction)__pyx_pf_8ctotable_5TCMap___del__, METH_NOARGS, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_TCMap = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_TCMap = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_TCMap = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_TCMap = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_8ctotable_TCMap = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("ctotable.TCMap"), /*tp_name*/
  sizeof(struct __pyx_obj_8ctotable_TCMap), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8ctotable_TCMap, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_TCMap, /*tp_as_number*/
  &__pyx_tp_as_sequence_TCMap, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_TCMap, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_TCMap, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8ctotable_TCMap, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8ctotable_TCMap, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static PyObject *__pyx_tp_new_8ctotable_TCQuery(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  return o;
}

static void __pyx_tp_dealloc_8ctotable_TCQuery(PyObject *o) {
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pf_8ctotable_7TCQuery___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  (*Py_TYPE(o)->tp_free)(o);
}

static struct PyMethodDef __pyx_methods_8ctotable_TCQuery[] = {
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_TCQuery = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  #if PY_MAJOR_VERSION >= 3
  0, /*reserved*/
  #else
  0, /*nb_long*/
  #endif
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_TCQuery = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_TCQuery = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_TCQuery = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_getbuffer*/
  #endif
  #if PY_VERSION_HEX >= 0x02060000
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_8ctotable_TCQuery = {
  PyVarObject_HEAD_INIT(0, 0)
  __Pyx_NAMESTR("ctotable.TCQuery"), /*tp_name*/
  sizeof(struct __pyx_obj_8ctotable_TCQuery), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8ctotable_TCQuery, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_TCQuery, /*tp_as_number*/
  &__pyx_tp_as_sequence_TCQuery, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_TCQuery, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_TCQuery, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8ctotable_TCQuery, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8ctotable_TCQuery, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  #if PY_VERSION_HEX >= 0x02060000
  0, /*tp_version_tag*/
  #endif
};

static struct PyMethodDef __pyx_methods[] = {
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    __Pyx_NAMESTR("ctotable"),
    __Pyx_DOCSTR(__pyx_k_21), /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp_s_1, __pyx_k_1, sizeof(__pyx_k_1), 0, 0, 1, 0},
  {&__pyx_kp_s_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 0, 1, 0},
  {&__pyx_kp_s_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 0, 1, 0},
  {&__pyx_kp_s_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 0, 1, 0},
  {&__pyx_kp_s_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 0, 1, 0},
  {&__pyx_kp_s_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 0, 1, 0},
  {&__pyx_kp_s_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 0, 1, 0},
  {&__pyx_kp_s_16, __pyx_k_16, sizeof(__pyx_k_16), 0, 0, 1, 0},
  {&__pyx_kp_s_17, __pyx_k_17, sizeof(__pyx_k_17), 0, 0, 1, 0},
  {&__pyx_kp_s_18, __pyx_k_18, sizeof(__pyx_k_18), 0, 0, 1, 0},
  {&__pyx_kp_s_19, __pyx_k_19, sizeof(__pyx_k_19), 0, 0, 1, 0},
  {&__pyx_kp_s_2, __pyx_k_2, sizeof(__pyx_k_2), 0, 0, 1, 0},
  {&__pyx_kp_s_20, __pyx_k_20, sizeof(__pyx_k_20), 0, 0, 1, 0},
  {&__pyx_n_s_22, __pyx_k_22, sizeof(__pyx_k_22), 0, 0, 1, 1},
  {&__pyx_kp_s_23, __pyx_k_23, sizeof(__pyx_k_23), 0, 0, 1, 0},
  {&__pyx_kp_s_24, __pyx_k_24, sizeof(__pyx_k_24), 0, 0, 1, 0},
  {&__pyx_kp_s_3, __pyx_k_3, sizeof(__pyx_k_3), 0, 0, 1, 0},
  {&__pyx_kp_s_4, __pyx_k_4, sizeof(__pyx_k_4), 0, 0, 1, 0},
  {&__pyx_kp_s_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 1, 0},
  {&__pyx_kp_s_6, __pyx_k_6, sizeof(__pyx_k_6), 0, 0, 1, 0},
  {&__pyx_kp_s_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 0, 1, 0},
  {&__pyx_kp_s_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 0, 1, 0},
  {&__pyx_kp_s_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 0, 1, 0},
  {&__pyx_n_s__Exception, __pyx_k__Exception, sizeof(__pyx_k__Exception), 0, 0, 1, 1},
  {&__pyx_n_s__KeyError, __pyx_k__KeyError, sizeof(__pyx_k__KeyError), 0, 0, 1, 1},
  {&__pyx_n_s__StopIteration, __pyx_k__StopIteration, sizeof(__pyx_k__StopIteration), 0, 0, 1, 1},
  {&__pyx_n_s__TCException, __pyx_k__TCException, sizeof(__pyx_k__TCException), 0, 0, 1, 1},
  {&__pyx_n_s__TDBTBZIP, __pyx_k__TDBTBZIP, sizeof(__pyx_k__TDBTBZIP), 0, 0, 1, 1},
  {&__pyx_n_s__TDBTDEFLATE, __pyx_k__TDBTDEFLATE, sizeof(__pyx_k__TDBTDEFLATE), 0, 0, 1, 1},
  {&__pyx_n_s__TDBTEXCODEC, __pyx_k__TDBTEXCODEC, sizeof(__pyx_k__TDBTEXCODEC), 0, 0, 1, 1},
  {&__pyx_n_s__TDBTLARGE, __pyx_k__TDBTLARGE, sizeof(__pyx_k__TDBTLARGE), 0, 0, 1, 1},
  {&__pyx_n_s__TDBTTCBS, __pyx_k__TDBTTCBS, sizeof(__pyx_k__TDBTTCBS), 0, 0, 1, 1},
  {&__pyx_n_s____class__, __pyx_k____class__, sizeof(__pyx_k____class__), 0, 0, 1, 1},
  {&__pyx_n_s____main__, __pyx_k____main__, sizeof(__pyx_k____main__), 0, 0, 1, 1},
  {&__pyx_n_s____name__, __pyx_k____name__, sizeof(__pyx_k____name__), 0, 0, 1, 1},
  {&__pyx_n_s____version__, __pyx_k____version__, sizeof(__pyx_k____version__), 0, 0, 1, 1},
  {&__pyx_n_s___ckey_to_dict, __pyx_k___ckey_to_dict, sizeof(__pyx_k___ckey_to_dict), 0, 0, 1, 1},
  {&__pyx_n_s___dict_to_tcmap, __pyx_k___dict_to_tcmap, sizeof(__pyx_k___dict_to_tcmap), 0, 0, 1, 1},
  {&__pyx_n_s___key_to_dict, __pyx_k___key_to_dict, sizeof(__pyx_k___key_to_dict), 0, 0, 1, 1},
  {&__pyx_n_s___msg, __pyx_k___msg, sizeof(__pyx_k___msg), 0, 0, 1, 1},
  {&__pyx_n_s___put_keep_code, __pyx_k___put_keep_code, sizeof(__pyx_k___put_keep_code), 0, 0, 1, 1},
  {&__pyx_n_s___set_callback, __pyx_k___set_callback, sizeof(__pyx_k___set_callback), 0, 0, 1, 1},
  {&__pyx_n_s___set_limit, __pyx_k___set_limit, sizeof(__pyx_k___set_limit), 0, 0, 1, 1},
  {&__pyx_n_s___set_order, __pyx_k___set_order, sizeof(__pyx_k___set_order), 0, 0, 1, 1},
  {&__pyx_n_s___state, __pyx_k___state, sizeof(__pyx_k___state), 0, 0, 1, 1},
  {&__pyx_n_s___tclist_to_list, __pyx_k___tclist_to_list, sizeof(__pyx_k___tclist_to_list), 0, 0, 1, 1},
  {&__pyx_n_s___tcmap_to_dict, __pyx_k___tcmap_to_dict, sizeof(__pyx_k___tcmap_to_dict), 0, 0, 1, 1},
  {&__pyx_n_s___throw, __pyx_k___throw, sizeof(__pyx_k___throw), 0, 0, 1, 1},
  {&__pyx_n_s__apow, __pyx_k__apow, sizeof(__pyx_k__apow), 0, 0, 1, 1},
  {&__pyx_n_s__basestring, __pyx_k__basestring, sizeof(__pyx_k__basestring), 0, 0, 1, 1},
  {&__pyx_n_s__bnum, __pyx_k__bnum, sizeof(__pyx_k__bnum), 0, 0, 1, 1},
  {&__pyx_n_s__c, __pyx_k__c, sizeof(__pyx_k__c), 0, 0, 1, 1},
  {&__pyx_n_s__callback, __pyx_k__callback, sizeof(__pyx_k__callback), 0, 0, 1, 1},
  {&__pyx_n_s__colname, __pyx_k__colname, sizeof(__pyx_k__colname), 0, 0, 1, 1},
  {&__pyx_n_s__count, __pyx_k__count, sizeof(__pyx_k__count), 0, 0, 1, 1},
  {&__pyx_n_s__create_index, __pyx_k__create_index, sizeof(__pyx_k__create_index), 0, 0, 1, 1},
  {&__pyx_n_s__d, __pyx_k__d, sizeof(__pyx_k__d), 0, 0, 1, 1},
  {&__pyx_n_s__default, __pyx_k__default, sizeof(__pyx_k__default), 0, 0, 1, 1},
  {&__pyx_n_s__delete, __pyx_k__delete, sizeof(__pyx_k__delete), 0, 0, 1, 1},
  {&__pyx_n_s__exc, __pyx_k__exc, sizeof(__pyx_k__exc), 0, 0, 1, 1},
  {&__pyx_n_s__format, __pyx_k__format, sizeof(__pyx_k__format), 0, 0, 1, 1},
  {&__pyx_n_s__fpow, __pyx_k__fpow, sizeof(__pyx_k__fpow), 0, 0, 1, 1},
  {&__pyx_n_s__get, __pyx_k__get, sizeof(__pyx_k__get), 0, 0, 1, 1},
  {&__pyx_n_s__get_proc, __pyx_k__get_proc, sizeof(__pyx_k__get_proc), 0, 0, 1, 1},
  {&__pyx_n_s__high, __pyx_k__high, sizeof(__pyx_k__high), 0, 0, 1, 1},
  {&__pyx_n_s__idx_type, __pyx_k__idx_type, sizeof(__pyx_k__idx_type), 0, 0, 1, 1},
  {&__pyx_n_s__invert, __pyx_k__invert, sizeof(__pyx_k__invert), 0, 0, 1, 1},
  {&__pyx_n_s__items, __pyx_k__items, sizeof(__pyx_k__items), 0, 0, 1, 1},
  {&__pyx_n_s__join, __pyx_k__join, sizeof(__pyx_k__join), 0, 0, 1, 1},
  {&__pyx_n_s__k, __pyx_k__k, sizeof(__pyx_k__k), 0, 0, 1, 1},
  {&__pyx_n_s__keep, __pyx_k__keep, sizeof(__pyx_k__keep), 0, 0, 1, 1},
  {&__pyx_n_s__keep_or_put, __pyx_k__keep_or_put, sizeof(__pyx_k__keep_or_put), 0, 0, 1, 1},
  {&__pyx_n_s__key, __pyx_k__key, sizeof(__pyx_k__key), 0, 0, 1, 1},
  {&__pyx_n_s__lcnum, __pyx_k__lcnum, sizeof(__pyx_k__lcnum), 0, 0, 1, 1},
  {&__pyx_n_s__limit, __pyx_k__limit, sizeof(__pyx_k__limit), 0, 0, 1, 1},
  {&__pyx_n_s__low, __pyx_k__low, sizeof(__pyx_k__low), 0, 0, 1, 1},
  {&__pyx_n_s__map, __pyx_k__map, sizeof(__pyx_k__map), 0, 0, 1, 1},
  {&__pyx_n_s__message, __pyx_k__message, sizeof(__pyx_k__message), 0, 0, 1, 1},
  {&__pyx_n_s__mmap_size, __pyx_k__mmap_size, sizeof(__pyx_k__mmap_size), 0, 0, 1, 1},
  {&__pyx_n_s__mode, __pyx_k__mode, sizeof(__pyx_k__mode), 0, 0, 1, 1},
  {&__pyx_n_s__ncnum, __pyx_k__ncnum, sizeof(__pyx_k__ncnum), 0, 0, 1, 1},
  {&__pyx_n_s__num_lookups, __pyx_k__num_lookups, sizeof(__pyx_k__num_lookups), 0, 0, 1, 1},
  {&__pyx_n_s__o, __pyx_k__o, sizeof(__pyx_k__o), 0, 0, 1, 1},
  {&__pyx_n_s__offset, __pyx_k__offset, sizeof(__pyx_k__offset), 0, 0, 1, 1},
  {&__pyx_n_s__op, __pyx_k__op, sizeof(__pyx_k__op), 0, 0, 1, 1},
  {&__pyx_n_s__opts, __pyx_k__opts, sizeof(__pyx_k__opts), 0, 0, 1, 1},
  {&__pyx_n_s__order, __pyx_k__order, sizeof(__pyx_k__order), 0, 0, 1, 1},
  {&__pyx_n_s__other, __pyx_k__other, sizeof(__pyx_k__other), 0, 0, 1, 1},
  {&__pyx_n_s__p, __pyx_k__p, sizeof(__pyx_k__p), 0, 0, 1, 1},
  {&__pyx_n_s__path, __pyx_k__path, sizeof(__pyx_k__path), 0, 0, 1, 1},
  {&__pyx_n_s__pop, __pyx_k__pop, sizeof(__pyx_k__pop), 0, 0, 1, 1},
  {&__pyx_n_s__put, __pyx_k__put, sizeof(__pyx_k__put), 0, 0, 1, 1},
  {&__pyx_n_s__r, __pyx_k__r, sizeof(__pyx_k__r), 0, 0, 1, 1},
  {&__pyx_n_s__range, __pyx_k__range, sizeof(__pyx_k__range), 0, 0, 1, 1},
  {&__pyx_n_s__rcnum, __pyx_k__rcnum, sizeof(__pyx_k__rcnum), 0, 0, 1, 1},
  {&__pyx_n_s__s, __pyx_k__s, sizeof(__pyx_k__s), 0, 0, 1, 1},
  {&__pyx_n_s__select, __pyx_k__select, sizeof(__pyx_k__select), 0, 0, 1, 1},
  {&__pyx_n_s__size_of, __pyx_k__size_of, sizeof(__pyx_k__size_of), 0, 0, 1, 1},
  {&__pyx_n_s__t, __pyx_k__t, sizeof(__pyx_k__t), 0, 0, 1, 1},
  {&__pyx_n_s__table, __pyx_k__table, sizeof(__pyx_k__table), 0, 0, 1, 1},
  {&__pyx_n_s__type, __pyx_k__type, sizeof(__pyx_k__type), 0, 0, 1, 1},
  {&__pyx_n_s__v, __pyx_k__v, sizeof(__pyx_k__v), 0, 0, 1, 1},
  {&__pyx_n_s__value, __pyx_k__value, sizeof(__pyx_k__value), 0, 0, 1, 1},
  {&__pyx_n_s__values_only, __pyx_k__values_only, sizeof(__pyx_k__values_only), 0, 0, 1, 1},
  {&__pyx_n_s__w, __pyx_k__w, sizeof(__pyx_k__w), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_Exception = __Pyx_GetName(__pyx_b, __pyx_n_s__Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_KeyError = __Pyx_GetName(__pyx_b, __pyx_n_s__KeyError); if (!__pyx_builtin_KeyError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_StopIteration = __Pyx_GetName(__pyx_b, __pyx_n_s__StopIteration); if (!__pyx_builtin_StopIteration) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_range = __Pyx_GetName(__pyx_b, __pyx_n_s__range); if (!__pyx_builtin_range) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_basestring = __Pyx_GetName(__pyx_b, __pyx_n_s__basestring); if (!__pyx_builtin_basestring) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_map = __Pyx_GetName(__pyx_b, __pyx_n_s__map); if (!__pyx_builtin_map) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 526; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitGlobals(void) {
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_4 = PyInt_FromLong(4); if (unlikely(!__pyx_int_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_5 = PyInt_FromLong(5); if (unlikely(!__pyx_int_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_8 = PyInt_FromLong(8); if (unlikely(!__pyx_int_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_16 = PyInt_FromLong(16); if (unlikely(!__pyx_int_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initctotable(void); /*proto*/
PyMODINIT_FUNC initctotable(void)
#else
PyMODINIT_FUNC PyInit_ctotable(void); /*proto*/
PyMODINIT_FUNC PyInit_ctotable(void)
#endif
{
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  #if CYTHON_REFNANNY
  void* __pyx_refnanny = NULL;
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
  if (!__Pyx_RefNanny) {
      PyErr_Clear();
      __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
      if (!__Pyx_RefNanny)
          Py_FatalError("failed to import 'refnanny' module");
  }
  __pyx_refnanny = __Pyx_RefNanny->SetupContext("PyMODINIT_FUNC PyInit_ctotable(void)", __LINE__, __FILE__);
  #endif
  __pyx_init_filenames();
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if PY_MAJOR_VERSION < 3
  __pyx_empty_bytes = PyString_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #else
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4(__Pyx_NAMESTR("ctotable"), __pyx_methods, __Pyx_DOCSTR(__pyx_k_21), 0, PYTHON_API_VERSION);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (!__pyx_m) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  #if PY_MAJOR_VERSION < 3
  Py_INCREF(__pyx_m);
  #endif
  __pyx_b = PyImport_AddModule(__Pyx_NAMESTR(__Pyx_BUILTIN_MODULE_NAME));
  if (!__pyx_b) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_module_is_main_ctotable) {
    if (__Pyx_SetAttrString(__pyx_m, "__name__", __pyx_n_s____main__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  }
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Global init code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  __pyx_vtabptr_8ctotable_ToTable = &__pyx_vtable_8ctotable_ToTable;
  #if PY_MAJOR_VERSION >= 3
  __pyx_vtable_8ctotable_ToTable._msg = (PyObject *(*)(struct __pyx_obj_8ctotable_ToTable *, int __pyx_skip_dispatch))__pyx_f_8ctotable_7ToTable__msg;
  __pyx_vtable_8ctotable_ToTable._dict_to_tcmap = (TCMAP *(*)(struct __pyx_obj_8ctotable_ToTable *, PyObject *))__pyx_f_8ctotable_7ToTable__dict_to_tcmap;
  __pyx_vtable_8ctotable_ToTable.create_index = (int (*)(struct __pyx_obj_8ctotable_ToTable *, char *, PyObject *, int __pyx_skip_dispatch))__pyx_f_8ctotable_7ToTable_create_index;
  __pyx_vtable_8ctotable_ToTable._tcmap_to_dict = (PyObject *(*)(struct __pyx_obj_8ctotable_ToTable *, TCMAP *))__pyx_f_8ctotable_7ToTable__tcmap_to_dict;
  __pyx_vtable_8ctotable_ToTable._key_to_dict = (PyObject *(*)(struct __pyx_obj_8ctotable_ToTable *, PyObject *))__pyx_f_8ctotable_7ToTable__key_to_dict;
  __pyx_vtable_8ctotable_ToTable._ckey_to_dict = (PyObject *(*)(struct __pyx_obj_8ctotable_ToTable *, char *, int))__pyx_f_8ctotable_7ToTable__ckey_to_dict;
  __pyx_vtable_8ctotable_ToTable._put_keep_code = (PyObject *(*)(struct __pyx_obj_8ctotable_ToTable *, int, PyObject *))__pyx_f_8ctotable_7ToTable__put_keep_code;
  __pyx_vtable_8ctotable_ToTable.get = (PyObject *(*)(struct __pyx_obj_8ctotable_ToTable *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8ctotable_7ToTable_get *__pyx_optional_args))__pyx_f_8ctotable_7ToTable_get;
  __pyx_vtable_8ctotable_ToTable.size_of = (int (*)(struct __pyx_obj_8ctotable_ToTable *, PyObject *, int __pyx_skip_dispatch))__pyx_f_8ctotable_7ToTable_size_of;
  __pyx_vtable_8ctotable_ToTable._set_limit = (void (*)(struct __pyx_obj_8ctotable_ToTable *, TDBQRY *, PyObject *))__pyx_f_8ctotable_7ToTable__set_limit;
  __pyx_vtable_8ctotable_ToTable._set_callback = (void (*)(struct __pyx_obj_8ctotable_ToTable *, TDBQRY *, PyObject *))__pyx_f_8ctotable_7ToTable__set_callback;
  __pyx_vtable_8ctotable_ToTable.get_proc = (TDBQRYPROC (*)(struct __pyx_obj_8ctotable_ToTable *, void *))__pyx_f_8ctotable_7ToTable_get_proc;
  __pyx_vtable_8ctotable_ToTable._set_order = (void (*)(struct __pyx_obj_8ctotable_ToTable *, TDBQRY *, PyObject *))__pyx_f_8ctotable_7ToTable__set_order;
  __pyx_vtable_8ctotable_ToTable._tclist_to_list = (PyObject *(*)(struct __pyx_obj_8ctotable_ToTable *, TCLIST *, int, int))__pyx_f_8ctotable_7ToTable__tclist_to_list;
  #else
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._msg = (void(*)(void))__pyx_f_8ctotable_7ToTable__msg;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._dict_to_tcmap = (void(*)(void))__pyx_f_8ctotable_7ToTable__dict_to_tcmap;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable.create_index = (void(*)(void))__pyx_f_8ctotable_7ToTable_create_index;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._tcmap_to_dict = (void(*)(void))__pyx_f_8ctotable_7ToTable__tcmap_to_dict;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._key_to_dict = (void(*)(void))__pyx_f_8ctotable_7ToTable__key_to_dict;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._ckey_to_dict = (void(*)(void))__pyx_f_8ctotable_7ToTable__ckey_to_dict;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._put_keep_code = (void(*)(void))__pyx_f_8ctotable_7ToTable__put_keep_code;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable.get = (void(*)(void))__pyx_f_8ctotable_7ToTable_get;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable.size_of = (void(*)(void))__pyx_f_8ctotable_7ToTable_size_of;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._set_limit = (void(*)(void))__pyx_f_8ctotable_7ToTable__set_limit;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._set_callback = (void(*)(void))__pyx_f_8ctotable_7ToTable__set_callback;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable.get_proc = (void(*)(void))__pyx_f_8ctotable_7ToTable_get_proc;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._set_order = (void(*)(void))__pyx_f_8ctotable_7ToTable__set_order;
  *(void(**)(void))&__pyx_vtable_8ctotable_ToTable._tclist_to_list = (void(*)(void))__pyx_f_8ctotable_7ToTable__tclist_to_list;
  #endif
  if (PyType_Ready(&__pyx_type_8ctotable_ToTable) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetVtable(__pyx_type_8ctotable_ToTable.tp_dict, __pyx_vtabptr_8ctotable_ToTable) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "ToTable", (PyObject *)&__pyx_type_8ctotable_ToTable) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8ctotable_ToTable = &__pyx_type_8ctotable_ToTable;
  if (PyType_Ready(&__pyx_type_8ctotable_Col) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "Col", (PyObject *)&__pyx_type_8ctotable_Col) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8ctotable_Col = &__pyx_type_8ctotable_Col;
  if (PyType_Ready(&__pyx_type_8ctotable_transaction) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "transaction", (PyObject *)&__pyx_type_8ctotable_transaction) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 551; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8ctotable_transaction = &__pyx_type_8ctotable_transaction;
  if (PyType_Ready(&__pyx_type_8ctotable_TCMap) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "TCMap", (PyObject *)&__pyx_type_8ctotable_TCMap) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8ctotable_TCMap = &__pyx_type_8ctotable_TCMap;
  if (PyType_Ready(&__pyx_type_8ctotable_TCQuery) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 579; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_SetAttrString(__pyx_m, "TCQuery", (PyObject *)&__pyx_type_8ctotable_TCQuery) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 579; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8ctotable_TCQuery = &__pyx_type_8ctotable_TCQuery;
  /*--- Type import code ---*/
  /*--- Function import code ---*/
  /*--- Execution code ---*/

  /* "/usr/local/src/totable/src/ctotable.pyx":24
 * 
 * DEF DEFAULT_OPTS = 0
 * TDBTLARGE = 1             # <<<<<<<<<<<<<<
 * TDBTDEFLATE = 1 << 1
 * TDBTBZIP = 1 << 2
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__TDBTLARGE, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":25
 * DEF DEFAULT_OPTS = 0
 * TDBTLARGE = 1
 * TDBTDEFLATE = 1 << 1             # <<<<<<<<<<<<<<
 * TDBTBZIP = 1 << 2
 * TDBTTCBS = 1 << 3
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__TDBTDEFLATE, __pyx_int_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":26
 * TDBTLARGE = 1
 * TDBTDEFLATE = 1 << 1
 * TDBTBZIP = 1 << 2             # <<<<<<<<<<<<<<
 * TDBTTCBS = 1 << 3
 * TDBTEXCODEC = 1 << 4
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__TDBTBZIP, __pyx_int_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":27
 * TDBTDEFLATE = 1 << 1
 * TDBTBZIP = 1 << 2
 * TDBTTCBS = 1 << 3             # <<<<<<<<<<<<<<
 * TDBTEXCODEC = 1 << 4
 * 
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__TDBTTCBS, __pyx_int_8) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":28
 * TDBTBZIP = 1 << 2
 * TDBTTCBS = 1 << 3
 * TDBTEXCODEC = 1 << 4             # <<<<<<<<<<<<<<
 * 
 * 
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__TDBTEXCODEC, __pyx_int_16) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":31
 * 
 * 
 * tokyo_cabinet_version = c_tcversion             # <<<<<<<<<<<<<<
 * __version__ = '0.1.1'
 * 
 */
  __pyx_t_1 = __Pyx_PyBytes_FromString(tcversion); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_22, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/usr/local/src/totable/src/ctotable.pyx":32
 * 
 * tokyo_cabinet_version = c_tcversion
 * __version__ = '0.1.1'             # <<<<<<<<<<<<<<
 * 
 * class TCException(Exception):
 */
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s____version__, ((PyObject *)__pyx_kp_s_23)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/usr/local/src/totable/src/ctotable.pyx":34
 * __version__ = '0.1.1'
 * 
 * class TCException(Exception):             # <<<<<<<<<<<<<<
 *     '''An error communicating with the Tokyo Cabinet database.'''
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_builtin_Exception);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_builtin_Exception);
  __Pyx_GIVEREF(__pyx_builtin_Exception);
  if (PyDict_SetItemString(((PyObject *)__pyx_t_1), "__doc__", ((PyObject *)__pyx_kp_s_24)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = __Pyx_CreateClass(__pyx_t_2, ((PyObject *)__pyx_t_1), __pyx_n_s__TCException, "ctotable"); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__TCException, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;

  /* "/usr/local/lib/python2.6/dist-packages/Cython-0.12-py2.6-linux-x86_64.egg/Cython/Includes/python_list.pxd":1
 * from python_ref cimport PyObject             # <<<<<<<<<<<<<<
 * 
 * cdef extern from "Python.h":
 */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  if (__pyx_m) {
    __Pyx_AddTraceback("init ctotable");
    Py_DECREF(__pyx_m); __pyx_m = 0;
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init ctotable");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

static const char *__pyx_filenames[] = {
  "ctotable.pyx",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AS_STRING(kw_name));
        #endif
}

static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *number, *more_or_less;

    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    number = (num_expected == 1) ? "" : "s";
    PyErr_Format(PyExc_TypeError,
        #if PY_VERSION_HEX < 0x02050000
            "%s() takes %s %d positional argument%s (%d given)",
        #else
            "%s() takes %s %zd positional argument%s (%zd given)",
        #endif
        func_name, more_or_less, num_expected, number, num_found);
}

static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;

    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
        } else {
            #if PY_MAJOR_VERSION < 3
            if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key))) {
            #else
            if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key))) {
            #endif
                goto invalid_keyword_type;
            } else {
                for (name = first_kw_arg; *name; name++) {
                    #if PY_MAJOR_VERSION >= 3
                    if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                        PyUnicode_Compare(**name, key) == 0) break;
                    #else
                    if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                        _PyString_Eq(**name, key)) break;
                    #endif
                }
                if (*name) {
                    values[name-argnames] = value;
                } else {
                    /* unexpected keyword found */
                    for (name=argnames; name != first_kw_arg; name++) {
                        if (**name == key) goto arg_passed_twice;
                        #if PY_MAJOR_VERSION >= 3
                        if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                            PyUnicode_Compare(**name, key) == 0) goto arg_passed_twice;
                        #else
                        if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                            _PyString_Eq(**name, key)) goto arg_passed_twice;
                        #endif
                    }
                    if (kwds2) {
                        if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
                    } else {
                        goto invalid_keyword;
                    }
                }
            }
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, **name);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%s() got an unexpected keyword argument '%s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
        #if PY_VERSION_HEX < 0x02050000
                 "need more than %d value%s to unpack", (int)index,
        #else
                 "need more than %zd value%s to unpack", index,
        #endif
                 (index == 1) ? "" : "s");
}

static INLINE void __Pyx_RaiseTooManyValuesError(void) {
    PyErr_SetString(PyExc_ValueError, "too many values to unpack");
}

static PyObject *__Pyx_UnpackItem(PyObject *iter, Py_ssize_t index) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred()) {
            __Pyx_RaiseNeedMoreValuesError(index);
        }
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        __Pyx_RaiseTooManyValuesError();
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}

static INLINE void __Pyx_RaiseNoneNotIterableError(void) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *local_type, *local_value, *local_tb;
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
    if (unlikely(tstate->curexc_type))
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
        goto bad;
    #endif
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
    Py_INCREF(local_type);
    Py_INCREF(local_value);
    Py_INCREF(local_tb);
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    /* Make sure tstate is in a consistent state when we XDECREF
       these objects (XDECREF may run arbitrary code). */
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}



static INLINE int __Pyx_CheckKeywordStrings(
    PyObject *kwdict,
    const char* function_name,
    int kw_allowed)
{
    PyObject* key = 0;
    Py_ssize_t pos = 0;
    while (PyDict_Next(kwdict, &pos, &key, 0)) {
        #if PY_MAJOR_VERSION < 3
        if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key)))
        #else
        if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key)))
        #endif
            goto invalid_keyword_type;
    }
    if ((!kw_allowed) && unlikely(key))
        goto invalid_keyword;
    return 1;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%s() keywords must be strings", function_name);
    return 0;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%s() got an unexpected keyword argument '%s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
    return 0;
}

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact)
{
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (Py_TYPE(obj) == type) return 1;
    }
    else {
        if (PyObject_TypeCheck(obj, type)) return 1;
    }
    PyErr_Format(PyExc_TypeError,
        "Argument '%s' has incorrect type (expected %s, got %s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
    return 0;
}

static INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
}

static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static PyObject *__Pyx_CreateClass(
    PyObject *bases, PyObject *dict, PyObject *name, const char *modname)
{
    PyObject *py_modname;
    PyObject *result = 0;

    #if PY_MAJOR_VERSION < 3
    py_modname = PyString_FromString(modname);
    #else
    py_modname = PyUnicode_FromString(modname);
    #endif
    if (!py_modname)
        goto bad;
    if (PyDict_SetItemString(dict, "__module__", py_modname) < 0)
        goto bad;
    #if PY_MAJOR_VERSION < 3
    result = PyClass_New(bases, dict, name);
    #else
    result = PyObject_CallFunctionObjArgs((PyObject *)&PyType_Type, name, bases, dict, NULL);
    #endif
bad:
    Py_XDECREF(py_modname);
    return result;
}

static INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();

    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}

static INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;

    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
}


#if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    /* First, check the traceback argument, replacing None with NULL. */
    if (tb == Py_None) {
        Py_DECREF(tb);
        tb = 0;
    }
    else if (tb != NULL && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    /* Next, replace a missing value with None */
    if (value == NULL) {
        value = Py_None;
        Py_INCREF(value);
    }
    #if PY_VERSION_HEX < 0x02050000
    if (!PyClass_Check(type))
    #else
    if (!PyType_Check(type))
    #endif
    {
        /* Raising an instance.  The value should be a dummy. */
        if (value != Py_None) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        Py_DECREF(value);
        value = type;
        #if PY_VERSION_HEX < 0x02050000
            if (PyInstance_Check(type)) {
                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
                Py_INCREF(type);
            }
            else {
                type = 0;
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception must be an old-style class or instance");
                goto raise_error;
            }
        #else
            type = (PyObject*) Py_TYPE(type);
            Py_INCREF(type);
            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception class must be a subclass of BaseException");
                goto raise_error;
            }
        #endif
    }

    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

#else /* Python 3+ */

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;

    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (!PyExceptionClass_Check(type)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }

    PyErr_SetObject(type, value);

    if (tb) {
        PyThreadState *tstate = PyThreadState_GET();
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
    }

bad:
    return;
}
#endif

static INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject* x) {
    const unsigned char neg_one = (unsigned char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned char" :
                    "value too large to convert to unsigned char");
            }
            return (unsigned char)-1;
        }
        return (unsigned char)val;
    }
    return (unsigned char)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject* x) {
    const unsigned short neg_one = (unsigned short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned short" :
                    "value too large to convert to unsigned short");
            }
            return (unsigned short)-1;
        }
        return (unsigned short)val;
    }
    return (unsigned short)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject* x) {
    const unsigned int neg_one = (unsigned int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(unsigned int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to unsigned int" :
                    "value too large to convert to unsigned int");
            }
            return (unsigned int)-1;
        }
        return (unsigned int)val;
    }
    return (unsigned int)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE char __Pyx_PyInt_AsChar(PyObject* x) {
    const char neg_one = (char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to char" :
                    "value too large to convert to char");
            }
            return (char)-1;
        }
        return (char)val;
    }
    return (char)__Pyx_PyInt_AsLong(x);
}

static INLINE short __Pyx_PyInt_AsShort(PyObject* x) {
    const short neg_one = (short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to short" :
                    "value too large to convert to short");
            }
            return (short)-1;
        }
        return (short)val;
    }
    return (short)__Pyx_PyInt_AsLong(x);
}

static INLINE int __Pyx_PyInt_AsInt(PyObject* x) {
    const int neg_one = (int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to int" :
                    "value too large to convert to int");
            }
            return (int)-1;
        }
        return (int)val;
    }
    return (int)__Pyx_PyInt_AsLong(x);
}

static INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject* x) {
    const signed char neg_one = (signed char)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed char)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed char" :
                    "value too large to convert to signed char");
            }
            return (signed char)-1;
        }
        return (signed char)val;
    }
    return (signed char)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject* x) {
    const signed short neg_one = (signed short)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed short)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed short" :
                    "value too large to convert to signed short");
            }
            return (signed short)-1;
        }
        return (signed short)val;
    }
    return (signed short)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject* x) {
    const signed int neg_one = (signed int)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(signed int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed int)val)) {
            if (!unlikely(val == -1 && PyErr_Occurred())) {
                PyErr_SetString(PyExc_OverflowError,
                    (is_unsigned && unlikely(val < 0)) ?
                    "can't convert negative value to signed int" :
                    "value too large to convert to signed int");
            }
            return (signed int)-1;
        }
        return (signed int)val;
    }
    return (signed int)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject* x) {
    const unsigned long neg_one = (unsigned long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned long");
            return (unsigned long)-1;
        }
        return (unsigned long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned long");
                return (unsigned long)-1;
            }
            return PyLong_AsUnsignedLong(x);
        } else {
            return PyLong_AsLong(x);
        }
    } else {
        unsigned long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned long)-1;
        val = __Pyx_PyInt_AsUnsignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject* x) {
    const unsigned PY_LONG_LONG neg_one = (unsigned PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned PY_LONG_LONG");
            return (unsigned PY_LONG_LONG)-1;
        }
        return (unsigned PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned PY_LONG_LONG");
                return (unsigned PY_LONG_LONG)-1;
            }
            return PyLong_AsUnsignedLongLong(x);
        } else {
            return PyLong_AsLongLong(x);
        }
    } else {
        unsigned PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsUnsignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE long __Pyx_PyInt_AsLong(PyObject* x) {
    const long neg_one = (long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to long");
            return (long)-1;
        }
        return (long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to long");
                return (long)-1;
            }
            return PyLong_AsUnsignedLong(x);
        } else {
            return PyLong_AsLong(x);
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (long)-1;
        val = __Pyx_PyInt_AsLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject* x) {
    const PY_LONG_LONG neg_one = (PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to PY_LONG_LONG");
            return (PY_LONG_LONG)-1;
        }
        return (PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to PY_LONG_LONG");
                return (PY_LONG_LONG)-1;
            }
            return PyLong_AsUnsignedLongLong(x);
        } else {
            return PyLong_AsLongLong(x);
        }
    } else {
        PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject* x) {
    const signed long neg_one = (signed long)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to signed long");
            return (signed long)-1;
        }
        return (signed long)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to signed long");
                return (signed long)-1;
            }
            return PyLong_AsUnsignedLong(x);
        } else {
            return PyLong_AsLong(x);
        }
    } else {
        signed long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed long)-1;
        val = __Pyx_PyInt_AsSignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject* x) {
    const signed PY_LONG_LONG neg_one = (signed PY_LONG_LONG)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (is_unsigned && unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to signed PY_LONG_LONG");
            return (signed PY_LONG_LONG)-1;
        }
        return (signed PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
            if (unlikely(Py_SIZE(x) < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to signed PY_LONG_LONG");
                return (signed PY_LONG_LONG)-1;
            }
            return PyLong_AsUnsignedLongLong(x);
        } else {
            return PyLong_AsLongLong(x);
        }
    } else {
        signed PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsSignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE int64_t __Pyx_PyInt_from_py_int64_t(PyObject* x) {
    const int64_t neg_one = (int64_t)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(int64_t) == sizeof(char)) {
        if (is_unsigned)
            return (int64_t)__Pyx_PyInt_AsUnsignedChar(x);
        else
            return (int64_t)__Pyx_PyInt_AsSignedChar(x);
    } else if (sizeof(int64_t) == sizeof(short)) {
        if (is_unsigned)
            return (int64_t)__Pyx_PyInt_AsUnsignedShort(x);
        else
            return (int64_t)__Pyx_PyInt_AsSignedShort(x);
    } else if (sizeof(int64_t) == sizeof(int)) {
        if (is_unsigned)
            return (int64_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (int64_t)__Pyx_PyInt_AsSignedInt(x);
    } else if (sizeof(int64_t) == sizeof(long)) {
        if (is_unsigned)
            return (int64_t)__Pyx_PyInt_AsUnsignedLong(x);
        else
            return (int64_t)__Pyx_PyInt_AsSignedLong(x);
    } else if (sizeof(int64_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return (int64_t)__Pyx_PyInt_AsUnsignedLongLong(x);
        else
            return (int64_t)__Pyx_PyInt_AsSignedLongLong(x);
#if 0
    } else if (sizeof(int64_t) > sizeof(short) &&
               sizeof(int64_t) < sizeof(int)) { /*  __int32 ILP64 ? */
        if (is_unsigned)
            return (int64_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (int64_t)__Pyx_PyInt_AsSignedInt(x);
#endif
    }
    PyErr_SetString(PyExc_TypeError, "int64_t");
    return (int64_t)-1;
}

static INLINE int8_t __Pyx_PyInt_from_py_int8_t(PyObject* x) {
    const int8_t neg_one = (int8_t)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(int8_t) == sizeof(char)) {
        if (is_unsigned)
            return (int8_t)__Pyx_PyInt_AsUnsignedChar(x);
        else
            return (int8_t)__Pyx_PyInt_AsSignedChar(x);
    } else if (sizeof(int8_t) == sizeof(short)) {
        if (is_unsigned)
            return (int8_t)__Pyx_PyInt_AsUnsignedShort(x);
        else
            return (int8_t)__Pyx_PyInt_AsSignedShort(x);
    } else if (sizeof(int8_t) == sizeof(int)) {
        if (is_unsigned)
            return (int8_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (int8_t)__Pyx_PyInt_AsSignedInt(x);
    } else if (sizeof(int8_t) == sizeof(long)) {
        if (is_unsigned)
            return (int8_t)__Pyx_PyInt_AsUnsignedLong(x);
        else
            return (int8_t)__Pyx_PyInt_AsSignedLong(x);
    } else if (sizeof(int8_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return (int8_t)__Pyx_PyInt_AsUnsignedLongLong(x);
        else
            return (int8_t)__Pyx_PyInt_AsSignedLongLong(x);
#if 0
    } else if (sizeof(int8_t) > sizeof(short) &&
               sizeof(int8_t) < sizeof(int)) { /*  __int32 ILP64 ? */
        if (is_unsigned)
            return (int8_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (int8_t)__Pyx_PyInt_AsSignedInt(x);
#endif
    }
    PyErr_SetString(PyExc_TypeError, "int8_t");
    return (int8_t)-1;
}

static INLINE uint8_t __Pyx_PyInt_from_py_uint8_t(PyObject* x) {
    const uint8_t neg_one = (uint8_t)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(uint8_t) == sizeof(char)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedChar(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedChar(x);
    } else if (sizeof(uint8_t) == sizeof(short)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedShort(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedShort(x);
    } else if (sizeof(uint8_t) == sizeof(int)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedInt(x);
    } else if (sizeof(uint8_t) == sizeof(long)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedLong(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedLong(x);
    } else if (sizeof(uint8_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedLongLong(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedLongLong(x);
#if 0
    } else if (sizeof(uint8_t) > sizeof(short) &&
               sizeof(uint8_t) < sizeof(int)) { /*  __int32 ILP64 ? */
        if (is_unsigned)
            return (uint8_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (uint8_t)__Pyx_PyInt_AsSignedInt(x);
#endif
    }
    PyErr_SetString(PyExc_TypeError, "uint8_t");
    return (uint8_t)-1;
}

static INLINE int32_t __Pyx_PyInt_from_py_int32_t(PyObject* x) {
    const int32_t neg_one = (int32_t)-1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (sizeof(int32_t) == sizeof(char)) {
        if (is_unsigned)
            return (int32_t)__Pyx_PyInt_AsUnsignedChar(x);
        else
            return (int32_t)__Pyx_PyInt_AsSignedChar(x);
    } else if (sizeof(int32_t) == sizeof(short)) {
        if (is_unsigned)
            return (int32_t)__Pyx_PyInt_AsUnsignedShort(x);
        else
            return (int32_t)__Pyx_PyInt_AsSignedShort(x);
    } else if (sizeof(int32_t) == sizeof(int)) {
        if (is_unsigned)
            return (int32_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (int32_t)__Pyx_PyInt_AsSignedInt(x);
    } else if (sizeof(int32_t) == sizeof(long)) {
        if (is_unsigned)
            return (int32_t)__Pyx_PyInt_AsUnsignedLong(x);
        else
            return (int32_t)__Pyx_PyInt_AsSignedLong(x);
    } else if (sizeof(int32_t) == sizeof(PY_LONG_LONG)) {
        if (is_unsigned)
            return (int32_t)__Pyx_PyInt_AsUnsignedLongLong(x);
        else
            return (int32_t)__Pyx_PyInt_AsSignedLongLong(x);
#if 0
    } else if (sizeof(int32_t) > sizeof(short) &&
               sizeof(int32_t) < sizeof(int)) { /*  __int32 ILP64 ? */
        if (is_unsigned)
            return (int32_t)__Pyx_PyInt_AsUnsignedInt(x);
        else
            return (int32_t)__Pyx_PyInt_AsSignedInt(x);
#endif
    }
    PyErr_SetString(PyExc_TypeError, "int32_t");
    return (int32_t)-1;
}

static void __Pyx_WriteUnraisable(const char *name) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
    #if PY_MAJOR_VERSION < 3
    ctx = PyString_FromString(name);
    #else
    ctx = PyUnicode_FromString(name);
    #endif
    __Pyx_ErrRestore(old_exc, old_val, old_tb);
    if (!ctx) {
        PyErr_WriteUnraisable(Py_None);
    } else {
        PyErr_WriteUnraisable(ctx);
        Py_DECREF(ctx);
    }
}

static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
#if PY_VERSION_HEX < 0x03010000
    PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
#else
    PyObject *ob = PyCapsule_New(vtable, 0, 0);
#endif
    if (!ob)
        goto bad;
    if (PyDict_SetItemString(dict, "__pyx_vtable__", ob) < 0)
        goto bad;
    Py_DECREF(ob);
    return 0;
bad:
    Py_XDECREF(ob);
    return -1;
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(const char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;

    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(__pyx_filename);
    #else
    py_srcfile = PyUnicode_FromString(__pyx_filename);
    #endif
    if (!py_srcfile) goto bad;
    if (__pyx_clineno) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        #if PY_MAJOR_VERSION >= 3
        0,            /*int kwonlyargcount,*/
        #endif
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple,  /*PyObject *consts,*/
        __pyx_empty_tuple,  /*PyObject *names,*/
        __pyx_empty_tuple,  /*PyObject *varnames,*/
        __pyx_empty_tuple,  /*PyObject *freevars,*/
        __pyx_empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

/* Type Conversion Functions */

static INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   if (x == Py_True) return 1;
   else if ((x == Py_False) | (x == Py_None)) return 0;
   else return PyObject_IsTrue(x);
}

static INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x) {
  PyNumberMethods *m;
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_VERSION_HEX < 0x03000000
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return Py_INCREF(x), x;
  m = Py_TYPE(x)->tp_as_number;
#if PY_VERSION_HEX < 0x03000000
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
#else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
#endif
  if (res) {
#if PY_VERSION_HEX < 0x03000000
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%s__ returned non-%s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}

static INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject* x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}

static INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
#if PY_VERSION_HEX < 0x02050000
   if (ival <= LONG_MAX)
       return PyInt_FromLong((long)ival);
   else {
       unsigned char *bytes = (unsigned char *) &ival;
       int one = 1; int little = (int)*(unsigned char*)&one;
       return _PyLong_FromByteArray(bytes, sizeof(size_t), little, 0);
   }
#else
   return PyInt_FromSize_t(ival);
#endif
}

static INLINE size_t __Pyx_PyInt_AsSize_t(PyObject* x) {
   unsigned PY_LONG_LONG val = __Pyx_PyInt_AsUnsignedLongLong(x);
   if (unlikely(val == (unsigned PY_LONG_LONG)-1 && PyErr_Occurred())) {
       return (size_t)-1;
   } else if (unlikely(val != (unsigned PY_LONG_LONG)(size_t)val)) {
       PyErr_SetString(PyExc_OverflowError,
                       "value too large to convert to size_t");
       return (size_t)-1;
   }
   return (size_t)val;
}


#endif /* Py_PYTHON_H */
